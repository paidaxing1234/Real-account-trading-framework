# LinuxæœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

### æœåŠ¡å™¨é…ç½®
- **æ“ä½œç³»ç»Ÿ**: Ubuntu 20.04/22.04 LTS æˆ– CentOS 7/8
- **CPU**: 2æ ¸åŠä»¥ä¸Š
- **å†…å­˜**: 4GBåŠä»¥ä¸Š
- **ç¡¬ç›˜**: 20GBåŠä»¥ä¸Š
- **ç½‘ç»œ**: å…¬ç½‘IPæˆ–åŸŸå

### è½¯ä»¶è¦æ±‚
- Nginx >= 1.18
- Node.js >= 16 (ä»…æ„å»ºæ—¶éœ€è¦)
- ClickHouse Server >= 22.x
- Python >= 3.8 (åç«¯æœåŠ¡)

## ğŸ—„ï¸ ClickHouse æ•°æ®åº“

### ä¸ºä»€ä¹ˆé€‰æ‹© ClickHouseï¼Ÿ

ClickHouse éå¸¸é€‚åˆé‡åŒ–äº¤æ˜“ç³»ç»Ÿï¼š

âœ… **ä¼˜ç‚¹**ï¼š
1. **é«˜æ€§èƒ½åˆ†æ** - åˆ—å¼å­˜å‚¨ï¼ŒæŸ¥è¯¢é€Ÿåº¦æå¿«
2. **æ—¶åºæ•°æ®ä¼˜åŒ–** - å®Œç¾å¤„ç†Kçº¿ã€è¡Œæƒ…ã€å‡€å€¼ç­‰æ—¶åºæ•°æ®
3. **å®æ—¶èšåˆ** - ç‰©åŒ–è§†å›¾æ”¯æŒå®æ—¶ç»Ÿè®¡
4. **æ•°æ®å‹ç¼©** - å­˜å‚¨æˆæœ¬ä½ï¼Œ1TBæ•°æ®å‹ç¼©åå¯èƒ½åªéœ€100GB
5. **SQLæ”¯æŒ** - æ ‡å‡†SQLè¯­æ³•ï¼Œæ˜“äºä½¿ç”¨

âš ï¸ **æ³¨æ„äº‹é¡¹**ï¼š
1. **ä¸é€‚åˆé¢‘ç¹æ›´æ–°** - ä¸»è¦ç”¨äºè¿½åŠ å†™å…¥
2. **éœ€è¦é…åˆä½¿ç”¨** - å»ºè®®æ­é…Rediså­˜å‚¨ä¸´æ—¶æ•°æ®
3. **äº‹åŠ¡æ”¯æŒå¼±** - ä¸é€‚åˆä¼ ç»ŸOLTPåœºæ™¯

### ClickHouse å®‰è£…

#### Ubuntu/Debian
```bash
# æ·»åŠ ClickHouseä»“åº“
sudo apt-get install -y apt-transport-https ca-certificates dirmngr
sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 8919F6BD2B48D754

echo "deb https://packages.clickhouse.com/deb stable main" | sudo tee \
    /etc/apt/sources.list.d/clickhouse.list

# å®‰è£…ClickHouse
sudo apt-get update
sudo apt-get install -y clickhouse-server clickhouse-client

# å¯åŠ¨æœåŠ¡
sudo systemctl start clickhouse-server
sudo systemctl enable clickhouse-server

# æ£€æŸ¥çŠ¶æ€
sudo systemctl status clickhouse-server
```

#### CentOS/RHEL
```bash
# æ·»åŠ ä»“åº“
sudo yum install -y yum-utils
sudo yum-config-manager --add-repo https://packages.clickhouse.com/rpm/clickhouse.repo

# å®‰è£…
sudo yum install -y clickhouse-server clickhouse-client

# å¯åŠ¨
sudo systemctl start clickhouse-server
sudo systemctl enable clickhouse-server
```

### åˆå§‹åŒ–æ•°æ®åº“

```bash
# 1. è¿æ¥åˆ°ClickHouse
clickhouse-client

# 2. æ‰§è¡Œå»ºè¡¨è„šæœ¬
clickhouse-client --multiquery < database/clickhouse_schema.sql

# 3. éªŒè¯
clickhouse-client --query "SHOW TABLES FROM trading_system"
```

### ClickHouse é…ç½®ä¼˜åŒ–

ç¼–è¾‘ `/etc/clickhouse-server/config.xml`:

```xml
<clickhouse>
    <!-- ç›‘å¬åœ°å€ï¼ˆå…è®¸è¿œç¨‹è¿æ¥ï¼‰ -->
    <listen_host>0.0.0.0</listen_host>
    
    <!-- æœ€å¤§å†…å­˜ä½¿ç”¨ -->
    <max_server_memory_usage>8589934592</max_server_memory_usage>
    
    <!-- æœ€å¤§å¹¶å‘æŸ¥è¯¢æ•° -->
    <max_concurrent_queries>100</max_concurrent_queries>
    
    <!-- æ—¥å¿—çº§åˆ« -->
    <logger>
        <level>information</level>
        <log>/var/log/clickhouse-server/clickhouse-server.log</log>
        <errorlog>/var/log/clickhouse-server/clickhouse-server.err.log</errorlog>
        <size>1000M</size>
        <count>10</count>
    </logger>
</clickhouse>
```

## ğŸš€ å‰ç«¯éƒ¨ç½²æ­¥éª¤

### æ–¹å¼1ï¼šè‡ªåŠ¨éƒ¨ç½²ï¼ˆæ¨èï¼‰

#### 1. æœ¬åœ°æ„å»º
```bash
# åœ¨Windowså¼€å‘æœºä¸Šæ„å»º
cd D:\é‡åŒ–\å®ç›˜æ¡†æ¶å‰ç«¯é¡µé¢
npm run build
```

#### 2. ä¸Šä¼ åˆ°æœåŠ¡å™¨
```bash
# ä½¿ç”¨SCPä¸Šä¼ 
scp -r dist deploy root@your-server-ip:/tmp/trading-system/

# æˆ–ä½¿ç”¨rsyncï¼ˆæ›´é«˜æ•ˆï¼‰
rsync -avz --progress dist deploy root@your-server-ip:/tmp/trading-system/
```

#### 3. æœåŠ¡å™¨ç«¯éƒ¨ç½²
```bash
# SSHè¿æ¥åˆ°æœåŠ¡å™¨
ssh root@your-server-ip

# è¿›å…¥ä¸Šä¼ ç›®å½•
cd /tmp/trading-system

# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x deploy/deploy.sh
chmod +x deploy/setup-ssl.sh

# æ‰§è¡Œéƒ¨ç½²è„šæœ¬
./deploy/deploy.sh
```

#### 4. é…ç½®SSLè¯ä¹¦
```bash
# æ‰§è¡ŒSSLé…ç½®è„šæœ¬
./deploy/setup-ssl.sh
```

### æ–¹å¼2ï¼šæœåŠ¡å™¨ç›´æ¥æ„å»º

#### 1. å…‹éš†ä»£ç åˆ°æœåŠ¡å™¨
```bash
# å®‰è£…Git
sudo apt-get install -y git

# å…‹éš†ä»“åº“
cd /var/www
git clone <your-repo-url> trading-system
cd trading-system
```

#### 2. å®‰è£…Node.jså’Œä¾èµ–
```bash
# å®‰è£…Node.jsï¼ˆä½¿ç”¨nvmï¼‰
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc
nvm install 18
nvm use 18

# å®‰è£…pnpmï¼ˆå¯é€‰ï¼Œä½†æ›´å¿«ï¼‰
npm install -g pnpm

# å®‰è£…ä¾èµ–
pnpm install
# æˆ–
npm install
```

#### 3. æ„å»ºé¡¹ç›®
```bash
npm run build
```

#### 4. éƒ¨ç½²
```bash
chmod +x deploy/deploy.sh
sudo ./deploy/deploy.sh
```

## ğŸ”§ Nginx é…ç½®

### åŸºç¡€é…ç½®

é…ç½®æ–‡ä»¶å·²è‡ªåŠ¨éƒ¨ç½²åˆ°ï¼š`/etc/nginx/sites-available/trading-system`

### ä¿®æ”¹é…ç½®

```bash
# ç¼–è¾‘é…ç½®
sudo nano /etc/nginx/sites-available/trading-system

# ä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼š
# 1. åŸŸåï¼šserver_name your-domain.com;
# 2. SSLè¯ä¹¦è·¯å¾„ï¼ˆå¦‚æœä½¿ç”¨è‡ªç­¾åè¯ä¹¦ï¼‰
# 3. åç«¯APIåœ°å€ï¼šupstream trading_backend

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡æ–°åŠ è½½
sudo systemctl reload nginx
```

### é˜²ç«å¢™é…ç½®

```bash
# Ubuntu (UFW)
sudo ufw allow 'Nginx Full'
sudo ufw allow 22  # SSH
sudo ufw enable

# CentOS (firewalld)
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```

## ğŸ“Š æ•°æ®åº“é…ç½®æ–¹æ¡ˆ

### æ¨èæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯ (Nginx)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ HTTP/WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åç«¯API (Python/FastAPI)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â”‚                       â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”
â”‚     â”‚  Redis         â”‚  â”‚ ClickHouse â”‚
â”‚     â”‚  (ç¼“å­˜/é˜Ÿåˆ—)    â”‚  â”‚ (æ—¶åºæ•°æ®) â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®å­˜å‚¨ç­–ç•¥

#### 1. Redisï¼ˆå¿«é€Ÿè¯»å†™ï¼‰
- ç”¨æˆ·ä¼šè¯
- å®æ—¶è¡Œæƒ…ç¼“å­˜
- ä»»åŠ¡é˜Ÿåˆ—
- ä¸´æ—¶æ•°æ®

#### 2. ClickHouseï¼ˆåˆ†ææŸ¥è¯¢ï¼‰
- å†å²è®¢å•
- æˆäº¤è®°å½•
- è´¦æˆ·å¿«ç…§
- ç­–ç•¥æ€§èƒ½
- å‡€å€¼æ›²çº¿
- ç³»ç»Ÿæ—¥å¿—

### Redis å®‰è£…ï¼ˆå¯é€‰ä½†æ¨èï¼‰

```bash
# Ubuntu
sudo apt-get install -y redis-server
sudo systemctl start redis
sudo systemctl enable redis

# CentOS
sudo yum install -y redis
sudo systemctl start redis
sudo systemctl enable redis
```

## ğŸ” å®‰å…¨é…ç½®

### 1. SSHå®‰å…¨
```bash
# ä¿®æ”¹SSHç«¯å£
sudo nano /etc/ssh/sshd_config
# Port 22 æ”¹ä¸º Port 2222

# ç¦æ­¢rootç™»å½•
# PermitRootLogin yes æ”¹ä¸º PermitRootLogin no

# é‡å¯SSH
sudo systemctl restart sshd
```

### 2. ClickHouseå®‰å…¨

```bash
# è®¾ç½®ç”¨æˆ·å¯†ç 
clickhouse-client --query "CREATE USER admin IDENTIFIED BY 'your-strong-password'"
clickhouse-client --query "GRANT ALL ON trading_system.* TO admin"

# ç¼–è¾‘é…ç½®ç¦æ­¢åŒ¿åè®¿é—®
sudo nano /etc/clickhouse-server/users.xml
```

### 3. Nginxå®‰å…¨å¤´

å·²åœ¨é…ç½®æ–‡ä»¶ä¸­åŒ…å«ï¼š
- X-Frame-Options
- X-Content-Type-Options
- X-XSS-Protection
- éšè—ç‰ˆæœ¬å·

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. Nginxä¼˜åŒ–

```nginx
# å·¥ä½œè¿›ç¨‹æ•°ï¼ˆCPUæ ¸å¿ƒæ•°ï¼‰
worker_processes auto;

# æ¯ä¸ªè¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡
worker_rlimit_nofile 65535;

events {
    worker_connections 4096;
    use epoll;
}

http {
    # å¯ç”¨sendfile
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    
    # å®¢æˆ·ç«¯ç¼“å†²åŒº
    client_body_buffer_size 128k;
    client_max_body_size 10m;
}
```

### 2. ClickHouseä¼˜åŒ–

```sql
-- è®¾ç½®åˆç†çš„åˆ†åŒºç­–ç•¥
PARTITION BY toYYYYMM(date)

-- ä½¿ç”¨ç‰©åŒ–è§†å›¾é¢„èšåˆ
CREATE MATERIALIZED VIEW ...

-- å®šæœŸä¼˜åŒ–è¡¨
OPTIMIZE TABLE orders FINAL;
```

## ğŸ”„ æŒç»­éƒ¨ç½²

### ä½¿ç”¨GitHub Actions

åˆ›å»º `.github/workflows/deploy.yml`:

```yaml
name: Deploy

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '18'
      
      - name: Install and Build
        run: |
          npm install
          npm run build
      
      - name: Deploy to Server
        uses: easingthemes/ssh-deploy@v2.1.5
        env:
          SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
          REMOTE_HOST: ${{ secrets.REMOTE_HOST }}
          REMOTE_USER: ${{ secrets.REMOTE_USER }}
          TARGET: /var/www/trading-system/dist
```

## ğŸ“ ç›‘æ§å’Œæ—¥å¿—

### 1. Nginxæ—¥å¿—
```bash
# è®¿é—®æ—¥å¿—
tail -f /var/log/nginx/trading-system-access.log

# é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/trading-system-error.log
```

### 2. ClickHouseæ—¥å¿—
```bash
tail -f /var/log/clickhouse-server/clickhouse-server.log
```

### 3. ç³»ç»Ÿç›‘æ§

```bash
# å®‰è£…ç›‘æ§å·¥å…·
sudo apt-get install -y htop iotop nethogs

# æŸ¥çœ‹èµ„æºä½¿ç”¨
htop
```

## ğŸ†˜ æ•…éšœæ’æŸ¥

### å‰ç«¯æ— æ³•è®¿é—®
```bash
# æ£€æŸ¥NginxçŠ¶æ€
sudo systemctl status nginx

# æ£€æŸ¥Nginxé…ç½®
sudo nginx -t

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

### APIè¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥åç«¯æœåŠ¡
sudo systemctl status trading-backend  # æ ¹æ®å®é™…æœåŠ¡å

# æ£€æŸ¥ç«¯å£ç›‘å¬
sudo netstat -tlnp | grep 8000

# æµ‹è¯•API
curl http://localhost:8000/api/health
```

### ClickHouseé—®é¢˜
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status clickhouse-server

# æŸ¥çœ‹æ—¥å¿—
sudo tail -f /var/log/clickhouse-server/clickhouse-server.log

# æµ‹è¯•è¿æ¥
clickhouse-client --query "SELECT 1"
```

## ğŸ“ è”ç³»æ–¹å¼

éƒ¨ç½²é‡åˆ°é—®é¢˜ï¼Ÿæ£€æŸ¥ï¼š
1. Nginxé”™è¯¯æ—¥å¿—
2. ClickHouseæ—¥å¿—
3. é˜²ç«å¢™é…ç½®
4. åŸŸåDNSè§£æ

---

**éƒ¨ç½²å®Œæˆåè®¿é—®**: https://your-domain.com  
**APIæ–‡æ¡£**: https://your-domain.com/api/docs

