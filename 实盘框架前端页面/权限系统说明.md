# 权限系统使用说明

## 📖 概述

系统现已支持多用户权限管理，包含**超级管理员**和**观摩者**两种角色，实现细粒度的权限控制。

## 👥 用户角色

### 1. 超级管理员 (super_admin)
**拥有所有权限**，可以：
- ✅ 查看所有数据
- ✅ 创建、启动、停止、删除策略
- ✅ 添加、编辑、删除账户
- ✅ 手动下单、取消订单
- ✅ 平仓操作
- ✅ 管理用户（创建、编辑、删除用户）

**测试账号**：
- 用户名：`admin`
- 密码：`admin123`

### 2. 观摩者 (viewer)
**仅查看权限**，可以：
- ✅ 查看所有仪表板数据
- ✅ 查看策略列表和详情
- ✅ 查看账户信息和净值曲线
- ✅ 查看订单列表和详情
- ✅ 查看持仓信息
- ❌ 不能进行任何操作（下单、删除、编辑等）

**测试账号**：
- 用户名：`viewer`
- 密码：`viewer123`

## 🔐 权限列表

### 策略权限
- `strategy:view` - 查看策略
- `strategy:create` - 创建策略
- `strategy:start` - 启动策略
- `strategy:stop` - 停止策略
- `strategy:delete` - 删除策略

### 账户权限
- `account:view` - 查看账户
- `account:create` - 添加账户
- `account:edit` - 编辑账户
- `account:delete` - 删除账户
- `account:sync` - 同步账户

### 订单权限
- `order:view` - 查看订单
- `order:create` - 手动下单
- `order:cancel` - 取消订单

### 持仓权限
- `position:view` - 查看持仓
- `position:close` - 平仓

### 用户管理权限
- `user:view` - 查看用户列表
- `user:create` - 创建用户
- `user:edit` - 编辑用户
- `user:delete` - 删除用户

## 🚀 快速开始

### 1. 登录系统

访问 http://localhost:3000，会自动跳转到登录页面。

**方式一：快速登录**
- 点击页面上的测试账号卡片即可快速登录

**方式二：手动输入**
- 输入用户名和密码
- 点击登录按钮

### 2. 切换用户体验不同权限

建议分别使用两个账号登录体验：

1. **超级管理员**登录后：
   - 可以看到所有菜单（包括"用户管理"）
   - 所有操作按钮都可见
   - 可以添加、编辑、删除等

2. **观摩者**登录后：
   - 看不到"用户管理"菜单
   - 所有操作按钮（如"添加策略"、"手动下单"等）都被隐藏
   - 只能查看数据，无法进行操作

## 💻 开发使用

### 1. 在模板中使用权限指令

```vue
<!-- 单个权限 -->
<el-button v-permission="'strategy:create'">创建策略</el-button>

<!-- 多个权限（任一满足） -->
<el-button v-permission="['order:create', 'order:cancel']">操作</el-button>

<!-- 多个权限（全部满足） -->
<el-button v-permission.all="['order:create', 'order:cancel']">操作</el-button>

<!-- 角色控制 -->
<div v-role="'super_admin'">仅管理员可见</div>
<div v-role="['super_admin', 'viewer']">管理员和观摩者可见</div>
```

### 2. 使用权限组件

```vue
<Permission :permission="'strategy:create'">
  <el-button>创建策略</el-button>
</Permission>

<Permission :permission="['order:create', 'order:cancel']">
  <el-button>批量操作</el-button>
</Permission>

<Permission :permission="['order:create', 'order:cancel']" :require-all="true">
  <el-button>需要所有权限</el-button>
</Permission>
```

### 3. 在代码中检查权限

```javascript
import { useUserStore } from '@/stores/user'

const userStore = useUserStore()

// 检查单个权限
if (userStore.hasPermission('strategy:create')) {
  // 有权限
}

// 检查多个权限（任一满足）
if (userStore.hasAnyPermission(['order:create', 'order:cancel'])) {
  // 有任一权限
}

// 检查多个权限（全部满足）
if (userStore.hasAllPermissions(['order:create', 'order:cancel'])) {
  // 有所有权限
}

// 检查角色
if (userStore.isSuperAdmin) {
  // 是超级管理员
}

if (userStore.isViewer) {
  // 是观摩者
}
```

### 4. 路由权限控制

在路由配置中添加 `meta.permission` 或 `meta.adminOnly`：

```javascript
{
  path: '/strategy',
  component: Strategy,
  meta: {
    title: '策略管理',
    requiresAuth: true,
    permission: 'strategy:view'  // 需要此权限才能访问
  }
}

{
  path: '/users',
  component: UserManagement,
  meta: {
    title: '用户管理',
    requiresAuth: true,
    adminOnly: true  // 仅管理员可访问
  }
}
```

## 🛠️ 用户管理

### 访问用户管理

超级管理员登录后，点击左侧菜单的"用户管理"。

### 创建新用户

1. 点击"添加用户"按钮
2. 填写用户信息：
   - 用户名（唯一，不可修改）
   - 姓名
   - 密码（至少6位）
   - 邮箱
   - 角色（超级管理员/观摩者）
   - 状态（激活/禁用）
3. 点击"创建"按钮

### 编辑用户

1. 在用户列表中点击"编辑"按钮
2. 修改用户信息（不能修改用户名）
3. 点击"保存"按钮

### 重置密码

1. 在用户列表中点击"重置密码"按钮
2. 确认操作
3. 密码将重置为：`123456`

### 删除用户

1. 在用户列表中点击"删除"按钮
2. 确认操作
3. 用户将被永久删除

**注意**：不能删除当前登录的用户

## 🔑 密码管理

### 修改密码

1. 点击右上角用户头像
2. 选择"修改密码"
3. 输入旧密码和新密码
4. 修改成功后需要重新登录

## 📊 权限对照表

| 功能 | 超级管理员 | 观摩者 |
|------|-----------|--------|
| **仪表板** |
| 查看数据 | ✅ | ✅ |
| **策略管理** |
| 查看策略 | ✅ | ✅ |
| 创建策略 | ✅ | ❌ |
| 启动策略 | ✅ | ❌ |
| 停止策略 | ✅ | ❌ |
| 删除策略 | ✅ | ❌ |
| **账户管理** |
| 查看账户 | ✅ | ✅ |
| 添加账户 | ✅ | ❌ |
| 编辑账户 | ✅ | ❌ |
| 删除账户 | ✅ | ❌ |
| 同步账户 | ✅ | ❌ |
| 查看净值曲线 | ✅ | ✅ |
| **订单管理** |
| 查看订单 | ✅ | ✅ |
| 手动下单 | ✅ | ❌ |
| 取消订单 | ✅ | ❌ |
| 批量取消 | ✅ | ❌ |
| **持仓管理** |
| 查看持仓 | ✅ | ✅ |
| 平仓操作 | ✅ | ❌ |
| **用户管理** |
| 访问页面 | ✅ | ❌ |
| 查看用户 | ✅ | ❌ |
| 创建用户 | ✅ | ❌ |
| 编辑用户 | ✅ | ❌ |
| 删除用户 | ✅ | ❌ |

## 🔒 安全建议

1. **定期修改密码**
   - 建议每3个月修改一次密码
   - 密码长度至少8位，包含字母和数字

2. **观摩者账号管理**
   - 为每个观摩者创建独立账号
   - 定期检查不活跃账号并禁用
   - 离职人员及时删除账号

3. **超级管理员账号保护**
   - 超级管理员账号数量应尽量少
   - 不要共享超级管理员账号
   - 定期审查管理员权限

4. **日志审计**
   - 系统记录所有操作日志
   - 定期检查异常操作
   - 保留日志用于追溯

## ❓ 常见问题

### Q1: 忘记密码怎么办？
**A**: 联系超级管理员，请管理员在用户管理页面重置密码。

### Q2: 观摩者能看到哪些数据？
**A**: 观摩者可以查看所有数据（策略、账户、订单、持仓），但不能进行任何操作。

### Q3: 如何添加新角色？
**A**: 需要在代码层面添加：
1. 在 `src/stores/user.js` 中定义新角色
2. 在 `RolePermissions` 中配置角色权限
3. 更新用户管理页面的角色选项

### Q4: 可以临时提升观摩者权限吗？
**A**: 可以，超级管理员在用户管理页面编辑用户，将角色改为"超级管理员"即可。

### Q5: 权限控制是否支持API级别？
**A**: 前端已实现权限控制，后端API也需要实现对应的权限验证，确保双重安全。

## 🔄 升级说明

### Mock数据模式
当前系统使用Mock数据运行，支持完整的登录和权限功能。

### 连接真实后端
当后端实现用户认证接口后：
1. 编辑 `src/stores/user.js`
2. 移除Mock登录逻辑
3. 确保后端提供以下接口：
   - `POST /auth/login` - 登录
   - `POST /auth/logout` - 登出
   - `GET /auth/info` - 获取用户信息
   - `GET /users` - 获取用户列表
   - `POST /users` - 创建用户
   - `PUT /users/:id` - 更新用户
   - `DELETE /users/:id` - 删除用户

## 📞 技术支持

如遇到权限相关问题，请检查：
1. 浏览器控制台是否有错误
2. 用户角色是否正确
3. 权限配置是否正确
4. 是否清除浏览器缓存重新登录

---

**更新日期**: 2024年12月8日  
**版本**: v1.1.0

