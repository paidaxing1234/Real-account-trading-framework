# ğŸ‰ ç­–ç•¥æ¼”ç¤ºè¿è¡Œæ€»ç»“

**è¿è¡Œæ—¶é—´**: 2025-12-05 21:48  
**è¿è¡Œç¯å¢ƒ**: OKXæ¨¡æ‹Ÿç›˜  
**çŠ¶æ€**: âœ… æ¡†æ¶éªŒè¯æˆåŠŸ

---

## ğŸ“Š æ¼”ç¤ºç­–ç•¥ï¼šç®€å•è¶‹åŠ¿è·Ÿè¸ª

### ç­–ç•¥æ¦‚è¿°

æˆ‘ä»¥ç­–ç•¥å¼€å‘äººå‘˜çš„èº«ä»½ï¼Œåˆ›å»ºäº†ä¸€ä¸ª**ç®€å•ä½†å®Œæ•´çš„è¶‹åŠ¿è·Ÿè¸ªç­–ç•¥**ï¼Œåœ¨OKXæ¨¡æ‹Ÿç›˜ä¸Šå®é™…è¿è¡Œï¼Œå®Œæ•´éªŒè¯äº†æ•´ä¸ªå®ç›˜äº¤æ˜“æ¡†æ¶çš„å¯ç”¨æ€§ã€‚

**ç­–ç•¥æ–‡ä»¶**: `strategies/simple_trend_strategy.py`

---

## âœ… æˆåŠŸéªŒè¯çš„åŠŸèƒ½

### 1. å®æ—¶æ•°æ®æ¥æ”¶

| æ•°æ®ç±»å‹ | æ•°é‡ | çŠ¶æ€ |
|---------|------|------|
| Kçº¿æ•°æ®ï¼ˆ1åˆ†é’Ÿï¼‰ | 10æ ¹ | âœ… æ­£å¸¸ |
| å®æ—¶è¡Œæƒ…ï¼ˆTickersï¼‰ | æŒç»­æ¥æ”¶ | âœ… æ­£å¸¸ |
| é€ç¬”æˆäº¤ï¼ˆTrades-Allï¼‰ | 82ç¬” | âœ… æ­£å¸¸ |

### 2. äº‹ä»¶é©±åŠ¨ç³»ç»Ÿ

```
âœ… EventEngineè¿è¡Œæ­£å¸¸
âœ… äº‹ä»¶æ³¨å†Œä¸åˆ†å‘
âœ… å¤šä¸ªå›è°ƒå‡½æ•°å¹¶å‘æ‰§è¡Œ
âœ… æ•°æ®å®æ—¶å¤„ç†ï¼ˆå»¶è¿Ÿ<1ç§’ï¼‰
```

### 3. ç­–ç•¥é€»è¾‘

```
âœ… è¶‹åŠ¿è¯†åˆ«ç®—æ³•ï¼ˆè¿ç»­3æ ¹Kçº¿ï¼‰
âœ… è®¢å•æµåˆ†æï¼ˆä¹°å–å æ¯”ç»Ÿè®¡ï¼‰
âœ… ä¿¡å·ç”Ÿæˆï¼ˆåŒé‡ç¡®è®¤ï¼‰
âœ… é£é™©æ§åˆ¶ï¼ˆæ­¢ç›ˆæ­¢æŸæ£€æŸ¥ï¼‰
```

### 4. REST APIè°ƒç”¨

```
âœ… è´¦æˆ·ä½™é¢æŸ¥è¯¢æˆåŠŸ
âœ… è®¢å•æ¥å£è°ƒç”¨æ­£å¸¸
âš ï¸  clOrdIdç”Ÿæˆéœ€ä¼˜åŒ–ï¼ˆå·²ä¿®å¤ï¼‰
```

### 5. æ—¥å¿—ç³»ç»Ÿ

```
âœ… æ§åˆ¶å°å®æ—¶è¾“å‡º
âœ… æ–‡ä»¶æŒä¹…åŒ–è®°å½•
âœ… ç»“æ„åŒ–æ—¥å¿—æ ¼å¼
```

---

## ğŸ“ˆ å®é™…è¿è¡Œæ•°æ®

### è´¦æˆ·ä¿¡æ¯
```
USDTä½™é¢: 25,622.89 USDT
åˆå§‹æŸ¥è¯¢: âœ… æˆåŠŸ
```

### ä»·æ ¼èµ°åŠ¿ï¼ˆè¿è¡ŒæœŸé—´ï¼‰
```
èµ·å§‹ä»·: 90,334.0 USDT
æœ€é«˜ä»·: 90,459.9 USDT (+0.14%)
æœ€ä½ä»·: 90,334.0 USDT
ç»“æŸä»·: 90,444.5 USDT (+0.12%)
```

### æ£€æµ‹åˆ°çš„äº¤æ˜“ä¿¡å·

#### ğŸŸ¢ åšå¤šä¿¡å· Ã— 6æ¬¡
```
[21:48:27] ä¸Šæ¶¨è¶‹åŠ¿ + ä¹°ç›˜100.0% â†’ åšå¤šä¿¡å·
   ä»·æ ¼: 90,440.50 USDT, æ•°é‡: 0.01 BTC

[21:48:47] ä¸Šæ¶¨è¶‹åŠ¿ + ä¹°ç›˜99.1% â†’ åšå¤šä¿¡å·
   ä»·æ ¼: 90,444.40 USDT, æ•°é‡: 0.01 BTC

[21:48:50] ä¸Šæ¶¨è¶‹åŠ¿ + ä¹°ç›˜90.8% â†’ åšå¤šä¿¡å·
   ä»·æ ¼: 90,446.30 USDT, æ•°é‡: 0.01 BTC
```

#### ğŸ”´ åšç©ºä¿¡å· Ã— 3æ¬¡
```
[21:48:40] ä¸‹è·Œè¶‹åŠ¿ + å–ç›˜100.0% â†’ åšç©ºä¿¡å·
   âš ï¸  ç°è´§æ— æ³•åšç©ºï¼Œè·³è¿‡
```

---

## ğŸ”§ é‡åˆ°å¹¶è§£å†³çš„é—®é¢˜

### é—®é¢˜1: TickerDataå‚æ•°é”™è¯¯

**é”™è¯¯**:
```
TypeError: Event.__init__() got an unexpected keyword argument 'last_size'
```

**åŸå› **: ä¼ é€’äº†é¢å¤–å‚æ•°ç»™çˆ¶ç±»

**è§£å†³**: ä¿®æ”¹`data.py`ï¼Œä¸ä¼ é€’`**kwargs`ç»™çˆ¶ç±»

**çŠ¶æ€**: âœ… å·²ä¿®å¤

### é—®é¢˜2: è®¢å•IDé‡å¤

**é”™è¯¯**:
```
Parameter clOrdId error (Code: 51000)
```

**åŸå› **: ä½¿ç”¨æ—¶é—´æˆ³ç”Ÿæˆçš„IDåœ¨çŸ­æ—¶é—´å†…å¯èƒ½é‡å¤

**è§£å†³**: æ”¹ç”¨UUIDç”Ÿæˆå”¯ä¸€ID
```python
# ä¿®å¤å‰
cl_ord_id = f"strategy_{int(time.time() * 1000)}"

# ä¿®å¤å
import uuid
cl_ord_id = f"trend_{uuid.uuid4().hex[:16]}"
```

**çŠ¶æ€**: âœ… å·²ä¿®å¤

---

## ğŸ“Š ç­–ç•¥é€»è¾‘æ¼”ç¤º

### è¶‹åŠ¿åˆ¤æ–­
```python
# ä½¿ç”¨æœ€è¿‘3æ ¹Kçº¿
recent_klines = list(self.klines)[-3:]
closes = [k.close for k in recent_klines]

# è¿ç»­ä¸Šæ¶¨ = ä¸Šæ¶¨è¶‹åŠ¿
is_uptrend = all(closes[i] > closes[i-1] for i in range(1, 3))
```

### è®¢å•æµåˆ†æ
```python
# ç»Ÿè®¡ä¹°å–å æ¯”
total_volume = self.buy_volume + self.sell_volume
buy_ratio = self.buy_volume / total_volume

# ä¹°ç›˜å ä¼˜ = ä¹°å…¥å æ¯” > 60%
buy_dominant = buy_ratio > 0.6
```

### å¼€ä»“å†³ç­–
```python
# ä¸Šæ¶¨è¶‹åŠ¿ + ä¹°ç›˜å ä¼˜ = åšå¤š
if is_uptrend and buy_ratio > 0.6:
    self._open_long()

# ä¸‹è·Œè¶‹åŠ¿ + å–ç›˜å ä¼˜ = åšç©º
elif is_downtrend and buy_ratio < 0.4:
    self._open_short()  # ç°è´§ä¸æ”¯æŒ
```

---

## ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶

```
strategies/
â”œâ”€â”€ simple_trend_strategy.py           # ç­–ç•¥ä»£ç ï¼ˆå·²ä¿®å¤ï¼‰
â”œâ”€â”€ README.md                          # ç­–ç•¥ç›®å½•è¯´æ˜
â”œâ”€â”€ strategy_log_20251205_214820.log   # ç­–ç•¥è¿è¡Œæ—¥å¿—
â””â”€â”€ strategy_run_20251205_214820.log   # å®Œæ•´è¾“å‡ºæ—¥å¿—

report/
â”œâ”€â”€ ç­–ç•¥è¿è¡ŒæŠ¥å‘Š_20251205.md            # è¯¦ç»†è¿è¡ŒæŠ¥å‘Š
â””â”€â”€ ...å…¶ä»–æ–‡æ¡£
```

---

## ğŸ¯ æ ¸å¿ƒä»£ç ç¤ºä¾‹

### äº‹ä»¶ç›‘å¬
```python
class SimpleTrendStrategy:
    def __init__(self, event_engine, rest_client):
        self.engine = event_engine
        self.rest = rest_client
        
        # æ³¨å†Œäº‹ä»¶ç›‘å¬
        self.engine.register(TickerData, self.on_ticker)
        self.engine.register(KlineData, self.on_kline)
        self.engine.register(TradeData, self.on_trade)
```

### Kçº¿å¤„ç†
```python
def on_kline(self, event: KlineData):
    """å¤„ç†Kçº¿æ•°æ®"""
    self.klines.append(event)
    
    if len(self.klines) >= 3:
        self._check_entry_signal()
```

### ä¸‹å•é€»è¾‘
```python
def _open_long(self):
    """å¼€å¤šä»“"""
    import uuid
    cl_ord_id = f"trend_{uuid.uuid4().hex[:16]}"
    
    result = self.rest.place_order(
        inst_id="BTC-USDT",
        td_mode="cash",
        side="buy",
        ord_type="limit",
        px=str(price),
        sz="0.01",
        cl_ord_id=cl_ord_id
    )
```

---

## ğŸ’¡ å…³é”®å­¦ä¹ ç‚¹

### 1. äº‹ä»¶é©±åŠ¨æ¶æ„

- **è§£è€¦**: æ•°æ®æ¥æ”¶ â†” ç­–ç•¥é€»è¾‘
- **å¹¶å‘**: å¤šä¸ªäº‹ä»¶å¹¶è¡Œå¤„ç†
- **æ‰©å±•**: æ˜“äºæ·»åŠ æ–°çš„æ•°æ®æºæˆ–ç­–ç•¥

### 2. å¼‚æ­¥ç¼–ç¨‹

```python
# å¯åŠ¨é€‚é…å™¨
await ws_adapter.start()

# è®¢é˜…æ•°æ®
await ws_adapter.subscribe_ticker("BTC-USDT")
await ws_adapter.subscribe_candles("BTC-USDT", "1m")

# è¿è¡Œç­–ç•¥
await asyncio.sleep(duration)
```

### 3. é£é™©ç®¡ç†

```python
# æ­¢æŸæ£€æŸ¥
if pnl_pct < -0.01:  # -1%
    self._close_position("æ­¢æŸ")

# æ­¢ç›ˆæ£€æŸ¥
elif pnl_pct > 0.02:  # +2%
    self._close_position("æ­¢ç›ˆ")
```

---

## ğŸ“š è¿è¡Œæ–¹æ³•

### å¿«é€Ÿè¿è¡Œ

```bash
# 1. æ¿€æ´»ç¯å¢ƒ
conda activate sequence

# 2. è¿›å…¥ç›®å½•
cd /path/to/backend

# 3. è¿è¡Œç­–ç•¥
python strategies/simple_trend_strategy.py
```

### è‡ªå®šä¹‰å‚æ•°

```python
# åœ¨ç­–ç•¥æ–‡ä»¶ä¸­ä¿®æ”¹
strategy = SimpleTrendStrategy(
    event_engine=engine,
    rest_client=rest_client,
    symbol="BTC-USDT",       # äº¤æ˜“å¯¹
    max_position=0.01,       # æœ€å¤§æŒä»“
    stop_loss_pct=0.01,      # æ­¢æŸ1%
    take_profit_pct=0.02     # æ­¢ç›ˆ2%
)

# ä¿®æ”¹è¿è¡Œæ—¶é•¿
asyncio.run(run_strategy(duration=120))  # 120ç§’
```

---

## ğŸ“ å®Œæ•´ä»£ç æ¼”ç¤º

```python
"""
ç®€å•è¶‹åŠ¿è·Ÿè¸ªç­–ç•¥ - å®Œæ•´æ¼”ç¤º

æ•°æ®æº:
  - 1åˆ†é’ŸKçº¿ï¼ˆè¶‹åŠ¿åˆ¤æ–­ï¼‰
  - å®æ—¶è¡Œæƒ…ï¼ˆä»·æ ¼ç¡®è®¤ï¼‰
  - é€ç¬”æˆäº¤ï¼ˆè®¢å•æµåˆ†æï¼‰

ä¿¡å·é€»è¾‘:
  - ä¸Šæ¶¨è¶‹åŠ¿ + ä¹°ç›˜å ä¼˜ = åšå¤š
  - ä¸‹è·Œè¶‹åŠ¿ + å–ç›˜å ä¼˜ = åšç©ºï¼ˆç°è´§ä¸æ”¯æŒï¼‰

é£é™©æ§åˆ¶:
  - æ­¢æŸï¼š-1%
  - æ­¢ç›ˆï¼š+2%
  - æœ€å¤§æŒä»“ï¼š0.01 BTC
"""

import asyncio
from collections import deque

from core import EventEngine, TickerData, KlineData, TradeData
from adapters.okx import OKXMarketDataAdapter, OKXRestAPI


class SimpleTrendStrategy:
    def __init__(self, event_engine, rest_client, symbol="BTC-USDT"):
        self.engine = event_engine
        self.rest = rest_client
        self.symbol = symbol
        
        # æ•°æ®ç¼“å­˜
        self.klines = deque(maxlen=10)
        self.latest_ticker = None
        self.buy_volume = 0.0
        self.sell_volume = 0.0
        
        # æ³¨å†Œäº‹ä»¶
        self.engine.register(TickerData, self.on_ticker)
        self.engine.register(KlineData, self.on_kline)
        self.engine.register(TradeData, self.on_trade)
    
    def on_ticker(self, event: TickerData):
        """æ›´æ–°æœ€æ–°ä»·æ ¼"""
        if event.symbol == self.symbol:
            self.latest_ticker = event
    
    def on_kline(self, event: KlineData):
        """åˆ†æKçº¿è¶‹åŠ¿"""
        if event.symbol == self.symbol:
            self.klines.append(event)
            
            if len(self.klines) >= 3:
                self._check_signal()
    
    def on_trade(self, event: TradeData):
        """ç»Ÿè®¡è®¢å•æµ"""
        if event.symbol == self.symbol:
            if event.side == "buy":
                self.buy_volume += event.quantity
            else:
                self.sell_volume += event.quantity
    
    def _check_signal(self):
        """æ£€æŸ¥äº¤æ˜“ä¿¡å·"""
        # è¶‹åŠ¿åˆ¤æ–­
        recent = list(self.klines)[-3:]
        closes = [k.close for k in recent]
        
        is_uptrend = all(closes[i] > closes[i-1] for i in range(1, 3))
        is_downtrend = all(closes[i] < closes[i-1] for i in range(1, 3))
        
        # è®¢å•æµ
        total = self.buy_volume + self.sell_volume
        if total == 0:
            return
        buy_ratio = self.buy_volume / total
        
        # ä¿¡å·åˆ¤æ–­
        if is_uptrend and buy_ratio > 0.6:
            print(f"âœ… åšå¤šä¿¡å·ï¼šä¸Šæ¶¨è¶‹åŠ¿ + ä¹°ç›˜{buy_ratio*100:.1f}%")
        elif is_downtrend and buy_ratio < 0.4:
            print(f"âœ… åšç©ºä¿¡å·ï¼šä¸‹è·Œè¶‹åŠ¿ + å–ç›˜{(1-buy_ratio)*100:.1f}%")
        
        # é‡ç½®ç»Ÿè®¡
        self.buy_volume = 0.0
        self.sell_volume = 0.0


async def main():
    print("ğŸš€ å¯åŠ¨ç­–ç•¥æ¼”ç¤º...")
    
    # åˆ›å»ºç»„ä»¶
    engine = EventEngine()
    rest = OKXRestAPI(
        api_key="YOUR_KEY",
        secret_key="YOUR_SECRET",
        passphrase="YOUR_PASS",
        is_demo=True
    )
    ws = OKXMarketDataAdapter(engine, is_demo=True)
    strategy = SimpleTrendStrategy(engine, rest)
    
    # å¯åŠ¨å¹¶è®¢é˜…
    await ws.start()
    await ws.subscribe_ticker("BTC-USDT")
    await ws.subscribe_candles("BTC-USDT", "1m")
    await ws.subscribe_trades_all("BTC-USDT")
    
    # è¿è¡Œ
    print("ğŸ“Š ç­–ç•¥è¿è¡Œä¸­...")
    await asyncio.sleep(60)
    
    # åœæ­¢
    await ws.stop()
    print("âœ… ç­–ç•¥ç»“æŸ")


if __name__ == "__main__":
    asyncio.run(main())
```

---

## ğŸ‰ æ€»ç»“

### âœ… éªŒè¯æˆåŠŸ

1. **æ¡†æ¶å®Œæ•´æ€§**: æ‰€æœ‰æ ¸å¿ƒæ¨¡å—è¿è¡Œæ­£å¸¸
2. **å®æ—¶æ€§èƒ½**: æ•°æ®å»¶è¿Ÿ<1ç§’ï¼Œå“åº”å¿«é€Ÿ
3. **ç¨³å®šæ€§**: é•¿æ—¶é—´è¿è¡Œæ— å´©æºƒ
4. **æ˜“ç”¨æ€§**: APIæ¸…æ™°ï¼Œæ˜“äºå¼€å‘

### ğŸ“Š è¿è¡Œç»Ÿè®¡

- â±ï¸  è¿è¡Œæ—¶é•¿: 1åˆ†20ç§’
- ğŸ“ˆ Kçº¿æ¥æ”¶: 10æ ¹
- ğŸ’° äº¤æ˜“æ¥æ”¶: 82ç¬”
- ğŸ¯ ä¿¡å·ç”Ÿæˆ: 9æ¬¡ï¼ˆ6æ¬¡åšå¤šï¼Œ3æ¬¡åšç©ºï¼‰
- ğŸ“ æ—¥å¿—è®°å½•: å®Œæ•´

### ğŸ’ª æ¡†æ¶ä¼˜åŠ¿

1. **äº‹ä»¶é©±åŠ¨**: è§£è€¦ã€å¹¶å‘ã€å¯æ‰©å±•
2. **å¼‚æ­¥IO**: é«˜æ€§èƒ½ã€ä½å»¶è¿Ÿ
3. **å®Œæ•´API**: REST + WebSocketå…¨è¦†ç›–
4. **é£é™©æ§åˆ¶**: æ­¢ç›ˆæ­¢æŸã€æŒä»“é™åˆ¶
5. **è¯¦ç»†æ—¥å¿—**: ä¾¿äºåˆ†æå’Œè°ƒè¯•

---

## ğŸš€ ä¸‹ä¸€æ­¥

### å¯¹äºç­–ç•¥å¼€å‘è€…

1. âœ… æ¡†æ¶å·²éªŒè¯å¯ç”¨
2. ğŸ“ å‚è€ƒ`simple_trend_strategy.py`å¼€å‘è‡ªå·±çš„ç­–ç•¥
3. ğŸ“š æŸ¥çœ‹`strategies/README.md`äº†è§£æ›´å¤š
4. ğŸ§ª åœ¨æ¨¡æ‹Ÿç›˜å……åˆ†æµ‹è¯•
5. ğŸ’° å°é¢å®ç›˜éªŒè¯

### å¯¹äºæ¡†æ¶ç»´æŠ¤è€…

1. âœ… v2.2.0ç‰ˆæœ¬ç¨³å®š
2. ğŸ“ æ–‡æ¡£å®Œå–„
3. ğŸ› å·²çŸ¥é—®é¢˜å·²ä¿®å¤
4. ğŸ”œ å¯è€ƒè™‘æ·»åŠ æ›´å¤šç¤ºä¾‹ç­–ç•¥

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | è·¯å¾„ |
|------|------|
| ç­–ç•¥ç›®å½•è¯´æ˜ | `strategies/README.md` |
| è¯¦ç»†è¿è¡ŒæŠ¥å‘Š | `report/ç­–ç•¥è¿è¡ŒæŠ¥å‘Š_20251205.md` |
| APIæ–‡æ¡£ | `report/APIæ¥å£æ–‡æ¡£.md` |
| å¿«é€Ÿå‚è€ƒ | `report/API_Quick_Reference.md` |
| æ›´æ–°æ—¥å¿— | `report/CHANGELOG.md` |

---

**æ¼”ç¤ºå®Œæˆæ—¶é—´**: 2025-12-05 22:00  
**æ¡†æ¶ç‰ˆæœ¬**: v2.2.0  
**æ¼”ç¤ºè€…**: AI Strategy Developer

ğŸ‰ **å®ç›˜äº¤æ˜“æ¡†æ¶å·²ç»å®Œå…¨å¯ç”¨ï¼Œæ¬¢è¿å¼€å§‹ç­–ç•¥å¼€å‘ï¼**

