
🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀
OKX WebSocket 快速验证测试
🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀🚀

================================================================================
📋 测试1: K线频道快速验证（15秒）
================================================================================

✅ 创建WebSocket客户端（business端点）
✅ WebSocket连接成功: wss://wspap.okx.com:8443/ws/v5/business
✅ WebSocket连接成功
📤 发送订阅请求: [{'channel': 'candle1m', 'instId': 'BTC-USDT'}]
✅ 订阅成功: BTC-USDT 1分钟K线

⏳ 等待15秒接收数据...
✅ 订阅成功: {'channel': 'candle1m', 'instId': 'BTC-USDT'}
   收到K线数据: O=91223.3, H=91271.8, L=91223.3, C=91265.4
   收到K线数据: O=91223.3, H=91271.8, L=91223.3, C=91269
   收到K线数据: O=91223.3, H=91271.8, L=91223.3, C=91270

✅ 共收到 5 条K线数据
📤 发送取消订阅请求: [{'channel': 'candle1m', 'instId': 'BTC-USDT'}]
📥 接收消息任务已取消
💓 心跳任务已取消
✅ WebSocket连接已关闭
✅ 测试完成

================================================================================
📋 测试2: 交易频道快速验证（10秒）
================================================================================

✅ 创建WebSocket客户端
✅ WebSocket连接成功: wss://wspap.okx.com:8443/ws/v5/public
✅ WebSocket连接成功
📤 发送订阅请求: [{'channel': 'trades', 'instId': 'BTC-USDT'}]
✅ 订阅成功: BTC-USDT 交易数据

⏳ 等待10秒接收数据...
✅ 订阅成功: {'channel': 'trades', 'instId': 'BTC-USDT'}
   交易: buy 0.0128421 @ 91249.9
   交易: sell 0.00054776 @ 91259.9
   交易: sell 0.00003054 @ 91259.9
   交易: buy 0.00081554 @ 91260.1
   交易: buy 0.00001501 @ 91260.8

✅ 共收到 69 笔交易
📤 发送取消订阅请求: [{'channel': 'trades', 'instId': 'BTC-USDT'}]
📥 接收消息任务已取消
💓 心跳任务已取消
✅ WebSocket连接已关闭
✅ 测试完成

================================================================================
📋 测试3: 适配器集成快速验证（15秒）
================================================================================

✅ 创建EventEngine和适配器
🚀 启动OKX行情数据适配器...
✅ WebSocket连接成功: wss://wspap.okx.com:8443/ws/v5/public
✅ OKX行情数据适配器启动成功
✅ 适配器启动成功
✅ WebSocket连接成功: wss://wspap.okx.com:8443/ws/v5/business
📤 发送订阅请求: [{'channel': 'candle1m', 'instId': 'BTC-USDT'}]
✅ 订阅K线: BTC-USDT (1m)
✅ 订阅K线: BTC-USDT 1m
📤 发送订阅请求: [{'channel': 'trades', 'instId': 'BTC-USDT'}]
✅ 订阅交易数据: BTC-USDT
✅ 订阅交易: BTC-USDT

⏳ 等待15秒接收事件...
✅ 订阅成功: {'channel': 'candle1m', 'instId': 'BTC-USDT'}
   📊 KlineData: BTC-USDT 1m C=91288.4
✅ 订阅成功: {'channel': 'trades', 'instId': 'BTC-USDT'}
   💰 TradeData: BTC-USDT sell 0.01093691 @ 91288.7
   📊 KlineData: BTC-USDT 1m C=91288.7
   📊 KlineData: BTC-USDT 1m C=91288.7
   💰 TradeData: BTC-USDT buy 0.00148588 @ 91290.3
   💰 TradeData: BTC-USDT buy 4.669e-05 @ 91290.4
   💰 TradeData: BTC-USDT buy 9.274e-05 @ 91291.9
   💰 TradeData: BTC-USDT buy 0.00022894 @ 91292.9

✅ 收到事件: KlineData=9, TradeData=645
🛑 停止OKX行情数据适配器...
📥 接收消息任务已取消
💓 心跳任务已取消
✅ WebSocket连接已关闭
✅ OKX行情数据适配器已停止
✅ 测试完成

================================================================================
📊 测试结果汇总
================================================================================

测试结果:
   K线频道           : ✅ 通过
   交易频道           : ✅ 通过
   适配器集成         : ✅ 通过

总计: 3/3 个测试通过

🎉 所有测试通过！
================================================================================
📥 接收消息任务已取消
💓 心跳任务已取消

