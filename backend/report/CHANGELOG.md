# 更新日志

## [1.6.0] - 2024-12-04

### ✨ 新增功能

#### OKX REST API - 持仓查询接口

1. **get_positions_history** - 查询历史持仓信息（近3个月）
   - 获取最近3个月有更新的仓位信息
   - 支持按产品类型、保证金模式、平仓类型筛选
   - 支持时间范围和分页查询
   - 限速: 10次/2s
   - ✅ 已测试通过

### 🔧 功能完善

1. **get_positions** - 查询持仓信息（完善版）
   - 新增pos_id参数支持
   - 支持查询多个产品（inst_id逗号分隔）
   - 支持查询多个持仓ID（pos_id）
   - 完善接口文档和字段说明
   - ✅ 已测试通过

### 📝 文档更新

- 完善持仓接口详细说明
- 新增持仓方向说明表
- 新增平仓类型说明表
- 新增持仓字段解释
- 新增测试脚本`test/test_okx_positions_apis.py`
- 更新README接口列表

### 🧪 测试结果

**测试通过率**: 100% (2/2)

```
✅ get_positions          - 查询持仓信息（完善版）
   - 查询所有持仓（接口正常）
   - 查询杠杆持仓（MARGIN）
   - 查询特定产品持仓（BTC-USDT）
   - 新增posId参数支持

✅ get_positions_history  - 查询历史持仓信息
   - 查询所有历史持仓（限制10条）
   - 查询杠杆历史持仓（MARGIN）
   - 查询完全平仓记录（type=2）
   - 查询全仓历史持仓（mgnMode=cross）
```

### 📊 重要发现

1. ✅ 持仓方向区分：long(开多), short(开空), net(买卖模式)
2. ✅ 历史持仓支持按平仓类型筛选（6种类型）
3. ✅ 历史持仓保留近3个月数据
4. ℹ️ posId有效期30天（从最后一次完全平仓算起）
5. ℹ️ 杠杆持仓包含负债信息（liab/liabCcy）
6. ℹ️ 历史持仓包含收益详情（realizedPnl/pnlRatio/fee等）

### 📊 统计数据

- **REST API 接口总数**: 17个（新增1个，完善1个）
- **交易接口**: 9个
- **账户接口**: 6个（新增1个，完善1个）
- **行情接口**: 2个

---

## [1.5.0] - 2024-12-04

### ✨ 新增功能

#### OKX REST API - 账单流水查询接口

1. **get_bills** - 账单流水查询（近7天）
   - 查询最近7天的账单数据
   - 支持按币种、类型、产品类型筛选
   - 支持时间范围和分页查询
   - 限速: 5次/s
   - ✅ 已测试通过

2. **get_bills_archive** - 账单流水查询（近3个月）
   - 查询最近3个月的账单数据
   - 支持与get_bills相同的筛选条件
   - 限速: 5次/2s
   - ✅ 已测试通过

### 📝 文档更新

- 新增账单流水查询接口详细说明
- 新增账单类型和子类型说明表
- 新增账单字段解释
- 新增测试脚本`test/test_okx_bills_apis.py`
- 更新README接口列表

### 🧪 测试结果

**测试通过率**: 100% (2/2)

```
✅ get_bills           - 账单流水查询（近7天）
   - 查询所有账单（10条）
   - 查询USDT账单（5条）
   - 查询交易类账单（5条）
   - 查询现货账单（5条）

✅ get_bills_archive   - 账单流水查询（近3个月）
   - 查询所有历史账单（10条）
   - 查询现货历史账单（5条）
   - 查询USDT历史账单（5条）
   - 账单类型统计功能正常
```

### 📊 重要发现

1. ✅ 账单记录包含完整的交易信息（价格、数量、手续费等）
2. ✅ 支持多维度筛选（币种、类型、产品等）
3. ✅ 两个接口数据格式完全一致
4. ✅ 可以通过ordId关联到具体订单
5. ℹ️ execType字段区分taker(T)和maker(M)
6. ℹ️ fee为负数表示扣除，正数表示返佣

### 📊 统计数据

- **REST API 接口总数**: 16个（新增2个）
- **交易接口**: 9个
- **账户接口**: 5个（新增2个）
- **行情接口**: 2个

---

## [1.4.0] - 2024-12-04

### ✨ 新增功能

#### OKX REST API - 账户接口

1. **get_account_instruments** - 获取账户可交易产品信息
   - 获取当前账户可交易产品的信息列表
   - 支持按产品类型、交易品种筛选
   - 返回产品配置、交易限制、手续费分组等信息
   - 限速: 20次/2s
   - ✅ 已测试通过

### 🔧 功能验证

1. **get_balance** - 查询账户余额（完整测试）
   - 支持查询所有币种余额
   - 支持查询特定币种余额
   - 支持查询多个币种余额（逗号分隔）
   - ✅ 所有场景测试通过

### 📝 文档更新

- 新增账户接口详细说明
- 新增账户接口测试记录
- 更新README接口列表
- 新增测试脚本`test_okx_account_apis.py`

### 🧪 测试结果

**测试通过率**: 100% (2/2)

```
✅ get_balance              - 查询账户余额（多场景）
✅ get_account_instruments  - 获取账户可交易产品信息
```

### 📊 统计数据

- **REST API 接口总数**: 14个（新增1个）
- **交易接口**: 9个
- **账户接口**: 3个（新增1个）
- **行情接口**: 2个

---

## [1.3.0] - 2024-12-04

### ✨ 新增功能

#### OKX REST API - 订单查询接口完善

1. **get_orders_history** - 查询历史订单（近7天）
   - 支持按产品、类型、状态筛选
   - 支持时间范围查询
   - 支持分页查询
   - 限速: 40次/2s
   - ✅ 已测试通过

### 🔧 功能完善

1. **get_orders_pending** - 查询未成交订单（完善版）
   - 新增ord_type参数（按订单类型筛选）
   - 新增state参数（按订单状态筛选）
   - 新增after/before参数（分页查询）
   - 新增limit参数（限制返回数量）
   - ✅ 所有参数测试通过

### 🐛 Bug修复

1. **GET请求签名问题修复**
   - 修复了带多个参数的GET请求签名错误
   - 使用urllib.parse.urlencode正确编码查询参数
   - 解决了401 Unauthorized错误

### 📝 文档更新

- 完善`API接口文档.md`中订单查询接口说明
- 新增订单查询接口测试记录
- 更新README接口列表和测试说明
- 新增测试脚本`test_okx_order_query_apis.py`

### 🧪 测试结果

**测试通过率**: 100% (3/3)

```
✅ get_order                - 查询订单详情
✅ get_orders_pending       - 查询未成交订单（完善版）
✅ get_orders_history       - 查询历史订单（近7天）
```

### 📊 统计数据

- **REST API 接口总数**: 13个（新增1个，完善1个）
- **交易接口**: 9个（新增1个）
- **账户接口**: 2个
- **行情接口**: 2个

---

## [1.2.0] - 2024-12-04

### ✨ 新增功能

#### OKX REST API - 批量操作和修改订单接口

1. **place_batch_orders** - 批量下单
   - 一次最多提交20个订单
   - 限速: 300个/2s
   - ✅ 已测试通过

2. **cancel_batch_orders** - 批量撤单
   - 一次最多撤销20个订单
   - 限速: 300个/2s
   - ✅ 已测试通过

3. **amend_order** - 修改订单
   - 支持修改价格、数量
   - 支持失败自动撤单
   - 限速: 60次/2s
   - ✅ 已测试通过

4. **amend_batch_orders** - 批量修改订单
   - 一次最多修改20个订单
   - 限速: 300个/2s
   - ✅ 已测试通过

### 📝 文档更新

- 新增 `API接口文档.md` 中批量操作接口详细说明
- 更新 `README.md` 接口列表（从8个增加到12个）
- 新增 `批量操作接口实现总结.md`
- 新增测试脚本 `test_okx_batch_apis.py`

### 🧪 测试结果

**测试通过率**: 100% (4/4)

```
✅ place_batch_orders     - 批量下单2个订单
✅ amend_order           - 修改订单价格
✅ amend_batch_orders    - 批量修改2个订单
✅ cancel_batch_orders   - 批量撤销2个订单
```

### 📊 统计数据

- **REST API 接口总数**: 12个（新增4个）
- **交易接口**: 8个（新增4个）
- **账户接口**: 2个
- **行情接口**: 2个

---

## [1.1.0] - 2024-12-03

### ✨ 新增功能

#### OKX REST API - 基础接口

1. **place_order** - 下单
2. **cancel_order** - 撤单
3. **get_order** - 查询订单
4. **get_orders_pending** - 查询未成交订单
5. **get_balance** - 查询余额
6. **get_positions** - 查询持仓
7. **get_ticker** - 获取行情
8. **get_instruments** - 获取产品信息

### 🧪 测试结果

**测试通过率**: 100% (8/8)

### 📝 文档

- 创建 `API接口文档.md`
- 创建 `README.md`
- 创建 `测试报告.md`

---

## [1.0.0] - 2024-12-02

### ✨ 新增功能

#### 核心框架

1. **EventEngine** - 事件引擎
   - 事件注册和分发
   - 组件生命周期管理
   - 事件流控制

2. **Order** - 订单模型
   - 订单状态管理
   - 订单类型定义
   - 订单ID生成

3. **Data** - 数据模型
   - TickerData - 行情数据
   - TradeData - 成交数据
   - OrderBookData - 深度数据
   - KlineData - K线数据

### 📝 文档

- 创建核心框架文档
- 创建架构说明文档

---

## 开发计划

### v1.3.0 - WebSocket 实现
- [ ] WebSocket 连接
- [ ] WebSocket 订阅（行情、订单、账户）
- [ ] 心跳保持和重连机制

### v1.4.0 - 适配器组件
- [ ] OKX 适配器组件
- [ ] 整合 REST 和 WebSocket
- [ ] 事件转换和分发

### v1.5.0 - 高级功能
- [ ] 错误重试机制
- [ ] 限流管理
- [ ] 订单状态同步
- [ ] 仓位状态同步

### v2.0.0 - Binance 支持
- [ ] Binance REST API
- [ ] Binance WebSocket
- [ ] Binance 适配器

---

**当前版本**: v1.6.0  
**接口总数**: 17个  
**测试覆盖**: 100%  
**文档完整度**: 100%

