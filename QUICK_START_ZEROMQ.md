# ZeroMQ å®ç›˜æ¡†æ¶å¿«é€Ÿå¼€å§‹

## ğŸ“¦ å®‰è£…ä¾èµ–

### C++ ä¾èµ–

```bash
# macOS
brew install zeromq cppzmq nlohmann-json curl openssl

# Ubuntu/Debian
sudo apt-get install libzmq3-dev nlohmann-json3-dev libcurl4-openssl-dev libssl-dev
```

### Python ä¾èµ–

```bash
pip install pyzmq
```

## ğŸ”¨ ç¼–è¯‘

```bash
# è¿›å…¥ cpp ç›®å½•
cd Real-account-trading-framework/cpp

# åˆ›å»ºæ„å»ºç›®å½•
mkdir -p build && cd build

# é…ç½®
cmake ..

# ç¼–è¯‘
make -j4
```

ç¼–è¯‘æˆåŠŸåä¼šç”Ÿæˆï¼š
- `trading_server` - å®ç›˜æœåŠ¡å™¨

## ğŸš€ è¿è¡Œ

### ç¬¬ä¸€æ­¥ï¼šå¯åŠ¨ C++ æœåŠ¡å™¨

```bash
# åœ¨ç»ˆç«¯ 1
cd cpp/build
./trading_server
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
========================================
    Sequence å®ç›˜äº¤æ˜“æœåŠ¡å™¨
    ZeroMQ IPC æ¶æ„
========================================

[é…ç½®] äº¤æ˜“æ¨¡å¼: æ¨¡æ‹Ÿç›˜
[åˆå§‹åŒ–] OKX REST API å·²åˆ›å»º
[ZmqServer] åˆå§‹åŒ–å®Œæˆ
[ZmqServer] è¡Œæƒ…é€šé“å·²ç»‘å®š: ipc:///tmp/trading_md.ipc
[ZmqServer] è®¢å•é€šé“å·²ç»‘å®š: ipc:///tmp/trading_order.ipc
[ZmqServer] å›æŠ¥é€šé“å·²ç»‘å®š: ipc:///tmp/trading_report.ipc
[ZmqServer] æœåŠ¡å·²å¯åŠ¨
...

========================================
  æœåŠ¡å™¨å¯åŠ¨å®Œæˆï¼
  ç­‰å¾…ç­–ç•¥è¿æ¥...
  æŒ‰ Ctrl+C åœæ­¢
========================================

[è¡Œæƒ…çº¿ç¨‹] å¯åŠ¨ï¼ˆæ¨¡æ‹Ÿæ¨¡å¼ï¼‰
[è®¢å•çº¿ç¨‹] å¯åŠ¨
[è¡Œæƒ…] BTC-USDT | ä»·æ ¼: 43005.30 | ç´¯è®¡: 10
```

### ç¬¬äºŒæ­¥ï¼šå¯åŠ¨ Python ç­–ç•¥

```bash
# åœ¨ç»ˆç«¯ 2
cd python/strategies
python simple_strategy.py
```

æˆ–è€…ä½¿ç”¨åŠ¨é‡ç­–ç•¥ï¼š

```bash
python momentum_strategy.py
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
========================================
  ç®€å•ç­–ç•¥ - æµ‹è¯•ç”¨
========================================

ç¡®ä¿ C++ äº¤æ˜“æœåŠ¡å™¨ (trading_server) å·²å¯åŠ¨ï¼

[simple_test] ========================================
[simple_test] ç®€å•ç­–ç•¥å¯åŠ¨
[simple_test]   è®¢å•é—´éš”: æ¯ 10 æ¡è¡Œæƒ…
[simple_test] ========================================
[simple_test] [è¡Œæƒ…] BTC-USDT | ä»·æ ¼: 43012.50 | ä¹°ä¸€: 43012.00 | å–ä¸€: 43013.00 | ä»·å·®: 1.00
[simple_test] [äº¤æ˜“] å‘é€æµ‹è¯•è®¢å• #1
[simple_test]          è®¢å•ID: simple_test_1702000000000_1234
[simple_test]          ä¹°å…¥ 0.001 @ 42012.00
[simple_test] [å›æŠ¥] âœ“ ID: simple_test_... | çŠ¶æ€: accepted | äº¤æ˜“æ‰€ID: 12345678
```

### ç¬¬ä¸‰æ­¥ï¼šå¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªç­–ç•¥ï¼

```bash
# ç»ˆç«¯ 3
python momentum_strategy.py

# ç»ˆç«¯ 4
python another_strategy.py
```

æ¯ä¸ªç­–ç•¥éƒ½æ˜¯ç‹¬ç«‹è¿›ç¨‹ï¼Œäº’ä¸å½±å“ã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

```
Real-account-trading-framework/
â”œâ”€â”€ cpp/
â”‚   â”œâ”€â”€ server/
â”‚   â”‚   â”œâ”€â”€ zmq_server.h          # ZeroMQ æœåŠ¡ç«¯å°è£…
â”‚   â”‚   â”œâ”€â”€ zmq_server.cpp        # å®ç°
â”‚   â”‚   â””â”€â”€ trading_server.cpp    # ä¸»ç¨‹åº
â”‚   â”œâ”€â”€ adapters/okx/             # OKX API é€‚é…å™¨
â”‚   â””â”€â”€ CMakeLists.txt
â”‚
â”œâ”€â”€ python/
â”‚   â”œâ”€â”€ trading_client/           # Python å®¢æˆ·ç«¯åº“
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ client.py             # å®¢æˆ·ç«¯ä¸»ç±»
â”‚   â”‚   â”œâ”€â”€ strategy.py           # ç­–ç•¥åŸºç±»
â”‚   â”‚   â””â”€â”€ models.py             # æ•°æ®æ¨¡å‹
â”‚   â”‚
â”‚   â””â”€â”€ strategies/               # ç¤ºä¾‹ç­–ç•¥
â”‚       â”œâ”€â”€ simple_strategy.py    # ç®€å•æµ‹è¯•ç­–ç•¥
â”‚       â””â”€â”€ momentum_strategy.py  # åŠ¨é‡ç­–ç•¥
â”‚
â””â”€â”€ QUICK_START_ZEROMQ.md         # æœ¬æ–‡æ¡£
```

## ğŸ’¡ åˆ›å»ºè‡ªå·±çš„ç­–ç•¥

```python
from trading_client import TradingClient, Strategy, TickerData, OrderReport

class MyStrategy(Strategy):
    def __init__(self):
        super().__init__()
        self.position = 0.0
    
    def on_ticker(self, data: TickerData):
        """æ”¶åˆ°è¡Œæƒ…æ—¶è°ƒç”¨"""
        # ä½ çš„ç­–ç•¥é€»è¾‘
        if data.last_price > 45000 and self.position == 0:
            self.buy_limit(data.symbol, 0.001, data.bid_price)
    
    def on_order(self, report: OrderReport):
        """æ”¶åˆ°è®¢å•å›æŠ¥æ—¶è°ƒç”¨"""
        if report.is_success():
            self.position += 0.001
            self.log(f"ä¹°å…¥æˆåŠŸï¼ŒæŒä»“: {self.position}")

if __name__ == "__main__":
    client = TradingClient(strategy_id="my_strategy")
    client.run(MyStrategy())
```

## ğŸ“Š æ¶æ„è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    C++ Trading Server                       â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ OKX WebSocketâ”‚    â”‚ OKX REST   â”‚    â”‚ ZmqServer   â”‚     â”‚
â”‚  â”‚   (è¡Œæƒ…)    â”‚    â”‚   (ä¸‹å•)    â”‚    â”‚             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â”‚ PUB è¡Œæƒ…    â”‚     â”‚
â”‚         â”‚                  â”‚            â”‚ PULL è®¢å•   â”‚     â”‚
â”‚         â–¼                  â–¼            â”‚ PUB å›æŠ¥    â”‚     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”‚         ä¸šåŠ¡é€»è¾‘                 â”‚          â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚
                                   IPC (Unix Socket)
                                   å»¶è¿Ÿ: 30-100Î¼s
                                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Python ç­–ç•¥                  â”‚            â”‚
â”‚                                                â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚            â”‚
â”‚  â”‚        TradingClient            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  â”‚                                 â”‚                       â”‚
â”‚  â”‚  SUB è¡Œæƒ…  PUSH è®¢å•  SUB å›æŠ¥  â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                 â”‚                                          â”‚
â”‚                 â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚           Strategy              â”‚                       â”‚
â”‚  â”‚                                 â”‚                       â”‚
â”‚  â”‚  on_ticker()  on_order()        â”‚                       â”‚
â”‚  â”‚  buy_limit()  sell_limit()      â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âš¡ å»¶è¿Ÿè¯´æ˜

| ç¯èŠ‚ | å»¶è¿Ÿ |
|------|------|
| IPC é€šä¿¡ (è¡Œæƒ…/è®¢å•) | 30-100Î¼s |
| OKX API (ä¸‹å•) | 200-500ms |
| æ€»ç«¯åˆ°ç«¯å»¶è¿Ÿ | ä¸»è¦å–å†³äº OKX |

IPC å»¶è¿Ÿå¯ä»¥å¿½ç•¥ï¼ŒçœŸæ­£çš„ç“¶é¢ˆæ˜¯äº¤æ˜“æ‰€çš„ç½‘ç»œå»¶è¿Ÿã€‚

## ğŸ”§ å¸¸è§é—®é¢˜

### Q: è¿æ¥å¤±è´¥ï¼Ÿ
A: ç¡®ä¿ C++ æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œæ£€æŸ¥ `/tmp/trading_*.ipc` æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚

### Q: å¦‚ä½•åˆ‡æ¢åˆ°å®ç›˜ï¼Ÿ
A: ä¿®æ”¹ `trading_server.cpp` ä¸­çš„ `is_testnet = false`ï¼Œå¹¶è®¾ç½®çœŸå®çš„ API Keyã€‚

### Q: å¦‚ä½•æ·»åŠ çœŸå®è¡Œæƒ…ï¼Ÿ
A: å°† `simulate_market_data()` æ›¿æ¢ä¸ºçœŸå®çš„ WebSocket è¡Œæƒ…æ¥æ”¶é€»è¾‘ã€‚

---

**æç¤º**: å¼€å‘æ—¶å»ºè®®ä½¿ç”¨æ¨¡æ‹Ÿç›˜ï¼Œé¿å…èµ„é‡‘æŸå¤±ï¼

