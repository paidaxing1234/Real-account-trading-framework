# å‰ç«¯æ¥å…¥ä»£ç ç»„ç»‡æŒ‡å—

> ğŸ¯ **å¦‚ä½•åœ¨ C++ äº¤æ˜“æ¡†æ¶ä¸­æ¥å…¥å‰ç«¯ç•Œé¢**

---

## ğŸ“‚ ä»£ç ä½ç½®æ€»è§ˆ

```
cpp/
â”œâ”€â”€ core/
â”‚   â””â”€â”€ websocket_server.h           â† âœ… WebSocketæœåŠ¡å™¨æ ¸å¿ƒç±»ï¼ˆå·²å­˜åœ¨ï¼‰
â”‚
â”œâ”€â”€ examples/
â”‚   â””â”€â”€ websocket_vue_example.cpp    â† âœ… ç®€å•ç¤ºä¾‹ï¼šç‹¬ç«‹çš„å‰ç«¯æœåŠ¡å™¨ï¼ˆå·²åˆ›å»ºï¼‰
â”‚
â””â”€â”€ server/
    â”œâ”€â”€ trading_server.cpp           â† åŸæœ‰ï¼šäº¤æ˜“æœåŠ¡å™¨ï¼ˆæ— å‰ç«¯ï¼‰
    â””â”€â”€ trading_server_with_ui.cpp   â† âœ… å®Œæ•´ç‰ˆï¼šé›†æˆå‰ç«¯çš„äº¤æ˜“æœåŠ¡å™¨ï¼ˆå·²åˆ›å»ºï¼‰
```

---

## ğŸš€ æ–¹æ¡ˆé€‰æ‹©

### **æ–¹æ¡ˆä¸€ï¼šç‹¬ç«‹çš„å‰ç«¯æœåŠ¡å™¨ï¼ˆæ¨èå…¥é—¨ï¼‰** â­

**æ–‡ä»¶ä½ç½®**ï¼š`examples/websocket_vue_example.cpp`

**é€‚ç”¨åœºæ™¯**ï¼š
- å­¦ä¹ å’Œæµ‹è¯•
- å¿«é€ŸåŸå‹å¼€å‘
- å‰ç«¯åŠŸèƒ½æ¼”ç¤º
- ä¸äº¤æ˜“é€»è¾‘è§£è€¦

**ç‰¹ç‚¹**ï¼š
- âœ… ç®€å•æ˜“æ‡‚ï¼Œä»£ç æ¸…æ™°
- âœ… ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ–çœŸå®äº¤æ˜“
- âœ… æ¨¡æ‹Ÿæ•°æ®ï¼Œæ–¹ä¾¿è°ƒè¯•
- âŒ ä¸è¿æ¥çœŸå®äº¤æ˜“æ‰€

**ç¼–è¯‘è¿è¡Œ**ï¼š
```bash
# ä½¿ç”¨æä¾›çš„è„šæœ¬
cd /home/llx/Real-account-trading-framework/cpp
./examples/build_websocket_server.sh

# æˆ–æ‰‹åŠ¨ç¼–è¯‘
g++ -std=c++17 -O3 -I./core -I./external/include \
    examples/websocket_vue_example.cpp -o examples/ws_vue_server \
    -lboost_system -lpthread

# è¿è¡Œ
./examples/ws_vue_server
```

**ä»£ç ç»“æ„**ï¼š
```cpp
// ä¸»è¦åŠŸèƒ½
int main() {
    WebSocketServer server;
    
    // 1. è®¾ç½®æ¶ˆæ¯å›è°ƒ
    server.set_message_callback(handle_command);
    
    // 2. è®¾ç½®å¿«ç…§ç”Ÿæˆå™¨
    server.set_snapshot_generator(generate_snapshot);
    
    // 3. å¯åŠ¨æœåŠ¡å™¨
    server.start("0.0.0.0", 8001);
    
    // 4. ä¸»å¾ªç¯
    while (running) { ... }
}
```

---

### **æ–¹æ¡ˆäºŒï¼šé›†æˆåˆ°äº¤æ˜“æœåŠ¡å™¨ï¼ˆæ¨èç”Ÿäº§ï¼‰** ğŸ†

**æ–‡ä»¶ä½ç½®**ï¼š`server/trading_server_with_ui.cpp`

**é€‚ç”¨åœºæ™¯**ï¼š
- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- çœŸå®äº¤æ˜“ç›‘æ§
- å®Œæ•´åŠŸèƒ½å±•ç¤º
- ä¸OKXäº¤æ˜“æ‰€å¯¹æ¥

**ç‰¹ç‚¹**ï¼š
- âœ… åŠŸèƒ½å®Œæ•´ï¼Œè¿æ¥çœŸå®äº¤æ˜“æ‰€
- âœ… ç»Ÿä¸€ç®¡ç†ï¼Œæ˜“äºéƒ¨ç½²
- âœ… å®æ—¶æ•°æ®ï¼ŒçœŸå®è®¢å•
- âš ï¸ éœ€è¦é…ç½®APIå¯†é’¥

**ç¼–è¯‘è¿è¡Œ**ï¼š
```bash
# ç¼–è¯‘
g++ -std=c++17 -O3 \
    -I./core -I./adapters -I./strategies -I./utils -I./external/include \
    server/trading_server_with_ui.cpp \
    adapters/okx/okx_rest_api.cpp \
    adapters/okx/okx_websocket.cpp \
    -o server/trading_server_ui \
    -lboost_system -lpthread -lssl -lcrypto -lcurl

# é…ç½®APIå¯†é’¥
export OKX_API_KEY="your_api_key"
export OKX_SECRET_KEY="your_secret_key"
export OKX_PASSPHRASE="your_passphrase"

# è¿è¡Œ
./server/trading_server_ui
```

**ä»£ç ç»“æ„**ï¼š
```cpp
// å®Œæ•´é›†æˆ
int main() {
    // 1. åˆå§‹åŒ–äº‹ä»¶å¼•æ“
    EventEngine engine;
    
    // 2. åˆå§‹åŒ–OKXè¿æ¥
    OKXRestAPI okx_rest(...);
    OKXWebSocket okx_ws(...);
    
    // 3. åˆå§‹åŒ–å‰ç«¯WebSocketæœåŠ¡å™¨
    WebSocketServer frontend_server;
    frontend_server.start("0.0.0.0", 8001);
    
    // 4. å¤„ç†å‰ç«¯å‘½ä»¤ â†’ è°ƒç”¨OKX API
    handle_frontend_command(command) {
        if (action == "place_order") {
            okx_rest.place_order(...);
        }
    }
    
    // 5. OKXæ¨é€ â†’ è½¬å‘ç»™å‰ç«¯
    okx_ws.set_order_callback([&](order) {
        frontend_server.send_event("order_update", order);
    });
}
```

---

## ğŸ’¡ ä»£ç ç¼–å†™å»ºè®®

### **å¦‚æœä½ è¦æ·»åŠ æ–°åŠŸèƒ½ï¼Œä»£ç åº”è¯¥å†™åœ¨å“ªé‡Œï¼Ÿ**

#### 1. **åªæ˜¯å‰ç«¯å±•ç¤ºï¼ˆæ— äº¤æ˜“é€»è¾‘ï¼‰**
â¡ï¸ ä¿®æ”¹ `examples/websocket_vue_example.cpp`

```cpp
// æ·»åŠ æ–°çš„å‘½ä»¤å¤„ç†
void handle_command(int client_id, const json& message, WebSocketServer& server) {
    std::string action = message["action"];
    
    // ğŸ‘‡ åœ¨è¿™é‡Œæ·»åŠ ä½ çš„æ–°å‘½ä»¤
    if (action == "get_statistics") {
        json stats = {
            {"total_trades", 100},
            {"win_rate", 0.65}
        };
        server.send_response(client_id, true, "æˆåŠŸ");
        server.send_event("statistics", stats);
    }
}
```

#### 2. **éœ€è¦çœŸå®äº¤æ˜“åŠŸèƒ½**
â¡ï¸ ä¿®æ”¹ `server/trading_server_with_ui.cpp`

```cpp
void handle_frontend_command(int client_id, const json& message) {
    std::string action = message["action"];
    
    // ğŸ‘‡ åœ¨è¿™é‡Œæ·»åŠ çœŸå®çš„äº¤æ˜“å‘½ä»¤
    if (action == "place_order") {
        // è°ƒç”¨OKX REST API
        auto response = g_state.okx_rest->place_order(...);
        
        // æ¨é€ç»“æœç»™å‰ç«¯
        g_state.frontend_server->send_event("order_placed", response);
    }
}
```

#### 3. **æ–°å¢è‡ªå®šä¹‰ç­–ç•¥**
â¡ï¸ åˆ›å»ºæ–°æ–‡ä»¶ `strategies/my_strategy.h`

```cpp
// strategies/my_strategy.h
#pragma once
#include "strategy_base.h"

class MyStrategy : public StrategyBase {
public:
    MyStrategy() : StrategyBase("MyStrategy") {}
    
    virtual void on_ticker(const TickerData::Ptr& ticker) override {
        // ä½ çš„ç­–ç•¥é€»è¾‘
    }
};
```

ç„¶ååœ¨ `trading_server_with_ui.cpp` ä¸­æ³¨å†Œï¼š
```cpp
#include "strategies/my_strategy.h"

// åœ¨main()å‡½æ•°ä¸­
g_state.strategies["my_strategy_1"] = std::make_unique<MyStrategy>();
```

#### 4. **ä¿®æ”¹æ¶ˆæ¯åè®®**
â¡ï¸ ä¿®æ”¹ `core/websocket_server.h` ä¸­çš„æ–¹æ³•

```cpp
// æ·»åŠ æ–°çš„æ¶ˆæ¯ç±»å‹
void send_alert(const std::string& level, const std::string& message) {
    json alert = {
        {"type", "alert"},
        {"level", level},
        {"message", message},
        {"timestamp", get_timestamp_ms()}
    };
    broadcast(alert);
}
```

---

## ğŸ“ æ¨èçš„æ–‡ä»¶ç»„ç»‡ç»“æ„

```
cpp/
â”œâ”€â”€ core/                              # æ ¸å¿ƒæ¡†æ¶ï¼ˆä¸è¦ä¿®æ”¹ï¼‰
â”‚   â”œâ”€â”€ websocket_server.h             # WebSocketæœåŠ¡å™¨åŸºç±»
â”‚   â”œâ”€â”€ event_engine.h                 # äº‹ä»¶å¼•æ“
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ examples/                          # ç¤ºä¾‹å’Œæµ‹è¯•
â”‚   â”œâ”€â”€ websocket_vue_example.cpp      # âœï¸ å‰ç«¯æ¼”ç¤ºï¼ˆå¯ä¿®æ”¹ï¼‰
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ server/                            # æœåŠ¡å™¨ç¨‹åº
â”‚   â”œâ”€â”€ trading_server.cpp             # åŸæœ‰äº¤æ˜“æœåŠ¡å™¨
â”‚   â”œâ”€â”€ trading_server_with_ui.cpp     # âœï¸ å¸¦UIçš„äº¤æ˜“æœåŠ¡å™¨ï¼ˆå¯ä¿®æ”¹ï¼‰
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ strategies/                        # ç­–ç•¥ç›®å½•
â”‚   â”œâ”€â”€ strategy_base.h                # ç­–ç•¥åŸºç±»ï¼ˆä¸è¦ä¿®æ”¹ï¼‰
â”‚   â”œâ”€â”€ demo_strategy.h                # ç¤ºä¾‹ç­–ç•¥
â”‚   â””â”€â”€ my_strategy.h                  # âœï¸ ä½ çš„ç­–ç•¥ï¼ˆæ·»åŠ æ–°æ–‡ä»¶ï¼‰
â”‚
â””â”€â”€ adapters/                          # äº¤æ˜“æ‰€é€‚é…å™¨ï¼ˆä¸€èˆ¬ä¸ä¿®æ”¹ï¼‰
    â””â”€â”€ okx/
        â”œâ”€â”€ okx_rest_api.h
        â””â”€â”€ okx_websocket.h
```

---

## ğŸ¨ å‰ç«¯ç•Œé¢å¼€å‘æµç¨‹

### æ­¥éª¤1ï¼šå¯åŠ¨C++åç«¯
```bash
# æ–¹å¼Aï¼šä½¿ç”¨ç®€å•ç¤ºä¾‹
cd /home/llx/Real-account-trading-framework/cpp
./examples/ws_vue_server

# æ–¹å¼Bï¼šä½¿ç”¨å®Œæ•´æœåŠ¡å™¨
./server/trading_server_ui
```

### æ­¥éª¤2ï¼šå¯åŠ¨Vueå‰ç«¯
```bash
cd /home/llx/Real-account-trading-framework/å®ç›˜æ¡†æ¶å‰ç«¯é¡µé¢
npm run dev
```

### æ­¥éª¤3ï¼šåœ¨æµè§ˆå™¨ä¸­è®¿é—®
```
http://localhost:5173
```

### æ­¥éª¤4ï¼šæŸ¥çœ‹WebSocketè¿æ¥çŠ¶æ€
- æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
- Network â†’ WS â†’ æŸ¥çœ‹è¿æ¥å’Œæ¶ˆæ¯

---

## ğŸ”§ å¸¸è§ä»»åŠ¡çš„ä»£ç ä½ç½®

| ä»»åŠ¡ | æ–‡ä»¶ä½ç½® | è¯´æ˜ |
|------|---------|------|
| æ·»åŠ å‰ç«¯å‘½ä»¤å¤„ç† | `examples/websocket_vue_example.cpp` | ä¿®æ”¹ `handle_command()` å‡½æ•° |
| ä¿®æ”¹å¿«ç…§æ•°æ®æ ¼å¼ | `examples/websocket_vue_example.cpp` | ä¿®æ”¹ `generate_snapshot()` å‡½æ•° |
| æ¥å…¥çœŸå®OKX API | `server/trading_server_with_ui.cpp` | ä¿®æ”¹ `handle_frontend_command()` |
| æ·»åŠ æ–°çš„ç­–ç•¥ | `strategies/my_strategy.h` | ç»§æ‰¿ `StrategyBase` ç±» |
| ä¿®æ”¹WebSocketç«¯å£ | `main()` å‡½æ•°ä¸­ | ä¿®æ”¹ `server.start("0.0.0.0", 8001)` |
| è°ƒæ•´å¿«ç…§æ¨é€é¢‘ç‡ | `main()` å‡½æ•°ä¸­ | ä¿®æ”¹ `server.set_snapshot_interval(100)` |
| æ·»åŠ æ–°çš„æ¶ˆæ¯ç±»å‹ | `core/websocket_server.h` | æ·»åŠ  `send_xxx()` æ–¹æ³• |

---

## ğŸ“š ç¤ºä¾‹ä»£ç ç‰‡æ®µ

### æ·»åŠ è‡ªå®šä¹‰å‘½ä»¤
```cpp
// åœ¨ handle_command() æˆ– handle_frontend_command() ä¸­æ·»åŠ 

if (action == "get_risk_metrics") {
    json metrics = {
        {"max_drawdown", 0.05},
        {"sharpe_ratio", 1.8},
        {"win_rate", 0.62}
    };
    
    server.send_response(client_id, true, "æŸ¥è¯¢æˆåŠŸ");
    server.send_event("risk_metrics", metrics);
}
```

### æ·»åŠ å®šæ—¶ä»»åŠ¡
```cpp
// åœ¨ä¸»å¾ªç¯ä¸­æ·»åŠ 

std::thread timer_thread([&]() {
    while (g_running) {
        // æ¯5ç§’å‘é€ä¸€æ¬¡å¿ƒè·³
        server.send_log("info", "ç³»ç»Ÿè¿è¡Œæ­£å¸¸");
        
        std::this_thread::sleep_for(std::chrono::seconds(5));
    }
});
```

### æ·»åŠ é”™è¯¯å¤„ç†
```cpp
try {
    // ä½ çš„ä»£ç 
    auto result = okx_rest->place_order(...);
    
    // æˆåŠŸ
    server.send_response(client_id, true, "æ“ä½œæˆåŠŸ");
    
} catch (const std::exception& e) {
    // å¤±è´¥
    server.send_response(client_id, false, std::string("é”™è¯¯: ") + e.what());
    server.send_log("error", e.what());
}
```

---

## âœ… æ€»ç»“

### **å¿«é€Ÿå¼€å§‹ï¼ˆæ¨èï¼‰**
1. ä½¿ç”¨ `examples/websocket_vue_example.cpp` è¿›è¡Œå­¦ä¹ å’Œæµ‹è¯•
2. è¿è¡Œ `./examples/build_websocket_server.sh` å¿«é€Ÿå¯åŠ¨
3. åœ¨æµè§ˆå™¨ä¸­è®¿é—®å‰ç«¯ç•Œé¢

### **ç”Ÿäº§éƒ¨ç½²ï¼ˆæ¨èï¼‰**
1. ä½¿ç”¨ `server/trading_server_with_ui.cpp` ä½œä¸ºç”Ÿäº§æœåŠ¡å™¨
2. é…ç½®OKX APIå¯†é’¥
3. ç¼–è¯‘å¹¶åå°è¿è¡Œ

### **æ·»åŠ æ–°åŠŸèƒ½**
1. **å‰ç«¯å±•ç¤º** â†’ ä¿®æ”¹ `websocket_vue_example.cpp`
2. **çœŸå®äº¤æ˜“** â†’ ä¿®æ”¹ `trading_server_with_ui.cpp`
3. **æ–°ç­–ç•¥** â†’ åˆ›å»º `strategies/my_strategy.h`
4. **æ–°æ¶ˆæ¯ç±»å‹** â†’ æ‰©å±• `websocket_server.h`

---

## ğŸš€ ä¸‹ä¸€æ­¥

1. âœ… ä»£ç å·²åˆ›å»ºåœ¨æ­£ç¡®ä½ç½®
2. ğŸ“– é˜…è¯» `VUEå‰ç«¯è¿æ¥æŒ‡å—.md` äº†è§£è¯¦ç»†é…ç½®
3. ğŸ§ª è¿è¡Œ `build_websocket_server.sh` æµ‹è¯•
4. ğŸ¨ è¿æ¥Vueå‰ç«¯éªŒè¯åŠŸèƒ½
5. ğŸ’» æ ¹æ®éœ€æ±‚ä¿®æ”¹ä»£ç 

ç¥ä½ å¼€å‘é¡ºåˆ©ï¼ğŸ‰

