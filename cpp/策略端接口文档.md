# Sequence å®ç›˜äº¤æ˜“æ¡†æ¶ - ç­–ç•¥ç«¯æ¥å£æ–‡æ¡£

> ç‰ˆæœ¬: 2.2.0  
> æ›´æ–°æ—¥æœŸ: 2025-12-16  
> è¯´æ˜: æœ¬æ–‡æ¡£æè¿°äº†ç­–ç•¥ç«¯å¯è°ƒç”¨çš„æ‰€æœ‰æ¥å£ï¼ŒåŒ…æ‹¬C++ç«¯å’ŒPythonç«¯

---

## ç›®å½•

1. [æ¶æ„æ¦‚è¿°](#1-æ¶æ„æ¦‚è¿°)
2. [å·²å®ç°çš„OKXæ¥å£æ±‡æ€»](#2-å·²å®ç°çš„okxæ¥å£æ±‡æ€»)
3. [Pythonç­–ç•¥ç«¯æ¥å£](#3-pythonç­–ç•¥ç«¯æ¥å£)
4. [C++ REST APIæ¥å£](#4-c-rest-apiæ¥å£)
5. [C++ WebSocketæ¥å£](#5-c-websocketæ¥å£)
6. [ZeroMQé€šä¿¡åè®®](#6-zeromqé€šä¿¡åè®®)
7. [æ•°æ®ç»“æ„å®šä¹‰](#7-æ•°æ®ç»“æ„å®šä¹‰)
8. [ä½¿ç”¨ç¤ºä¾‹](#8-ä½¿ç”¨ç¤ºä¾‹)

---

## 1. æ¶æ„æ¦‚è¿°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         OKX äº¤æ˜“æ‰€                               â”‚
â”‚     REST API (ä¸‹å•/æ’¤å•/æŸ¥è¯¢)  +  WebSocket (è¡Œæƒ…/è®¢å•æ¨é€)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      C++ Trading Server                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ OKX REST APIâ”‚  â”‚OKX WebSocket â”‚  â”‚     ZmqServer        â”‚   â”‚
â”‚  â”‚  (ä¸‹å•æ‰§è¡Œ)   â”‚  â”‚ (è¡Œæƒ…æ¥æ”¶)   â”‚   â”‚  PUB è¡Œæƒ… (100Î¼s)    â”‚   â”‚
â”‚  â”‚             â”‚  â”‚              â”‚  â”‚  PULL è®¢å•           â”‚   â”‚
â”‚  â”‚             â”‚  â”‚              â”‚  â”‚  PUB å›æŠ¥            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚ IPC (Unix Socket)
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Python Strategy Client                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚TradingClientâ”‚  â”‚   Strategy   â”‚  â”‚       Models         â”‚   â”‚
â”‚  â”‚ (ZMQé€šä¿¡)   â”‚  â”‚  (ç­–ç•¥åŸºç±»)  â”‚  â”‚ TickerData/Order     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é€šä¿¡å»¶è¿Ÿ

| é€šé“ | åè®® | å…¸å‹å»¶è¿Ÿ |
|------|------|----------|
| è¡Œæƒ…åˆ†å‘ | ZeroMQ IPC (PUB-SUB) | 30-100 Î¼s |
| è®¢å•è¯·æ±‚ | ZeroMQ IPC (PUSH-PULL) | 30-100 Î¼s |
| è®¢å•å›æŠ¥ | ZeroMQ IPC (PUB-SUB) | 30-100 Î¼s |
| OKX REST API | HTTPS | 50-200 ms |
| OKX WebSocket | WSS | 10-50 ms |

---

## 2. å·²å®ç°çš„OKXæ¥å£æ±‡æ€»

### 2.0 å®Œæ•´æ¥å£æ¸…å•

#### C++ REST API æ¥å£ï¼ˆå·²å®ç°ï¼‰

| æ¥å£ç±»åˆ« | æ¥å£åç§° | æ–¹æ³• | çŠ¶æ€ |
|---------|---------|------|------|
| **äº¤æ˜“** | ä¸‹å• | `place_order()` | âœ… |
| | é«˜çº§ä¸‹å•ï¼ˆæ”¯æŒæ­¢ç›ˆæ­¢æŸï¼‰ | `place_order_advanced()` | âœ… |
| | å¸¦æ­¢ç›ˆæ­¢æŸä¸‹å• | `place_order_with_tp_sl()` | âœ… |
| | **æ‰¹é‡ä¸‹å•** | **`place_batch_orders()`** | **âœ…** |
| | æ’¤å• | `cancel_order()` | âœ… |
| | æ‰¹é‡æ’¤å• | `cancel_batch_orders()` | âœ… |
| | **ä¿®æ”¹è®¢å•** | **`amend_order()`** | **âœ…** |
| | **æ‰¹é‡ä¿®æ”¹è®¢å•** | **`amend_batch_orders()`** | **âœ…** |
| | æŸ¥è¯¢è®¢å• | `get_order()` | âœ… |
| | æŸ¥è¯¢æœªæˆäº¤è®¢å• | `get_pending_orders()` | âœ… |
| **è´¦æˆ·** | æŸ¥è¯¢è´¦æˆ·ä½™é¢ | `get_account_balance()` | âœ… |
| | æŸ¥è¯¢æŒä»“ä¿¡æ¯ | `get_positions()` | âœ… |
| | æŸ¥è¯¢å¯äº¤æ˜“äº§å“ | `get_account_instruments()` | âœ… |
| **è¡Œæƒ…** | æŸ¥è¯¢Kçº¿æ•°æ® | `get_candles()` | âœ… |

#### C++ WebSocket é¢‘é“ï¼ˆå·²å®ç°ï¼‰

| é¢‘é“åç§° | ç±»å‹ | ç«¯ç‚¹ | æ–¹æ³• | çŠ¶æ€ | ç‰¹æ®Šè¯´æ˜ |
|---------|------|------|------|------|---------|
| **å…¬å…±é¢‘é“** | | | | | |
| tickers | å…¬å…± | public | `subscribe_ticker()` | âœ… | è¡Œæƒ…å¿«ç…§ |
| trades | å…¬å…± | public | `subscribe_trades()` | âœ… | é€ç¬”æˆäº¤ |
| trades-all | å…¬å…± | business | `subscribe_trades_all()` | âœ… | å…¨éƒ¨æˆäº¤ï¼ˆå•æ¡æ¨é€ï¼‰ |
| books/orderbook | å…¬å…± | public | `subscribe_orderbook()` | âœ… | è®¢å•ç°¿æ·±åº¦ |
| candle* | å…¬å…± | **business** | `subscribe_kline()` | âœ… | Kçº¿æ•°æ®ï¼ˆéœ€businessç«¯ç‚¹ï¼‰ |
| open-interest | å…¬å…± | public | `subscribe_open_interest()` | âœ… | æŒä»“æ€»é‡ï¼ˆæ¯3ç§’æ¨é€ï¼‰ |
| mark-price | å…¬å…± | public | `subscribe_mark_price()` | âœ… | æ ‡è®°ä»·æ ¼ï¼ˆå˜åŒ–200msï¼Œå¦åˆ™10sï¼‰ |
| **ç§æœ‰é¢‘é“** | | | | | |
| orders | ç§æœ‰ | private | `subscribe_orders()` | âœ… | è®¢å•çŠ¶æ€æ›´æ–°ï¼ˆåŒ…æ‹¬æˆäº¤ï¼‰ |
| sprd-orders | ç§æœ‰ | **business** | `subscribe_sprd_orders()` | âœ… | Spreadè®¢å•çŠ¶æ€ï¼ˆéœ€businessç«¯ç‚¹+ç™»å½•ï¼‰ |
| sprd-trades | ç§æœ‰ | **business** | `subscribe_sprd_trades()` | âœ… | Spreadæˆäº¤æ•°æ®ï¼ˆéœ€businessç«¯ç‚¹+ç™»å½•ï¼‰ |
| positions | ç§æœ‰ | private | `subscribe_positions()` | âœ… | åˆçº¦/æ æ†æŒä»“ï¼ˆæ”¯æŒextraParamsï¼‰ |
| account | ç§æœ‰ | private | `subscribe_account()` | âœ… | è´¦æˆ·ä½™é¢ï¼ˆæ”¯æŒextraParamsï¼‰ |

**WebSocket ç«¯ç‚¹è¯´æ˜ï¼š**
- `public` (`/ws/v5/public`): å…¬å…±é¢‘é“ï¼Œæ— éœ€ç™»å½•
- `business` (`/ws/v5/business`): ä¸šåŠ¡é¢‘é“ï¼ŒKçº¿ã€trades-allã€Spreadè®¢å•/æˆäº¤éœ€è¦æ­¤ç«¯ç‚¹
- `private` (`/ws/v5/private`): ç§æœ‰é¢‘é“ï¼Œéœ€è¦ç™»å½•ï¼Œç”¨äºè®¢å•ã€æŒä»“ã€è´¦æˆ·

**WebSocket æ¨é€æœºåˆ¶ï¼š**
- **è´¦æˆ·é¢‘é“**ï¼šé¦–æ¬¡è®¢é˜…æ¨é€å¿«ç…§ï¼Œäº‹ä»¶è§¦å‘æ¨é€ï¼Œå®šæ—¶æ¨é€ï¼ˆé»˜è®¤çº¦5ç§’ï¼‰
- **æŒä»“é¢‘é“**ï¼šé¦–æ¬¡è®¢é˜…æ¨é€å¿«ç…§ï¼Œäº‹ä»¶è§¦å‘æ¨é€ï¼Œå®šæ—¶æ¨é€ï¼ˆé»˜è®¤çº¦5ç§’ï¼‰
- **è®¢å•é¢‘é“**ï¼šäº‹ä»¶è§¦å‘æ¨é€ï¼ˆä¸‹å•ã€æ’¤å•ã€æˆäº¤ç­‰ï¼‰
- **Spreadè®¢å•é¢‘é“**ï¼šé¦–æ¬¡è®¢é˜…ä¸æ¨é€ï¼Œåªæœ‰äº‹ä»¶è§¦å‘æ—¶æ‰æ¨é€
- **Spreadæˆäº¤é¢‘é“**ï¼šäº‹ä»¶è§¦å‘æ¨é€ï¼ˆæˆäº¤ã€è¢«æ‹’ç»ï¼‰

### 2.1 äº¤æ˜“æ¥å£ (Trade)

| æ¥å£åç§° | OKX Endpoint | C++ å®ç° | Python å®ç° | çŠ¶æ€ |
|----------|--------------|----------|-------------|------|
| ä¸‹å• | POST /api/v5/trade/order | âœ… `place_order()` | âœ… `place_order()` | âœ… å®Œæˆ |
| **æ‰¹é‡ä¸‹å•** | POST /api/v5/trade/batch-orders | âœ… `place_batch_orders()` | âœ… `place_batch_orders()` | âœ… å®Œæˆ |
| æ’¤å• | POST /api/v5/trade/cancel-order | âœ… `cancel_order()` | âœ… `cancel_order()` | âœ… å®Œæˆ |
| æ‰¹é‡æ’¤å• | POST /api/v5/trade/cancel-batch-orders | âœ… `cancel_batch_orders()` | âœ… `cancel_batch_orders()` | âœ… å®Œæˆ |
| **ä¿®æ”¹è®¢å•** | POST /api/v5/trade/amend-order | âœ… `amend_order()` | âœ… `amend_order()` | âœ… å®Œæˆ |
| **æ‰¹é‡ä¿®æ”¹è®¢å•** | POST /api/v5/trade/amend-batch-orders | âœ… `amend_batch_orders()` | âœ… `amend_batch_orders()` | âœ… å®Œæˆ |
| æŸ¥è¯¢è®¢å• | GET /api/v5/trade/order | âœ… `get_order()` | âœ… `get_order()` | âœ… å®Œæˆ |
| æœªæˆäº¤è®¢å• | GET /api/v5/trade/orders-pending | âœ… `get_pending_orders()` | âœ… `get_orders_pending()` | âœ… å®Œæˆ |
| å†å²è®¢å• | GET /api/v5/trade/orders-history | âŒ | âœ… `get_orders_history()` | Python only |

### 2.2 è´¦æˆ·æ¥å£ (Account)

| æ¥å£åç§° | OKX Endpoint | C++ å®ç° | Python å®ç° | çŠ¶æ€ |
|----------|--------------|----------|-------------|------|
| è´¦æˆ·ä½™é¢ | GET /api/v5/account/balance | âœ… `get_account_balance()` | âœ… `get_balance()` | âœ… å®Œæˆ |
| æŒä»“ä¿¡æ¯ | GET /api/v5/account/positions | âœ… `get_positions()` | âœ… `get_positions()` | âœ… å®Œæˆ |
| å†å²æŒä»“ | GET /api/v5/account/positions-history | âŒ | âœ… `get_positions_history()` | Python only |
| å¯äº¤æ˜“äº§å“ | GET /api/v5/account/instruments | âœ… `get_account_instruments()` | âœ… `get_account_instruments()` | âœ… å®Œæˆ |
| è´¦å•æµæ°´(7å¤©) | GET /api/v5/account/bills | âŒ | âœ… `get_bills()` | Python only |
| è´¦å•æµæ°´(3æœˆ) | GET /api/v5/account/bills-archive | âŒ | âœ… `get_bills_archive()` | Python only |

### 2.3 è¡Œæƒ…æ¥å£ (Market)

| æ¥å£åç§° | OKX Endpoint | C++ å®ç° | Python å®ç° | çŠ¶æ€ |
|----------|--------------|----------|-------------|------|
| è¡Œæƒ…å¿«ç…§ | GET /api/v5/market/ticker | âŒ | âœ… `get_ticker()` | Python only |
| äº§å“ä¿¡æ¯ | GET /api/v5/public/instruments | âŒ | âœ… `get_instruments()` | Python only |
| Kçº¿æ•°æ® | GET /api/v5/market/candles | âœ… `get_candles()` | âŒ | C++ only |

### 2.4 WebSocket é¢‘é“

| é¢‘é“åç§° | ç±»å‹ | ç«¯ç‚¹ | C++ å®ç° | Python å®ç° | çŠ¶æ€ | è¯´æ˜ |
|----------|------|------|----------|-------------|------|------|
| tickers | å…¬å…± | public | âœ… `subscribe_ticker()` | âœ… `subscribe_ticker()` | âœ… å®Œæˆ | è¡Œæƒ…å¿«ç…§ |
| trades | å…¬å…± | public | âœ… `subscribe_trades()` | âœ… `subscribe_trades()` | âœ… å®Œæˆ | é€ç¬”æˆäº¤ |
| trades-all | å…¬å…± | business | âœ… `subscribe_trades_all()` | âœ… `subscribe_trades_all()` | âœ… å®Œæˆ | å…¨éƒ¨æˆäº¤ï¼ˆå•æ¡æ¨é€ï¼‰ |
| books / orderbook | å…¬å…± | public | âœ… `subscribe_orderbook()` | âŒ | âœ… å®Œæˆ | è®¢å•ç°¿æ·±åº¦ |
| **candle*** | å…¬å…± | **business** | âœ… `subscribe_kline()` | âœ… `subscribe_candles()` | âœ… å®Œæˆ | Kçº¿æ•°æ®ï¼ˆéœ€businessç«¯ç‚¹ï¼‰ |
| **open-interest** | å…¬å…± | public | âœ… `subscribe_open_interest()` | âœ… | âœ… å®Œæˆ | æŒä»“æ€»é‡ï¼ˆæ¯3ç§’æ¨é€ï¼‰ |
| **mark-price** | å…¬å…± | public | âœ… `subscribe_mark_price()` | âœ… | âœ… å®Œæˆ | æ ‡è®°ä»·æ ¼ï¼ˆå˜åŒ–æ—¶200msï¼Œå¦åˆ™10sï¼‰ |
| orders | ç§æœ‰ | private | âœ… `subscribe_orders()` | âœ… `subscribe_orders()` | âœ… å®Œæˆ | è®¢å•çŠ¶æ€æ›´æ–°ï¼ˆåŒ…æ‹¬æˆäº¤ï¼‰ |
| **sprd-orders** | ç§æœ‰ | **business** | âœ… `subscribe_sprd_orders()` | âŒ | âœ… å®Œæˆ | Spreadè®¢å•çŠ¶æ€ï¼ˆéœ€businessç«¯ç‚¹ï¼‰ |
| **sprd-trades** | ç§æœ‰ | **business** | âœ… `subscribe_sprd_trades()` | âŒ | âœ… å®Œæˆ | Spreadæˆäº¤æ•°æ®ï¼ˆéœ€businessç«¯ç‚¹ï¼‰ |
| positions | ç§æœ‰ | private | âœ… `subscribe_positions()` | âŒ | âœ… å®Œæˆ | åˆçº¦/æ æ†æŒä»“ï¼ˆæ”¯æŒextraParamsï¼‰ |
| account | ç§æœ‰ | private | âœ… `subscribe_account()` | âœ… `subscribe_account()` | âœ… å®Œæˆ | è´¦æˆ·ä½™é¢ï¼ˆæ”¯æŒextraParamsï¼‰ |

#### WebSocket ç«¯ç‚¹è¯´æ˜

| ç«¯ç‚¹ç±»å‹ | URLè·¯å¾„ | ç”¨é€” | æ˜¯å¦éœ€è¦ç™»å½• |
|----------|---------|------|-------------|
| public | `/ws/v5/public` | è¡Œæƒ…ã€æ·±åº¦ã€æˆäº¤ã€æŒä»“æ€»é‡ã€æ ‡è®°ä»·æ ¼ | âŒ å¦ |
| **business** | `/ws/v5/business` | **Kçº¿ã€trades-allã€Spreadè®¢å•ã€Spreadæˆäº¤** | âœ… æ˜¯ï¼ˆSpreadç›¸å…³ï¼‰ |
| private | `/ws/v5/private` | è®¢å•ã€æŒä»“ã€è´¦æˆ· | âœ… æ˜¯ |

> âš ï¸ **é‡è¦**: 
> - Kçº¿é¢‘é“å¿…é¡»ä½¿ç”¨ `business` ç«¯ç‚¹ï¼Œä¸èƒ½ä½¿ç”¨ `public` ç«¯ç‚¹ï¼
> - Spreadè®¢å•å’ŒSpreadæˆäº¤é¢‘é“å¿…é¡»ä½¿ç”¨ `business` ç«¯ç‚¹å¹¶ç™»å½•ï¼

#### é¢‘é“ä½¿ç”¨åœºæ™¯æŒ‡å—

| éœ€æ±‚ | ä½¿ç”¨çš„é¢‘é“ | ç«¯ç‚¹ç±»å‹ | æ˜¯å¦éœ€è¦ç™»å½• |
|------|-----------|---------|-------------|
| æŸ¥çœ‹è¡Œæƒ…ä»·æ ¼ | `tickers` | public | âŒ |
| æŸ¥çœ‹é€ç¬”æˆäº¤ | `trades` | public | âŒ |
| æŸ¥çœ‹Kçº¿æ•°æ® | `candle*` | **business** | âŒ |
| æŸ¥çœ‹è®¢å•ç°¿æ·±åº¦ | `books` | public | âŒ |
| æŸ¥çœ‹æŒä»“æ€»é‡ | `open-interest` | public | âŒ |
| æŸ¥çœ‹æ ‡è®°ä»·æ ¼ | `mark-price` | public | âŒ |
| **æŸ¥çœ‹è®¢å•çŠ¶æ€å’Œæˆäº¤** | `orders` | private | âœ… |
| æŸ¥çœ‹åˆçº¦/æ æ†æŒä»“ | `positions` | private | âœ… |
| æŸ¥çœ‹è´¦æˆ·ä½™é¢ï¼ˆç°è´§ä½™é¢ï¼‰ | `account` | private | âœ… |
| æŸ¥çœ‹Spreadè®¢å•çŠ¶æ€ | `sprd-orders` | **business** | âœ… |
| æŸ¥çœ‹Spreadæˆäº¤æ•°æ® | `sprd-trades` | **business** | âœ… |

**é‡è¦åŒºåˆ«ï¼š**
- **æ™®é€šè®¢å•æˆäº¤** â†’ ä½¿ç”¨ `orders` é¢‘é“ï¼ˆprivateç«¯ç‚¹ï¼‰
- **Spreadè®¢å•æˆäº¤** â†’ ä½¿ç”¨ `sprd-trades` é¢‘é“ï¼ˆbusinessç«¯ç‚¹ï¼‰
- **ç°è´§ä½™é¢å˜åŒ–** â†’ ä½¿ç”¨ `account` é¢‘é“ï¼ˆprivateç«¯ç‚¹ï¼‰
- **åˆçº¦/æ æ†æŒä»“** â†’ ä½¿ç”¨ `positions` é¢‘é“ï¼ˆprivateç«¯ç‚¹ï¼‰

#### æ”¯æŒçš„Kçº¿é—´éš”

| é—´éš” | é¢‘é“åç§° | è¯´æ˜ |
|------|----------|------|
| 1s | candle1s | 1ç§’ |
| 1m | candle1m | 1åˆ†é’Ÿ |
| 3m | candle3m | 3åˆ†é’Ÿ |
| 5m | candle5m | 5åˆ†é’Ÿ |
| 15m | candle15m | 15åˆ†é’Ÿ |
| 30m | candle30m | 30åˆ†é’Ÿ |
| 1H | candle1H | 1å°æ—¶ |
| 2H | candle2H | 2å°æ—¶ |
| 4H | candle4H | 4å°æ—¶ |
| 6H | candle6H | 6å°æ—¶ |
| 12H | candle12H | 12å°æ—¶ |
| 1D | candle1D | 1å¤© |
| 2D | candle2D | 2å¤© |
| 3D | candle3D | 3å¤© |
| 5D | candle5D | 5å¤© |
| 1W | candle1W | 1å‘¨ |
| 1M | candle1M | 1æœˆ |
| 3M | candle3M | 3æœˆ |

UTCæ—¶åŒºç‰ˆæœ¬ï¼ˆåç¼€utcï¼‰: candle3Mutc, candle1Mutc, candle1Wutc, candle1Dutc ç­‰

---

## 3. Pythonç­–ç•¥ç«¯æ¥å£

### 3.1 TradingClient ç±»

äº¤æ˜“å®¢æˆ·ç«¯ï¼Œè´Ÿè´£ä¸C++æœåŠ¡å™¨é€šä¿¡ã€‚

```python
from trading_client import TradingClient, Strategy

client = TradingClient(strategy_id="my_strategy")
```

#### æ„é€ å‡½æ•°

```python
TradingClient(
    strategy_id: str = "default",
    market_addr: str = "ipc:///tmp/trading_md.ipc",
    order_addr: str = "ipc:///tmp/trading_order.ipc",
    report_addr: str = "ipc:///tmp/trading_report.ipc"
)
```

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| strategy_id | str | ç­–ç•¥å”¯ä¸€æ ‡è¯†ç¬¦ |
| market_addr | str | è¡Œæƒ…é€šé“åœ°å€ |
| order_addr | str | è®¢å•é€šé“åœ°å€ |
| report_addr | str | å›æŠ¥é€šé“åœ°å€ |

#### ç”Ÿå‘½å‘¨æœŸæ–¹æ³•

| æ–¹æ³• | è¯´æ˜ | è¿”å›å€¼ |
|------|------|--------|
| `start()` | å¯åŠ¨å®¢æˆ·ç«¯ï¼Œè¿æ¥ZeroMQé€šé“ | bool |
| `stop()` | åœæ­¢å®¢æˆ·ç«¯ï¼Œæ–­å¼€è¿æ¥ | None |
| `is_running()` | æ£€æŸ¥æ˜¯å¦åœ¨è¿è¡Œ | bool |
| `is_connected()` | æ£€æŸ¥æ˜¯å¦å·²è¿æ¥ | bool |
| `run(strategy)` | è¿è¡Œç­–ç•¥ï¼ˆä¸»å¾ªç¯ï¼‰ | None |

#### æ•°æ®æ¥æ”¶æ–¹æ³•

| æ–¹æ³• | è¯´æ˜ | è¿”å›å€¼ |
|------|------|--------|
| `recv_ticker()` | éé˜»å¡æ¥æ”¶è¡Œæƒ… | Optional[TickerData] |
| `recv_report()` | éé˜»å¡æ¥æ”¶å›æŠ¥ | Optional[OrderReport] |
| `recv_report_for_strategy(strategy_id)` | æ¥æ”¶æŒ‡å®šç­–ç•¥çš„å›æŠ¥ | Optional[OrderReport] |

#### è®¢å•å‘é€æ–¹æ³•

| æ–¹æ³• | è¯´æ˜ | è¿”å›å€¼ |
|------|------|--------|
| `send_order(order: OrderRequest)` | å‘é€è®¢å•è¯·æ±‚ | bool |

---

### 3.2 Strategy åŸºç±»

æ‰€æœ‰ç­–ç•¥éƒ½åº”ç»§æ‰¿æ­¤åŸºç±»ã€‚

```python
from trading_client import Strategy, TickerData, OrderReport

class MyStrategy(Strategy):
    def on_ticker(self, data: TickerData):
        # å¤„ç†è¡Œæƒ…ï¼ˆå¿…é¡»å®ç°ï¼‰
        pass
    
    def on_order(self, report: OrderReport):
        # å¤„ç†è®¢å•å›æŠ¥ï¼ˆå¯é€‰ï¼‰
        pass
```

#### ç”Ÿå‘½å‘¨æœŸå›è°ƒ

| æ–¹æ³• | è°ƒç”¨æ—¶æœº | æ˜¯å¦å¿…é¡»å®ç° |
|------|----------|--------------|
| `on_start()` | ç­–ç•¥å¯åŠ¨æ—¶ | å¦ |
| `on_stop()` | ç­–ç•¥åœæ­¢æ—¶ | å¦ |
| `on_ticker(data: TickerData)` | æ”¶åˆ°è¡Œæƒ…æ—¶ | **æ˜¯** |
| `on_order(report: OrderReport)` | æ”¶åˆ°å›æŠ¥æ—¶ | å¦ |

#### ä¸‹å•ä¾¿æ·æ–¹æ³•

| æ–¹æ³• | è¯´æ˜ | å‚æ•° | è¿”å›å€¼ |
|------|------|------|--------|
| `buy_limit(symbol, quantity, price)` | é™ä»·ä¹°å…¥ | symbol: str, quantity: float, price: float | Optional[str] |
| `sell_limit(symbol, quantity, price)` | é™ä»·å–å‡º | symbol: str, quantity: float, price: float | Optional[str] |
| `buy_market(symbol, quantity)` | å¸‚ä»·ä¹°å…¥ | symbol: str, quantity: float | Optional[str] |
| `sell_market(symbol, quantity)` | å¸‚ä»·å–å‡º | symbol: str, quantity: float | Optional[str] |
| `send_order(order: OrderRequest)` | å‘é€è‡ªå®šä¹‰è®¢å• | order: OrderRequest | Optional[str] |

#### è¾…åŠ©æ–¹æ³•

| æ–¹æ³• | è¯´æ˜ |
|------|------|
| `log(message: str)` | æ‰“å°å¸¦ç­–ç•¥IDå‰ç¼€çš„æ—¥å¿— |

#### å±æ€§

| å±æ€§ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `strategy_id` | str | ç­–ç•¥ID |
| `position` | float | å½“å‰æŒä»“ï¼ˆéœ€è‡ªå·±ç»´æŠ¤ï¼‰ |

---

### 3.3 OKX REST API ç›´æ¥è°ƒç”¨

Pythonç«¯ä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨OKX REST APIï¼Œé€‚ç”¨äºéœ€è¦æ›´å¤šæ§åˆ¶çš„åœºæ™¯ã€‚

```python
from adapters.okx import OKXRestAPI

api = OKXRestAPI(
    api_key="your_api_key",
    secret_key="your_secret_key",
    passphrase="your_passphrase",
    is_demo=True  # ä½¿ç”¨æ¨¡æ‹Ÿç›˜
)
```

#### äº¤æ˜“æ¥å£

```python
# ä¸‹å•
response = api.place_order(
    inst_id="BTC-USDT",      # äº§å“ID
    td_mode="cash",          # äº¤æ˜“æ¨¡å¼: cash/isolated/cross
    side="buy",              # æ–¹å‘: buy/sell
    ord_type="limit",        # ç±»å‹: market/limit/post_only/fok/ioc
    sz="0.001",              # æ•°é‡
    px="50000",              # ä»·æ ¼ï¼ˆé™ä»·å•å¿…å¡«ï¼‰
    cl_ord_id="my_order_1"   # å®¢æˆ·è‡ªå®šä¹‰è®¢å•IDï¼ˆå¯é€‰ï¼‰
)

# æ‰¹é‡ä¸‹å•ï¼ˆæœ€å¤š20ä¸ªï¼‰
orders = [
    {"instId": "BTC-USDT", "tdMode": "cash", "side": "buy", "ordType": "limit", "px": "50000", "sz": "0.01"},
    {"instId": "ETH-USDT", "tdMode": "cash", "side": "buy", "ordType": "limit", "px": "3000", "sz": "0.1"}
]
response = api.place_batch_orders(orders)

# æ’¤å•
response = api.cancel_order(inst_id="BTC-USDT", ord_id="123456")

# æ‰¹é‡æ’¤å•
orders = [{"instId": "BTC-USDT", "ordId": "123456"}, {"instId": "ETH-USDT", "ordId": "789012"}]
response = api.cancel_batch_orders(orders)

# ä¿®æ”¹è®¢å•
response = api.amend_order(inst_id="BTC-USDT", ord_id="123456", new_px="50100")
```

#### æŸ¥è¯¢æ¥å£

```python
# æŸ¥è¯¢è®¢å•
response = api.get_order(inst_id="BTC-USDT", ord_id="123456")

# æŸ¥è¯¢æœªæˆäº¤è®¢å•
response = api.get_orders_pending(inst_type="SPOT", inst_id="BTC-USDT")

# æŸ¥è¯¢å†å²è®¢å•ï¼ˆ7å¤©å†…ï¼‰
response = api.get_orders_history(inst_type="SPOT", state="filled")

# æŸ¥è¯¢è´¦æˆ·ä½™é¢
response = api.get_balance(ccy="USDT")

# æŸ¥è¯¢æŒä»“
response = api.get_positions(inst_type="SWAP")

# æŸ¥è¯¢è´¦å•æµæ°´
response = api.get_bills(ccy="USDT", limit="50")
```

---

## 4. C++ REST APIæ¥å£

### 4.1 OKXRestAPI ç±»

```cpp
#include "adapters/okx/okx_rest_api.h"

using namespace trading::okx;

OKXRestAPI api(
    "api_key",
    "secret_key",
    "passphrase",
    true  // is_testnet
);
```

### 4.2 ä¸‹å•æ¥å£

#### ç®€åŒ–ç‰ˆä¸‹å•

```cpp
nlohmann::json place_order(
    const std::string& inst_id,    // äº§å“ID
    const std::string& td_mode,    // äº¤æ˜“æ¨¡å¼
    const std::string& side,       // æ–¹å‘: buy/sell
    const std::string& ord_type,   // ç±»å‹: market/limit
    double sz,                     // æ•°é‡
    double px = 0.0,               // ä»·æ ¼
    const std::string& cl_ord_id = ""  // å®¢æˆ·ç«¯è®¢å•ID
);
```

#### å®Œæ•´ç‰ˆä¸‹å•ï¼ˆæ”¯æŒæ­¢ç›ˆæ­¢æŸï¼‰

```cpp
PlaceOrderResponse place_order_advanced(const PlaceOrderRequest& request);
```

#### PlaceOrderRequest ç»“æ„

```cpp
struct PlaceOrderRequest {
    // å¿…å¡«å‚æ•°
    std::string inst_id;      // äº§å“ID
    std::string td_mode;      // äº¤æ˜“æ¨¡å¼: cash/isolated/cross
    std::string side;         // æ–¹å‘: buy/sell
    std::string ord_type;     // ç±»å‹: market/limit/post_only/fok/ioc
    std::string sz;           // æ•°é‡
    
    // å¯é€‰å‚æ•°
    std::string ccy;          // ä¿è¯é‡‘å¸ç§
    std::string cl_ord_id;    // å®¢æˆ·è‡ªå®šä¹‰è®¢å•ID
    std::string tag;          // è®¢å•æ ‡ç­¾
    std::string pos_side;     // æŒä»“æ–¹å‘: long/short
    std::string px;           // ä»·æ ¼
    bool reduce_only = false; // æ˜¯å¦åªå‡ä»“
    
    // æ­¢ç›ˆæ­¢æŸ
    std::vector<AttachAlgoOrder> attach_algo_ords;
};
```

#### å¸¦æ­¢ç›ˆæ­¢æŸä¸‹å•

```cpp
PlaceOrderResponse place_order_with_tp_sl(
    const std::string& inst_id,
    const std::string& td_mode,
    const std::string& side,
    const std::string& ord_type,
    const std::string& sz,
    const std::string& px,
    const std::string& tp_trigger_px = "",  // æ­¢ç›ˆè§¦å‘ä»·
    const std::string& tp_ord_px = "-1",    // æ­¢ç›ˆå§”æ‰˜ä»·ï¼ˆ-1=å¸‚ä»·ï¼‰
    const std::string& sl_trigger_px = "",  // æ­¢æŸè§¦å‘ä»·
    const std::string& sl_ord_px = "-1",    // æ­¢æŸå§”æ‰˜ä»·ï¼ˆ-1=å¸‚ä»·ï¼‰
    const std::string& cl_ord_id = ""
);
```

### 4.3 æ‰¹é‡ä¸‹å•æ¥å£

æ‰¹é‡ä¸‹å•æ¥å£å…è®¸ä¸€æ¬¡æäº¤æœ€å¤š20ä¸ªè®¢å•ã€‚

```cpp
/**
 * @brief æ‰¹é‡ä¸‹å•
 * 
 * @param orders è®¢å•è¯·æ±‚æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªPlaceOrderRequest
 * @return nlohmann::json åŒ…å«æ‰€æœ‰è®¢å•çš„å“åº”ç»“æœ
 * 
 * é™é€Ÿï¼š300ä¸ª/2sï¼ˆæŒ‰è®¢å•æ€»ä¸ªæ•°é™é€Ÿï¼‰
 * æ³¨æ„ï¼šå¦‚æœå•æ¬¡æ‰¹é‡è¯·æ±‚ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™ç®—åœ¨å•ä¸ª"ä¸‹å•"é™é€Ÿä¸­
 */
nlohmann::json place_batch_orders(const std::vector<PlaceOrderRequest>& orders);
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```cpp
// æ„é€ æ‰¹é‡è®¢å•è¯·æ±‚
std::vector<PlaceOrderRequest> orders;

// è®¢å•1
PlaceOrderRequest order1;
order1.inst_id = "BTC-USDT";
order1.td_mode = "cash";
order1.side = "buy";
order1.ord_type = "limit";
order1.sz = "0.001";
order1.px = "50000";
order1.cl_ord_id = "batch_1";
orders.push_back(order1);

// è®¢å•2
PlaceOrderRequest order2;
order2.inst_id = "ETH-USDT";
order2.td_mode = "cash";
order2.side = "buy";
order2.ord_type = "limit";
order2.sz = "0.01";
order2.px = "2000";
order2.cl_ord_id = "batch_2";
orders.push_back(order2);

// æ‰¹é‡ä¸‹å•
nlohmann::json response = api.place_batch_orders(orders);

// è§£æå“åº”
if (response["code"] == "0") {
    for (const auto& order_data : response["data"]) {
        std::string ord_id = order_data["ordId"];
        std::string s_code = order_data["sCode"];
        if (s_code == "0") {
            std::cout << "è®¢å•æˆåŠŸ: " << ord_id << std::endl;
        } else {
            std::cout << "è®¢å•å¤±è´¥: " << order_data["sMsg"] << std::endl;
        }
    }
}
```

**å“åº”æ ¼å¼ï¼š**

```json
{
    "code": "0",
    "msg": "",
    "data": [
        {
            "clOrdId": "batch_1",
            "ordId": "12345689",
            "tag": "",
            "ts": "1695190491421",
            "sCode": "0",
            "sMsg": ""
        },
        {
            "clOrdId": "batch_2",
            "ordId": "12344",
            "tag": "",
            "ts": "1695190491421",
            "sCode": "0",
            "sMsg": ""
        }
    ],
    "inTime": "1695190491421339",
    "outTime": "1695190491423240"
}
```

### 4.4 æ’¤å•æ¥å£

```cpp
// å•ä¸ªæ’¤å•
nlohmann::json cancel_order(
    const std::string& inst_id,
    const std::string& ord_id = "",
    const std::string& cl_ord_id = ""
);

// æ‰¹é‡æ’¤å•
nlohmann::json cancel_batch_orders(
    const std::vector<std::string>& ord_ids,
    const std::string& inst_id
);
```

### 4.5 ä¿®æ”¹è®¢å•æ¥å£

ä¿®æ”¹è®¢å•æ¥å£ç”¨äºä¿®æ”¹å½“å‰æœªæˆäº¤çš„æŒ‚å•ã€‚

```cpp
/**
 * @brief ä¿®æ”¹è®¢å•
 * 
 * @param inst_id äº§å“ID
 * @param ord_id è®¢å•IDï¼ˆä¸cl_ord_idäºŒé€‰ä¸€ï¼Œä¼˜å…ˆä½¿ç”¨ord_idï¼‰
 * @param cl_ord_id å®¢æˆ·è‡ªå®šä¹‰è®¢å•ID
 * @param new_sz ä¿®æ”¹çš„æ–°æ•°é‡ï¼ˆå¯é€‰ï¼Œå¿…é¡»å¤§äº0ï¼‰
 * @param new_px ä¿®æ”¹åçš„æ–°ä»·æ ¼ï¼ˆå¯é€‰ï¼‰
 * @param new_px_usd ä»¥USDä»·æ ¼è¿›è¡ŒæœŸæƒæ”¹å•ï¼ˆå¯é€‰ï¼Œä»…æœŸæƒï¼‰
 * @param new_px_vol ä»¥éšå«æ³¢åŠ¨ç‡è¿›è¡ŒæœŸæƒæ”¹å•ï¼ˆå¯é€‰ï¼Œä»…æœŸæƒï¼‰
 * @param cxl_on_fail å½“è®¢å•ä¿®æ”¹å¤±è´¥æ—¶ï¼Œè¯¥è®¢å•æ˜¯å¦éœ€è¦è‡ªåŠ¨æ’¤é”€ï¼ˆé»˜è®¤falseï¼‰
 * @param req_id ç”¨æˆ·è‡ªå®šä¹‰ä¿®æ”¹äº‹ä»¶IDï¼ˆå¯é€‰ï¼‰
 * @param px_amend_type è®¢å•ä»·æ ¼ä¿®æ­£ç±»å‹ï¼š"0"ä¸å…è®¸ç³»ç»Ÿä¿®æ”¹ï¼Œ"1"å…è®¸ï¼ˆé»˜è®¤"0"ï¼‰
 * @param attach_algo_ords ä¿®æ”¹é™„å¸¦æ­¢ç›ˆæ­¢æŸä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
 * @return nlohmann::json ä¿®æ”¹ç»“æœ
 * 
 * é™é€Ÿï¼š60æ¬¡/2s
 * æ³¨æ„ï¼šä¿®æ”¹è®¢å•è¿”å›sCodeç­‰äº0ä¸èƒ½ä¸¥æ ¼è®¤ä¸ºè¯¥è®¢å•å·²ç»è¢«ä¿®æ”¹ï¼Œ
 *      åªè¡¨ç¤ºæ‚¨çš„ä¿®æ”¹è®¢å•è¯·æ±‚è¢«ç³»ç»ŸæœåŠ¡å™¨æ‰€æ¥å—ï¼Œ
 *      æ”¹å•ç»“æœä»¥è®¢å•é¢‘é“æ¨é€çš„çŠ¶æ€æˆ–è€…æŸ¥è¯¢è®¢å•çŠ¶æ€ä¸ºå‡†
 */
nlohmann::json amend_order(
    const std::string& inst_id,
    const std::string& ord_id = "",
    const std::string& cl_ord_id = "",
    const std::string& new_sz = "",
    const std::string& new_px = "",
    const std::string& new_px_usd = "",
    const std::string& new_px_vol = "",
    bool cxl_on_fail = false,
    const std::string& req_id = "",
    const std::string& px_amend_type = "0",
    const std::vector<AttachAlgoOrder>& attach_algo_ords = {}
);
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```cpp
// æ–¹å¼1ï¼šä½¿ç”¨ordIdä¿®æ”¹è®¢å•
nlohmann::json response = api.amend_order(
    "BTC-USDT",        // inst_id
    "1234567890",      // ord_id
    "",                // cl_ord_id
    "0.002",           // new_sz (æ–°æ•°é‡)
    "51000",           // new_px (æ–°ä»·æ ¼)
    "",                // new_px_usd
    "",                // new_px_vol
    false,             // cxl_on_fail
    "",                // req_id
    "0"                // px_amend_type
);

// æ–¹å¼2ï¼šä½¿ç”¨clOrdIdä¿®æ”¹è®¢å•
nlohmann::json response2 = api.amend_order(
    "BTC-USDT",
    "",                // ord_idä¸ºç©º
    "my_order_123",    // cl_ord_id
    "0.002",
    "51000"
);

// è§£æå“åº”
if (response["code"] == "0") {
    const auto& order_data = response["data"][0];
    std::string s_code = order_data["sCode"];
    if (s_code == "0") {
        std::cout << "ä¿®æ”¹è¯·æ±‚å·²æ¥å—" << std::endl;
    } else {
        std::cout << "ä¿®æ”¹å¤±è´¥: " << order_data["sMsg"] << std::endl;
    }
}
```

**å“åº”æ ¼å¼ï¼š**

```json
{
    "code": "0",
    "msg": "",
    "data": [
        {
            "clOrdId": "",
            "ordId": "12344",
            "ts": "1695190491421",
            "reqId": "b12344",
            "sCode": "0",
            "sMsg": ""
        }
    ],
    "inTime": "1695190491421339",
    "outTime": "1695190491423240"
}
```

### 4.6 æ‰¹é‡ä¿®æ”¹è®¢å•æ¥å£

æ‰¹é‡ä¿®æ”¹è®¢å•æ¥å£å…è®¸ä¸€æ¬¡ä¿®æ”¹æœ€å¤š20ä¸ªè®¢å•ã€‚

```cpp
/**
 * @brief æ‰¹é‡ä¿®æ”¹è®¢å•
 * 
 * @param orders ä¿®æ”¹è®¢å•è¯·æ±‚æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ åŒ…å«instIdã€ordId/clOrdIdã€newSz/newPxç­‰
 * @return nlohmann::json åŒ…å«æ‰€æœ‰ä¿®æ”¹ç»“æœçš„å“åº”
 * 
 * é™é€Ÿï¼š300ä¸ª/2sï¼ˆæŒ‰è®¢å•æ€»ä¸ªæ•°é™é€Ÿï¼‰
 * æ³¨æ„ï¼šå¦‚æœå•æ¬¡æ‰¹é‡è¯·æ±‚ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™ç®—åœ¨å•ä¸ª"ä¿®æ”¹è®¢å•"é™é€Ÿä¸­
 */
nlohmann::json amend_batch_orders(const std::vector<nlohmann::json>& orders);
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```cpp
// æ„é€ æ‰¹é‡ä¿®æ”¹è®¢å•è¯·æ±‚
std::vector<nlohmann::json> amend_orders;

// ä¿®æ”¹è®¢å•1ï¼ˆä½¿ç”¨ordIdï¼‰
nlohmann::json amend1;
amend1["instId"] = "BTC-USDT";
amend1["ordId"] = "1234567890";
amend1["newPx"] = "51000";  // æ–°ä»·æ ¼
amend1["newSz"] = "0.002";  // æ–°æ•°é‡
amend1["cxlOnFail"] = false;
amend1["pxAmendType"] = "0";
amend_orders.push_back(amend1);

// ä¿®æ”¹è®¢å•2ï¼ˆä½¿ç”¨clOrdIdï¼‰
nlohmann::json amend2;
amend2["instId"] = "ETH-USDT";
amend2["clOrdId"] = "my_order_123";
amend2["newPx"] = "2100";
amend2["newSz"] = "0.02";
amend2["cxlOnFail"] = false;
amend2["pxAmendType"] = "0";
amend_orders.push_back(amend2);

// æ‰¹é‡ä¿®æ”¹è®¢å•
nlohmann::json response = api.amend_batch_orders(amend_orders);

// è§£æå“åº”
if (response["code"] == "0") {
    for (const auto& order_data : response["data"]) {
        std::string s_code = order_data["sCode"];
        if (s_code == "0") {
            std::cout << "ä¿®æ”¹è¯·æ±‚å·²æ¥å—: " << order_data["ordId"] << std::endl;
        } else {
            std::cout << "ä¿®æ”¹å¤±è´¥: " << order_data["sMsg"] << std::endl;
        }
    }
}
```

**å“åº”æ ¼å¼ï¼š**

```json
{
    "code": "0",
    "msg": "",
    "data": [
        {
            "clOrdId": "oktswap6",
            "ordId": "12345689",
            "ts": "1695190491421",
            "reqId": "b12344",
            "sCode": "0",
            "sMsg": ""
        },
        {
            "clOrdId": "oktswap7",
            "ordId": "12344",
            "ts": "1695190491421",
            "reqId": "b12344",
            "sCode": "0",
            "sMsg": ""
        }
    ],
    "inTime": "1695190491421339",
    "outTime": "1695190491423240"
}
```

### 4.7 æ°¸ç»­åˆçº¦ä¸‹å•

æ°¸ç»­åˆçº¦ï¼ˆSWAPï¼‰ä¸‹å•ä¸ç°è´§ï¼ˆSPOTï¼‰ä¸‹å•æœ‰ä»¥ä¸‹åŒºåˆ«ï¼š

| å‚æ•° | ç°è´§ | æ°¸ç»­åˆçº¦ |
|------|------|----------|
| instId | `BTC-USDT` | `BTC-USDT-SWAP` |
| tdMode | `cash` | `cross`ï¼ˆå…¨ä»“ï¼‰æˆ– `isolated`ï¼ˆé€ä»“ï¼‰|
| szå•ä½ | å¸æ•°é‡ï¼ˆå¦‚0.001 BTCï¼‰ | å¼ æ•°ï¼ˆå¦‚1å¼ ã€10å¼ ï¼‰|
| posSide | ä¸éœ€è¦ | åŒå‘æŒä»“éœ€è®¾ç½®ï¼ˆ`long`/`short`ï¼‰|

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```cpp
// ç°è´§ä¸‹å•
PlaceOrderRequest spot_order;
spot_order.inst_id = "BTC-USDT";
spot_order.td_mode = "cash";        // ç°è´§æ¨¡å¼
spot_order.side = "buy";
spot_order.ord_type = "limit";
spot_order.sz = "0.001";            // 0.001 BTC
spot_order.px = "50000";
auto spot_resp = api.place_order_advanced(spot_order);

// æ°¸ç»­åˆçº¦ä¸‹å•ï¼ˆå¼€å¤šï¼‰
PlaceOrderRequest swap_order;
swap_order.inst_id = "BTC-USDT-SWAP";
swap_order.td_mode = "cross";       // å…¨ä»“æ¨¡å¼
swap_order.side = "buy";            // ä¹°å…¥ = å¼€å¤š
swap_order.ord_type = "limit";
swap_order.sz = "1";                // 1å¼ åˆçº¦
swap_order.px = "50000";
// swap_order.pos_side = "long";    // åŒå‘æŒä»“æ¨¡å¼éœ€è®¾ç½®
auto swap_resp = api.place_order_advanced(swap_order);

// æ°¸ç»­åˆçº¦æ‰¹é‡ä¸‹å•
std::vector<PlaceOrderRequest> swap_orders;

PlaceOrderRequest order1;
order1.inst_id = "BTC-USDT-SWAP";
order1.td_mode = "cross";
order1.side = "buy";
order1.ord_type = "limit";
order1.sz = "1";
order1.px = "50000";
order1.cl_ord_id = "swapbuy1" + timestamp;  // åªèƒ½åŒ…å«å­—æ¯å’Œæ•°å­—
swap_orders.push_back(order1);

PlaceOrderRequest order2;
order2.inst_id = "BTC-USDT-SWAP";
order2.td_mode = "cross";
order2.side = "sell";               // å–å‡º = å¼€ç©º
order2.ord_type = "limit";
order2.sz = "1";
order2.px = "150000";
order2.cl_ord_id = "swapsell1" + timestamp;
swap_orders.push_back(order2);

nlohmann::json response = api.place_batch_orders(swap_orders);
```

**æ³¨æ„äº‹é¡¹ï¼š**
1. `clOrdId` åªèƒ½åŒ…å«å­—æ¯å’Œæ•°å­—ï¼Œä¸èƒ½åŒ…å«ä¸‹åˆ’çº¿ `_` ç­‰ç‰¹æ®Šå­—ç¬¦
2. æ°¸ç»­åˆçº¦çš„æ•°é‡å•ä½æ˜¯"å¼ "ï¼Œ1å¼ çº¦ç­‰äºä¸€å®šæ•°é‡çš„BTCï¼ˆå…·ä½“å–å†³äºåˆçº¦é¢å€¼ï¼‰
3. å¦‚æœè´¦æˆ·æ˜¯åŒå‘æŒä»“æ¨¡å¼ï¼Œéœ€è¦è®¾ç½® `posSide`ï¼ˆ`long` æˆ– `short`ï¼‰
4. `cross` æ˜¯å…¨ä»“æ¨¡å¼ï¼Œ`isolated` æ˜¯é€ä»“æ¨¡å¼

### 4.8 æŸ¥è¯¢æ¥å£

```cpp
// æŸ¥è¯¢è®¢å•
nlohmann::json get_order(
    const std::string& inst_id,
    const std::string& ord_id = "",
    const std::string& cl_ord_id = ""
);

// æŸ¥è¯¢æœªæˆäº¤è®¢å•
nlohmann::json get_pending_orders(
    const std::string& inst_type = "",
    const std::string& inst_id = ""
);

// æŸ¥è¯¢è´¦æˆ·ä½™é¢
nlohmann::json get_account_balance(const std::string& ccy = "");

// æŸ¥è¯¢æŒä»“
nlohmann::json get_positions(
    const std::string& inst_type = "",
    const std::string& inst_id = ""
);

// æŸ¥è¯¢å¯äº¤æ˜“äº§å“
nlohmann::json get_account_instruments(
    const std::string& inst_type,
    const std::string& inst_family = "",
    const std::string& inst_id = ""
);

// æŸ¥è¯¢Kçº¿
nlohmann::json get_candles(
    const std::string& inst_id,
    const std::string& bar,       // æ—¶é—´ç²’åº¦: 1m/5m/15m/1H/4H/1D
    int64_t after = 0,
    int64_t before = 0,
    int limit = 100
);
```

---

## 5. C++ WebSocketæ¥å£

### 5.1 OKXWebSocket ç±»

```cpp
#include "adapters/okx/okx_websocket.h"

using namespace trading::okx;
```

#### ç«¯ç‚¹ç±»å‹

```cpp
enum class WsEndpointType {
    PUBLIC,    // å…¬å…±é¢‘é“ï¼šè¡Œæƒ…ã€æ·±åº¦ã€æˆäº¤
    BUSINESS,  // ä¸šåŠ¡é¢‘é“ï¼šKçº¿ã€trades-all
    PRIVATE    // ç§æœ‰é¢‘é“ï¼šè®¢å•ã€æŒä»“ã€è´¦æˆ·
};
```

#### æ„é€ å‡½æ•°

```cpp
OKXWebSocket(
    const std::string& api_key = "",      // APIå¯†é’¥ï¼ˆç§æœ‰é¢‘é“éœ€è¦ï¼‰
    const std::string& secret_key = "",   // Secretå¯†é’¥
    const std::string& passphrase = "",   // å¯†ç çŸ­è¯­
    bool is_testnet = false,              // æ˜¯å¦ä½¿ç”¨æ¨¡æ‹Ÿç›˜
    WsEndpointType endpoint_type = WsEndpointType::PUBLIC  // ç«¯ç‚¹ç±»å‹
);
```

#### å·¥å‚å‡½æ•°ï¼ˆæ¨èä½¿ç”¨ï¼‰

```cpp
// åˆ›å»ºå…¬å…±é¢‘é“WebSocketï¼ˆè¡Œæƒ…ã€æ·±åº¦ã€æˆäº¤ï¼‰
auto ws_public = create_public_ws(true);  // true = æ¨¡æ‹Ÿç›˜

// åˆ›å»ºä¸šåŠ¡é¢‘é“WebSocketï¼ˆKçº¿ã€trades-allï¼‰
auto ws_business = create_business_ws(true);

// åˆ›å»ºç§æœ‰é¢‘é“WebSocketï¼ˆè®¢å•ã€æŒä»“ã€è´¦æˆ·ï¼‰
auto ws_private = create_private_ws(api_key, secret_key, passphrase, true);
```

### 5.2 å›è°ƒç±»å‹

```cpp
using TickerCallback = std::function<void(const TickerData::Ptr&)>;
using TradeCallback = std::function<void(const TradeData::Ptr&)>;
using OrderBookCallback = std::function<void(const OrderBookData::Ptr&)>;
using KlineCallback = std::function<void(const KlineData::Ptr&)>;
using OrderCallback = std::function<void(const Order::Ptr&)>;
using RawMessageCallback = std::function<void(const nlohmann::json&)>;  // è°ƒè¯•ç”¨
```

### 5.3 å…¬å…±é¢‘é“è®¢é˜…

```cpp
// åˆ›å»ºå…¬å…±é¢‘é“WebSocket
auto ws = create_public_ws(true);
ws->connect();

// è®¢é˜…è¡Œæƒ…å¿«ç…§
ws->subscribe_ticker("BTC-USDT");
ws->set_ticker_callback([](const TickerData::Ptr& ticker) {
    std::cout << "Price: " << ticker->last_price() << std::endl;
});

// è®¢é˜…é€ç¬”æˆäº¤
ws->subscribe_trades("BTC-USDT");
ws->set_trade_callback([](const TradeData::Ptr& trade) {
    std::cout << "Trade: " << trade->price() << " x " << trade->quantity() << std::endl;
});

// è®¢é˜…è®¢å•ç°¿
ws->subscribe_orderbook("BTC-USDT", "books5");  // 5æ¡£æ·±åº¦
ws->set_orderbook_callback([](const OrderBookData::Ptr& book) {
    auto best_bid = book->best_bid();
    auto best_ask = book->best_ask();
    if (best_bid && best_ask) {
        std::cout << "Bid: " << best_bid->first << ", Ask: " << best_ask->first << std::endl;
    }
});
```

### 5.4 Kçº¿é¢‘é“è®¢é˜…ï¼ˆâš ï¸ éœ€è¦ä½¿ç”¨ BUSINESS ç«¯ç‚¹ï¼‰

```cpp
// âš ï¸ é‡è¦ï¼šKçº¿å¿…é¡»ä½¿ç”¨ business ç«¯ç‚¹ï¼
auto ws_kline = create_business_ws(true);  // åˆ›å»º business ç«¯ç‚¹
ws_kline->connect();

// è®¾ç½®Kçº¿å›è°ƒ
ws_kline->set_kline_callback([](const KlineData::Ptr& kline) {
    std::cout << "ğŸ“Š Kçº¿: " << kline->symbol() 
              << " | " << kline->interval()
              << " | O:" << kline->open()
              << " H:" << kline->high()
              << " L:" << kline->low()
              << " C:" << kline->close()
              << " V:" << kline->volume()
              << std::endl;
});

// æ–¹å¼1ï¼šä½¿ç”¨æšä¸¾è®¢é˜…
ws_kline->subscribe_kline("BTC-USDT", KlineInterval::MINUTE_1);   // 1åˆ†é’Ÿ
ws_kline->subscribe_kline("BTC-USDT", KlineInterval::HOUR_1);     // 1å°æ—¶
ws_kline->subscribe_kline("BTC-USDT", KlineInterval::DAY_1);      // 1å¤©

// æ–¹å¼2ï¼šä½¿ç”¨å­—ç¬¦ä¸²è®¢é˜…
ws_kline->subscribe_kline("ETH-USDT", "5m");   // 5åˆ†é’Ÿ
ws_kline->subscribe_kline("ETH-USDT", "1H");   // 1å°æ—¶
ws_kline->subscribe_kline("ETH-USDT", "1D");   // 1å¤©

// å–æ¶ˆè®¢é˜…
ws_kline->unsubscribe_kline("BTC-USDT", KlineInterval::MINUTE_1);
ws_kline->unsubscribe_kline("ETH-USDT", "5m");
```

#### Kçº¿é—´éš”æšä¸¾

```cpp
enum class KlineInterval {
    SECOND_1,   // 1ç§’    -> candle1s
    MINUTE_1,   // 1åˆ†é’Ÿ  -> candle1m
    MINUTE_3,   // 3åˆ†é’Ÿ  -> candle3m
    MINUTE_5,   // 5åˆ†é’Ÿ  -> candle5m
    MINUTE_15,  // 15åˆ†é’Ÿ -> candle15m
    MINUTE_30,  // 30åˆ†é’Ÿ -> candle30m
    HOUR_1,     // 1å°æ—¶  -> candle1H
    HOUR_2,     // 2å°æ—¶  -> candle2H
    HOUR_4,     // 4å°æ—¶  -> candle4H
    HOUR_6,     // 6å°æ—¶  -> candle6H
    HOUR_12,    // 12å°æ—¶ -> candle12H
    DAY_1,      // 1å¤©    -> candle1D
    DAY_2,      // 2å¤©    -> candle2D
    DAY_3,      // 3å¤©    -> candle3D
    DAY_5,      // 5å¤©    -> candle5D
    WEEK_1,     // 1å‘¨    -> candle1W
    MONTH_1,    // 1æœˆ    -> candle1M
    MONTH_3,    // 3æœˆ    -> candle3M
    // UTCæ—¶åŒºç‰ˆæœ¬
    DAY_1_UTC,  // -> candle1Dutc
    // ... æ›´å¤šUTCç‰ˆæœ¬
};
```

#### Kçº¿æ•°æ®æ ¼å¼

```cpp
// KlineData ç±»å±æ€§
class KlineData {
    const std::string& symbol();     // äº§å“ID
    const std::string& interval();   // æ—¶é—´é—´éš”
    double open();                   // å¼€ç›˜ä»·
    double high();                   // æœ€é«˜ä»·
    double low();                    // æœ€ä½ä»·
    double close();                  // æ”¶ç›˜ä»·
    double volume();                 // æˆäº¤é‡
    std::optional<double> turnover(); // æˆäº¤é¢
    int64_t timestamp();             // æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
};
```

### 5.5 ç§æœ‰é¢‘é“è®¢é˜…ï¼ˆéœ€è¦ç™»å½•ï¼‰

ç§æœ‰é¢‘é“éœ€è¦å…ˆè¿›è¡ŒWebSocketç™»å½•è®¤è¯ã€‚

#### ç™»å½•è®¤è¯

```cpp
// åˆ›å»ºç§æœ‰é¢‘é“WebSocket
auto ws_private = create_private_ws(api_key, secret_key, passphrase, true);
ws_private->connect();
ws_private->login();  // å¿…é¡»å…ˆç™»å½•ï¼

// æ£€æŸ¥ç™»å½•çŠ¶æ€
if (ws_private->is_logged_in()) {
    std::cout << "ç™»å½•æˆåŠŸ" << std::endl;
}
```

**ç™»å½•ç­¾åç®—æ³•ï¼š**
1. è·å–å½“å‰Unixæ—¶é—´æˆ³ï¼ˆç§’çº§ï¼‰
2. æ‹¼æ¥ç­¾åå­—ç¬¦ä¸²ï¼š`timestamp + "GET" + "/users/self/verify"`
3. ä½¿ç”¨ HMAC SHA256 + SecretKey åŠ å¯†
4. Base64 ç¼–ç 

```cpp
// å†…éƒ¨å®ç°ç¤ºä¾‹
std::string create_signature(const std::string& timestamp) {
    std::string message = timestamp + "GET" + "/users/self/verify";
    // HMAC SHA256 + Base64
    return base64_encode(hmac_sha256(secret_key, message));
}
```

**ç™»å½•è¯·æ±‚æ ¼å¼ï¼š**
```json
{
    "op": "login",
    "args": [{
        "apiKey": "your_api_key",
        "passphrase": "your_passphrase",
        "timestamp": "1704876947",
        "sign": "base64_encoded_signature"
    }]
}
```

**ç™»å½•å“åº”ï¼š**
```json
// æˆåŠŸ
{"event": "login", "code": "0", "msg": "", "connId": "a4d3ae55"}

// å¤±è´¥
{"event": "error", "code": "60009", "msg": "Login failed.", "connId": "a4d3ae55"}
```

#### è®¢é˜…è®¢å•é¢‘é“

```cpp
// è®¢é˜…æ‰€æœ‰SPOTè®¢å•
ws_private->subscribe_orders("SPOT");

// è®¢é˜…æŒ‡å®šäº§å“çš„è®¢å•
ws_private->subscribe_orders("SPOT", "BTC-USDT");

// è®¢é˜…æŒ‡å®šäº¤æ˜“å“ç§çš„è®¢å•ï¼ˆé€‚ç”¨äºè¡ç”Ÿå“ï¼‰
ws_private->subscribe_orders("SWAP", "", "BTC-USD");

// è®¾ç½®å›è°ƒ
ws_private->set_order_callback([](const Order::Ptr& order) {
    std::cout << "è®¢å•ID: " << order->exchange_order_id() 
              << " çŠ¶æ€: " << order_state_to_string(order->state())
              << " å·²æˆäº¤: " << order->filled_quantity()
              << std::endl;
});
```

**è®¢é˜…å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | æ˜¯å¦å¿…é¡» | è¯´æ˜ |
|------|------|----------|------|
| instType | String | æ˜¯ | äº§å“ç±»å‹ï¼šSPOT/MARGIN/SWAP/FUTURES/OPTION/ANY |
| instId | String | å¦ | äº§å“IDï¼Œå¦‚ "BTC-USDT" |
| instFamily | String | å¦ | äº¤æ˜“å“ç§ï¼ˆé€‚ç”¨äºè¡ç”Ÿå“ï¼‰ |

#### è®¢é˜…æŒä»“é¢‘é“

æŒä»“é¢‘é“æ”¯æŒ `extraParams` å‚æ•°ï¼Œå¯æ§åˆ¶æ¨é€é¢‘ç‡ã€‚

**é‡è¦è¯´æ˜ï¼š**
- æŒä»“é¢‘é“åªæ¨é€åˆçº¦å’Œæ æ†çš„æŒä»“ï¼ˆSWAP/FUTURES/OPTION/MARGINï¼‰
- ç°è´§ï¼ˆSPOTï¼‰ä¹°å…¥åï¼Œèµ„äº§åœ¨è´¦æˆ·ä½™é¢ä¸­ï¼Œä¸åœ¨æŒä»“é¢‘é“æ¨é€
- è¦æŸ¥çœ‹ç°è´§ä½™é¢å˜åŒ–ï¼Œè¯·ä½¿ç”¨è´¦æˆ·é¢‘é“ï¼ˆaccountï¼‰

```cpp
// æ–¹å¼1ï¼šè®¢é˜…æ‰€æœ‰ç±»å‹æŒä»“ï¼ˆå®šæ—¶æ¨é€ + äº‹ä»¶æ¨é€ï¼Œé»˜è®¤çº¦æ¯5ç§’æ¨é€ï¼‰
ws_private->subscribe_positions("ANY");

// æ–¹å¼2ï¼šè®¢é˜…æŒ‡å®šç±»å‹
ws_private->subscribe_positions("SWAP");      // æ°¸ç»­åˆçº¦
ws_private->subscribe_positions("FUTURES");   // äº¤å‰²åˆçº¦
ws_private->subscribe_positions("OPTION");    // æœŸæƒ
ws_private->subscribe_positions("MARGIN");    // å¸å¸æ æ†

// æ–¹å¼3ï¼šè®¢é˜…æŒ‡å®šäº§å“çš„æŒä»“
ws_private->subscribe_positions("SWAP", "BTC-USDT-SWAP");

// æ–¹å¼4ï¼šè®¢é˜…æŒ‡å®šäº¤æ˜“å“ç§ï¼ˆé€‚ç”¨äºäº¤å‰²/æ°¸ç»­/æœŸæƒï¼‰
ws_private->subscribe_positions("FUTURES", "", "BTC-USD");

// æ–¹å¼5ï¼šä»…äº‹ä»¶æ¨é€ï¼ˆä¸å®šæ—¶æ¨é€ï¼‰
ws_private->subscribe_positions("ANY", "", "", 0);  // update_interval = 0

// æ–¹å¼6ï¼šè‡ªå®šä¹‰å®šæ—¶æ¨é€é—´éš”ï¼ˆ2000msï¼‰
ws_private->subscribe_positions("ANY", "", "", 2000);  // 2ç§’å®šæ—¶æ¨é€
```

**æ¨é€æœºåˆ¶è¯´æ˜ï¼š**
- **é¦–æ¬¡è®¢é˜…**ï¼šç«‹å³æ¨é€å¿«ç…§æ•°æ®ï¼ˆsnapshotï¼‰
- **äº‹ä»¶æ¨é€**ï¼ˆevent_updateï¼‰ï¼šä¸‹å•ã€æ’¤å•ç­‰äº‹ä»¶è§¦å‘ï¼ˆçº¦50msèšåˆæ¨é€ï¼‰
- **å®šæ—¶æ¨é€**ï¼ˆsnapshotï¼‰ï¼š
  - `updateInterval = 0`ï¼šä¸æ¨é€å®šæ—¶æ›´æ–°ï¼Œä»…æ¨é€äº‹ä»¶
  - `updateInterval = 2000/3000/4000`ï¼šæŒ‰è®¾ç½®çš„æ—¶é—´é—´éš”å®šæ—¶æ¨é€ï¼ˆæ¯«ç§’ï¼‰
  - å…¶ä»–å€¼æˆ–ä¸è®¾ç½®ï¼šé»˜è®¤çº¦æ¯5ç§’æ¨é€ä¸€æ¬¡
- **åªæ¨é€æœ‰æŒä»“çš„æƒ…å†µ**ï¼šå¦‚æœæ•°æ®ä¸ºç©ºæ•°ç»„ï¼Œè¯´æ˜å½“å‰æ²¡æœ‰æŒä»“

```cpp
// è®¾ç½®å›è°ƒï¼ˆæ¥æ”¶åŸå§‹JSONï¼‰
ws_private->set_position_callback([](const nlohmann::json& pos_data) {
    if (pos_data.is_array() && !pos_data.empty()) {
        for (const auto& pos : pos_data) {
            std::cout << "æŒä»“: " << pos["instId"].get<std::string>()
                      << " | æ–¹å‘: " << pos["posSide"].get<std::string>()
                      << " | æ•°é‡: " << pos["pos"].get<std::string>()
                      << " | å‡ä»·: " << pos["avgPx"].get<std::string>()
                      << " | ç›ˆäº: " << pos["upl"].get<std::string>()
                      << std::endl;
        }
    }
    // å¯è§£æçš„å­—æ®µ:
    // - instId: äº§å“ID
    // - instType: äº§å“ç±»å‹
    // - posSide: æŒä»“æ–¹å‘ (long/short/net)
    // - pos: æŒä»“æ•°é‡
    // - availPos: å¯å¹³ä»“æ•°é‡
    // - avgPx: å¹³å‡å¼€ä»“ä»·æ ¼
    // - markPx: æ ‡è®°ä»·æ ¼
    // - last: æœ€æ–°æˆäº¤ä»·
    // - upl: æœªå®ç°ç›ˆäº
    // - uplRatio: æœªå®ç°æ”¶ç›Šç‡
    // - realizedPnl: å·²å®ç°æ”¶ç›Š
    // - lever: æ æ†å€æ•°
    // - mgnMode: ä¿è¯é‡‘æ¨¡å¼ (cross/isolated)
    // - margin: ä¿è¯é‡‘ä½™é¢
    // - liqPx: é¢„ä¼°å¼ºå¹³ä»·æ ¼
    // - uTime: æ›´æ–°æ—¶é—´
});
```

#### è®¢é˜…è´¦æˆ·é¢‘é“

è´¦æˆ·é¢‘é“æ”¯æŒ `extraParams` å‚æ•°ï¼Œå¯æ§åˆ¶æ¨é€é¢‘ç‡ã€‚

```cpp
// æ–¹å¼1ï¼šè®¢é˜…æ‰€æœ‰å¸ç§ï¼ˆå®šæ—¶æ¨é€ + äº‹ä»¶æ¨é€ï¼Œé»˜è®¤çº¦æ¯5ç§’æ¨é€ï¼‰
ws_private->subscribe_account();

// æ–¹å¼2ï¼šè®¢é˜…æŒ‡å®šå¸ç§
ws_private->subscribe_account("USDT");

// æ–¹å¼3ï¼šä»…äº‹ä»¶æ¨é€ï¼ˆä¸å®šæ—¶æ¨é€ï¼‰
ws_private->subscribe_account("", 0);  // update_interval = 0

// æ–¹å¼4ï¼šè‡ªå®šä¹‰å®šæ—¶æ¨é€é—´éš”ï¼ˆ2000msï¼‰
ws_private->subscribe_account("", 2000);  // 2ç§’å®šæ—¶æ¨é€
```

**æ¨é€æœºåˆ¶è¯´æ˜ï¼š**
- **é¦–æ¬¡è®¢é˜…**ï¼šç«‹å³æ¨é€å¿«ç…§æ•°æ®ï¼ˆsnapshotï¼‰
- **äº‹ä»¶æ¨é€**ï¼ˆevent_updateï¼‰ï¼šä¸‹å•ã€æ’¤å•ã€æˆäº¤ç­‰äº‹ä»¶è§¦å‘ï¼ˆçº¦50msèšåˆæ¨é€ï¼‰
- **å®šæ—¶æ¨é€**ï¼ˆsnapshotï¼‰ï¼š
  - `updateInterval = 0`ï¼šä¸æ¨é€å®šæ—¶æ›´æ–°ï¼Œä»…æ¨é€äº‹ä»¶
  - `updateInterval = 2000/3000/4000`ï¼šæŒ‰è®¾ç½®çš„æ—¶é—´é—´éš”å®šæ—¶æ¨é€ï¼ˆæ¯«ç§’ï¼‰
  - å…¶ä»–å€¼æˆ–ä¸è®¾ç½®ï¼šé»˜è®¤çº¦æ¯5ç§’æ¨é€ä¸€æ¬¡
- **ä»·æ ¼å˜åŒ–**ï¼šå¸‚åœºä»·æ ¼å˜åŒ–å¯èƒ½å¯¼è‡´è´¦æˆ·ä»·å€¼å˜åŒ–ï¼Œè§¦å‘æ¨é€

**é‡è¦è¯´æ˜ï¼š**
- å³ä½¿æ²¡æœ‰æ“ä½œï¼Œä¹Ÿä¼šæ”¶åˆ°å®šæ—¶æ¨é€ï¼ˆè¿™æ˜¯æ­£å¸¸çš„ï¼‰
- ç°è´§ï¼ˆSPOTï¼‰ä¹°å…¥åï¼Œä½™é¢å˜åŒ–åœ¨è´¦æˆ·é¢‘é“ä¸­æ¨é€
- åˆçº¦/æ æ†æŒä»“å˜åŒ–åœ¨æŒä»“é¢‘é“ä¸­æ¨é€

```cpp
// è®¾ç½®å›è°ƒï¼ˆæ¥æ”¶åŸå§‹JSONï¼‰
ws_private->set_account_callback([](const nlohmann::json& acc_data) {
    std::cout << "è´¦æˆ·æ›´æ–°: " << acc_data.dump() << std::endl;
    // å¯è§£æçš„å­—æ®µ:
    // - totalEq: æ€»æƒç›Šï¼ˆç¾å…ƒï¼‰
    // - adjEq: æœ‰æ•ˆä¿è¯é‡‘
    // - imr: åˆå§‹ä¿è¯é‡‘
    // - mmr: ç»´æŒä¿è¯é‡‘
    // - mgnRatio: ä¿è¯é‡‘ç‡
    // - details: å„å¸ç§è¯¦æƒ…æ•°ç»„
    //   - ccy: å¸ç§
    //   - eq: å¸ç§æƒç›Š
    //   - cashBal: ç°é‡‘ä½™é¢
    //   - availBal: å¯ç”¨ä½™é¢
    //   - frozenBal: å†»ç»“ä½™é¢
});
```

#### è®¢é˜…Spreadè®¢å•é¢‘é“ï¼ˆsprd-ordersï¼‰

Spreadè®¢å•é¢‘é“ç”¨äºæ¥æ”¶Spreadè®¢å•çš„çŠ¶æ€æ›´æ–°ã€‚

**é‡è¦è¯´æ˜ï¼š**
- éœ€è¦ä½¿ç”¨ `business` ç«¯ç‚¹å¹¶ç™»å½•
- é¦–æ¬¡è®¢é˜…ä¸æ¨é€ï¼Œåªæœ‰ä¸‹å•ã€æ’¤å•ç­‰äº‹ä»¶è§¦å‘æ—¶æ‰æ¨é€
- æ™®é€šè®¢å•çš„æˆäº¤ä¸åœ¨æ­¤é¢‘é“æ¨é€ï¼Œè¯·ä½¿ç”¨ `orders` é¢‘é“

```cpp
// âš ï¸ é‡è¦ï¼šSpreadè®¢å•é¢‘é“å¿…é¡»ä½¿ç”¨ business ç«¯ç‚¹ï¼
auto ws_sprd = std::make_unique<OKXWebSocket>(
    api_key, secret_key, passphrase, true, WsEndpointType::BUSINESS
);
ws_sprd->connect();
ws_sprd->login();

// æ–¹å¼1ï¼šè®¢é˜…æ‰€æœ‰Spreadè®¢å•
ws_sprd->subscribe_sprd_orders();

// æ–¹å¼2ï¼šè®¢é˜…æŒ‡å®šSpread ID
ws_sprd->subscribe_sprd_orders("BTC-USDT_BTC-USDT-SWAP");

// è®¾ç½®å›è°ƒï¼ˆä½¿ç”¨è®¢å•å›è°ƒï¼‰
ws_sprd->set_order_callback([](const Order::Ptr& order) {
    std::cout << "Spreadè®¢å•: " << order->symbol()  // symbol = sprdId
              << " | ID: " << order->exchange_order_id()
              << " | çŠ¶æ€: " << order_state_to_string(order->state())
              << std::endl;
});
```

#### è®¢é˜…Spreadæˆäº¤æ•°æ®é¢‘é“ï¼ˆsprd-tradesï¼‰

Spreadæˆäº¤æ•°æ®é¢‘é“ç”¨äºæ¥æ”¶Spreadè®¢å•çš„æˆäº¤ä¿¡æ¯ã€‚

**é‡è¦è¯´æ˜ï¼š**
- éœ€è¦ä½¿ç”¨ `business` ç«¯ç‚¹å¹¶ç™»å½•
- å·²æˆäº¤ï¼ˆfilledï¼‰å’Œè¢«æ‹’ç»ï¼ˆrejectedï¼‰çš„äº¤æ˜“éƒ½ä¼šé€šè¿‡æ­¤é¢‘é“æ¨é€æ›´æ–°
- æ™®é€šè®¢å•çš„æˆäº¤ä¸åœ¨æ­¤é¢‘é“æ¨é€ï¼Œè¯·ä½¿ç”¨ `orders` é¢‘é“

```cpp
// âš ï¸ é‡è¦ï¼šSpreadæˆäº¤æ•°æ®é¢‘é“å¿…é¡»ä½¿ç”¨ business ç«¯ç‚¹ï¼
auto ws_sprd = std::make_unique<OKXWebSocket>(
    api_key, secret_key, passphrase, true, WsEndpointType::BUSINESS
);
ws_sprd->connect();
ws_sprd->login();

// æ–¹å¼1ï¼šè®¢é˜…æ‰€æœ‰Spreadæˆäº¤æ•°æ®
ws_sprd->subscribe_sprd_trades();

// æ–¹å¼2ï¼šè®¢é˜…æŒ‡å®šSpread ID
ws_sprd->subscribe_sprd_trades("BTC-USDT_BTC-USDT-SWAP");

// è®¾ç½®å›è°ƒ
ws_sprd->set_spread_trade_callback([](const SpreadTradeData::Ptr& trade) {
    std::cout << "Spreadæˆäº¤: " << trade->sprd_id
              << " | äº¤æ˜“ID: " << trade->trade_id
              << " | è®¢å•ID: " << trade->ord_id
              << " | çŠ¶æ€: " << trade->state
              << " | ä»·æ ¼: " << trade->fill_px
              << " | æ•°é‡: " << trade->fill_sz
              << " | è…¿æ•°: " << trade->legs.size()
              << std::endl;
    
    // æ‰“å°æ¯ä¸ªäº¤æ˜“è…¿çš„è¯¦æƒ…
    for (const auto& leg : trade->legs) {
        std::cout << "  è…¿: " << leg.inst_id
                  << " | ä»·æ ¼: " << leg.px
                  << " | æ•°é‡: " << leg.sz
                  << " | æ–¹å‘: " << leg.side
                  << std::endl;
    }
});
```

**SpreadTradeData æ•°æ®ç»“æ„ï¼š**
```cpp
struct SpreadTradeData {
    std::string sprd_id;      // Spread ID
    std::string trade_id;     // äº¤æ˜“ID
    std::string ord_id;       // è®¢å•ID
    std::string cl_ord_id;    // å®¢æˆ·è‡ªå®šä¹‰è®¢å•ID
    std::string tag;          // è®¢å•æ ‡ç­¾
    double fill_px;           // æœ€æ–°æˆäº¤ä»·
    double fill_sz;           // æœ€æ–°æˆäº¤æ•°é‡
    std::string side;         // äº¤æ˜“æ–¹å‘ï¼šbuy/sell
    std::string state;        // äº¤æ˜“çŠ¶æ€ï¼šfilled/rejected
    std::string exec_type;    // æµåŠ¨æ€§æ–¹å‘ï¼šT(taker)/M(maker)
    int64_t timestamp;         // æˆäº¤æ˜ç»†äº§ç”Ÿæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    std::vector<SpreadTradeLeg> legs;  // äº¤æ˜“çš„è…¿
};

struct SpreadTradeLeg {
    std::string inst_id;      // äº§å“ID
    double px;                // ä»·æ ¼
    double sz;                 // æ•°é‡
    double sz_cont;           // æˆäº¤åˆçº¦æ•°é‡ï¼ˆä»…é€‚ç”¨äºåˆçº¦ï¼‰
    std::string side;          // äº¤æ˜“æ–¹å‘ï¼šbuy/sell
    double fill_pnl;          // æœ€æ–°æˆäº¤æ”¶ç›Š
    double fee;                // æ‰‹ç»­è´¹é‡‘é¢
    std::string fee_ccy;       // äº¤æ˜“æ‰‹ç»­è´¹å¸ç§
    std::string trade_id;      // äº¤æ˜“ID
};
```

#### å–æ¶ˆè®¢é˜…

```cpp
// å–æ¶ˆè®¢é˜…è®¢å•
ws_private->unsubscribe_orders("SPOT");
ws_private->unsubscribe_orders("SPOT", "BTC-USDT");

// å–æ¶ˆè®¢é˜…æŒä»“
ws_private->unsubscribe_positions("SWAP");

// å–æ¶ˆè®¢é˜…è´¦æˆ·
ws_private->unsubscribe_account();

// å–æ¶ˆè®¢é˜…Spreadè®¢å•
ws_sprd->unsubscribe_sprd_orders();
ws_sprd->unsubscribe_sprd_orders("BTC-USDT_BTC-USDT-SWAP");

// å–æ¶ˆè®¢é˜…Spreadæˆäº¤æ•°æ®
ws_sprd->unsubscribe_sprd_trades();
ws_sprd->unsubscribe_sprd_trades("BTC-USDT_BTC-USDT-SWAP");
```

### 5.6 å®Œæ•´ç¤ºä¾‹ï¼šç§æœ‰é¢‘é“ï¼ˆè®¢å•/æŒä»“/è´¦æˆ·ï¼‰

```cpp
#include "adapters/okx/okx_websocket.h"
#include <iostream>
#include <thread>
#include <chrono>

int main() {
    using namespace trading::okx;
    
    // APIå‡­è¯
    const std::string api_key = "your_api_key";
    const std::string secret_key = "your_secret_key";
    const std::string passphrase = "your_passphrase";
    
    // 1. åˆ›å»ºç§æœ‰é¢‘é“WebSocket
    auto ws = create_private_ws(api_key, secret_key, passphrase, true);  // true = æ¨¡æ‹Ÿç›˜
    
    // 2. è®¾ç½®å›è°ƒ
    ws->set_order_callback([](const Order::Ptr& order) {
        std::cout << "ğŸ“¦ è®¢å•æ›´æ–°: "
                  << order->symbol() << " | "
                  << (order->side() == OrderSide::BUY ? "ä¹°" : "å–") << " | "
                  << order->quantity() << " @ " << order->price() << " | "
                  << "çŠ¶æ€: " << order_state_to_string(order->state()) << " | "
                  << "å·²æˆäº¤: " << order->filled_quantity()
                  << std::endl;
    });
    
    ws->set_position_callback([](const nlohmann::json& pos) {
        std::cout << "ğŸ“Š æŒä»“æ›´æ–°: " << pos.dump(2) << std::endl;
    });
    
    ws->set_account_callback([](const nlohmann::json& acc) {
        std::cout << "ğŸ’° è´¦æˆ·æ›´æ–°: totalEq=" << acc.value("totalEq", "N/A") << std::endl;
    });
    
    // 3. è¿æ¥
    if (!ws->connect()) {
        std::cerr << "è¿æ¥å¤±è´¥" << std::endl;
        return 1;
    }
    
    // 4. ç™»å½•ï¼ˆç§æœ‰é¢‘é“å¿…é¡»ï¼‰
    ws->login();
    std::this_thread::sleep_for(std::chrono::seconds(2));  // ç­‰å¾…ç™»å½•å®Œæˆ
    
    if (!ws->is_logged_in()) {
        std::cerr << "ç™»å½•å¤±è´¥" << std::endl;
        return 1;
    }
    
    // 5. è®¢é˜…ç§æœ‰é¢‘é“
    ws->subscribe_orders("SPOT");        // è®¢é˜…ç°è´§è®¢å•
    ws->subscribe_positions("SWAP");     // è®¢é˜…åˆçº¦æŒä»“
    ws->subscribe_account();             // è®¢é˜…è´¦æˆ·
    
    // 6. ä¿æŒè¿è¡Œ
    std::cout << "ç­‰å¾…æ¨é€æ•°æ®..." << std::endl;
    std::this_thread::sleep_for(std::chrono::minutes(10));
    
    // 7. æ¸…ç†
    ws->unsubscribe_orders("SPOT");
    ws->unsubscribe_positions("SWAP");
    ws->unsubscribe_account();
    ws->disconnect();
    
    return 0;
}
```

### 5.7 å®Œæ•´ç¤ºä¾‹ï¼šè®¢é˜…Kçº¿æ•°æ®

```cpp
#include "adapters/okx/okx_websocket.h"
#include <iostream>
#include <thread>
#include <chrono>

int main() {
    using namespace trading::okx;
    
    // 1. åˆ›å»º business ç«¯ç‚¹çš„ WebSocketï¼ˆKçº¿å¿…é¡»ä½¿ç”¨æ­¤ç«¯ç‚¹ï¼‰
    auto ws = create_business_ws(true);  // true = æ¨¡æ‹Ÿç›˜
    
    // 2. è®¾ç½®Kçº¿å›è°ƒ
    ws->set_kline_callback([](const KlineData::Ptr& kline) {
        std::cout << "ğŸ“Š " << kline->symbol() 
                  << " [" << kline->interval() << "]"
                  << " O:" << kline->open()
                  << " H:" << kline->high()
                  << " L:" << kline->low()
                  << " C:" << kline->close()
                  << " V:" << kline->volume()
                  << std::endl;
    });
    
    // 3. è¿æ¥
    if (!ws->connect()) {
        std::cerr << "è¿æ¥å¤±è´¥" << std::endl;
        return 1;
    }
    
    // 4. è®¢é˜…Kçº¿
    ws->subscribe_kline("BTC-USDT", KlineInterval::MINUTE_1);
    ws->subscribe_kline("ETH-USDT", "1H");
    
    // 5. ä¿æŒè¿è¡Œ
    std::this_thread::sleep_for(std::chrono::minutes(5));
    
    // 6. æ¸…ç†
    ws->unsubscribe_kline("BTC-USDT", KlineInterval::MINUTE_1);
    ws->disconnect();
    
    return 0;
}
```

---

## 6. ZeroMQé€šä¿¡åè®®

### 6.1 IPCåœ°å€

```cpp
// C++ ç«¯
struct IpcAddresses {
    static constexpr const char* MARKET_DATA = "ipc:///tmp/trading_md.ipc";
    static constexpr const char* ORDER = "ipc:///tmp/trading_order.ipc";
    static constexpr const char* REPORT = "ipc:///tmp/trading_report.ipc";
};
```

```python
# Python ç«¯
class IpcAddresses:
    MARKET_DATA = "ipc:///tmp/trading_md.ipc"
    ORDER = "ipc:///tmp/trading_order.ipc"
    REPORT = "ipc:///tmp/trading_report.ipc"
```

### 6.2 æ¶ˆæ¯æ ¼å¼

#### è¡Œæƒ…æ¶ˆæ¯ (æœåŠ¡ç«¯ â†’ ç­–ç•¥ç«¯)

```json
{
    "type": "ticker",
    "symbol": "BTC-USDT",
    "last_price": 43250.5,
    "bid_price": 43250.0,
    "ask_price": 43251.0,
    "bid_size": 1.5,
    "ask_size": 2.0,
    "volume_24h": 10000.0,
    "timestamp": 1702000000000,
    "timestamp_ns": 1702000000000000000,
    "seq_num": 12345
}
```

#### è®¢å•è¯·æ±‚ (ç­–ç•¥ç«¯ â†’ æœåŠ¡ç«¯)

```json
{
    "type": "order_request",
    "strategy_id": "my_strategy",
    "client_order_id": "mystrategy17020000001234",
    "symbol": "BTC-USDT",
    "side": "buy",
    "order_type": "limit",
    "price": 43000.0,
    "quantity": 0.001,
    "timestamp": 1702000000000
}
```

#### è®¢å•å›æŠ¥ (æœåŠ¡ç«¯ â†’ ç­–ç•¥ç«¯)

```json
{
    "type": "order_report",
    "strategy_id": "my_strategy",
    "client_order_id": "mystrategy17020000001234",
    "exchange_order_id": "1234567890",
    "symbol": "BTC-USDT",
    "status": "accepted",
    "filled_price": 43000.0,
    "filled_quantity": 0.001,
    "fee": 0.00001,
    "error_msg": "",
    "timestamp": 1702000000100,
    "timestamp_ns": 1702000000100000000
}
```

### 6.3 è®¢å•çŠ¶æ€

| çŠ¶æ€ | è¯´æ˜ |
|------|------|
| `accepted` | äº¤æ˜“æ‰€å·²æ¥å— |
| `filled` | å®Œå…¨æˆäº¤ |
| `partial` | éƒ¨åˆ†æˆäº¤ |
| `cancelled` | å·²å–æ¶ˆ |
| `rejected` | è¢«æ‹’ç» |

---

## 7. æ•°æ®ç»“æ„å®šä¹‰

### 7.1 TickerData (è¡Œæƒ…å¿«ç…§)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| symbol | string | äº¤æ˜“å¯¹ |
| last_price | float | æœ€æ–°ä»· |
| bid_price | float | ä¹°ä¸€ä»· |
| ask_price | float | å–ä¸€ä»· |
| bid_size | float | ä¹°ä¸€é‡ |
| ask_size | float | å–ä¸€é‡ |
| volume_24h | float | 24å°æ—¶æˆäº¤é‡ |
| timestamp | int64 | æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |
| timestamp_ns | int64 | æ—¶é—´æˆ³ï¼ˆçº³ç§’ï¼‰ |

#### è®¡ç®—å±æ€§

| æ–¹æ³• | è¯´æ˜ |
|------|------|
| `spread()` | ä¹°å–ä»·å·® = ask_price - bid_price |
| `spread_bps()` | ä»·å·®åŸºç‚¹ = spread / mid_price * 10000 |
| `mid_price()` | ä¸­é—´ä»· = (bid + ask) / 2 |

### 7.2 OrderRequest (è®¢å•è¯·æ±‚)

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| strategy_id | string | æ˜¯ | ç­–ç•¥ID |
| symbol | string | æ˜¯ | äº¤æ˜“å¯¹ |
| side | string | æ˜¯ | æ–¹å‘: buy/sell |
| order_type | string | å¦ | ç±»å‹: limit/marketï¼Œé»˜è®¤limit |
| price | float | é™ä»·å•å¿…å¡« | ä»·æ ¼ |
| quantity | float | æ˜¯ | æ•°é‡ |
| client_order_id | string | å¦ | è‡ªåŠ¨ç”Ÿæˆ |

### 7.3 OrderReport (è®¢å•å›æŠ¥)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| strategy_id | string | ç­–ç•¥ID |
| client_order_id | string | å®¢æˆ·ç«¯è®¢å•ID |
| exchange_order_id | string | äº¤æ˜“æ‰€è®¢å•ID |
| symbol | string | äº¤æ˜“å¯¹ |
| status | string | è®¢å•çŠ¶æ€ |
| filled_price | float | æˆäº¤ä»· |
| filled_quantity | float | æˆäº¤é‡ |
| fee | float | æ‰‹ç»­è´¹ |
| error_msg | string | é”™è¯¯ä¿¡æ¯ |
| timestamp | int64 | æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |
| timestamp_ns | int64 | æ—¶é—´æˆ³ï¼ˆçº³ç§’ï¼‰ |

#### ä¾¿æ·æ–¹æ³•

| æ–¹æ³• | è¯´æ˜ |
|------|------|
| `is_success()` | æ˜¯å¦æˆåŠŸï¼ˆaccepted/filled/partialï¼‰ |
| `is_filled()` | æ˜¯å¦å®Œå…¨æˆäº¤ |
| `is_rejected()` | æ˜¯å¦è¢«æ‹’ç» |

---

## 8. ä½¿ç”¨ç¤ºä¾‹

### 8.1 Python ç­–ç•¥ç¤ºä¾‹

```python
from trading_client import TradingClient, Strategy, TickerData, OrderReport

class SimpleStrategy(Strategy):
    """ç®€å•çªç ´ç­–ç•¥"""
    
    def __init__(self):
        super().__init__()
        self.high_price = 0.0
        self.order_placed = False
    
    def on_start(self):
        self.log("ç­–ç•¥å¯åŠ¨ï¼Œç­‰å¾…çªç ´ä¿¡å·...")
    
    def on_ticker(self, data: TickerData):
        # æ›´æ–°æœ€é«˜ä»·
        if data.last_price > self.high_price:
            self.high_price = data.last_price
        
        # ä»·æ ¼çªç ´æ—¶ä¹°å…¥
        if not self.order_placed and data.last_price > self.high_price * 0.99:
            order_id = self.buy_limit(
                symbol=data.symbol,
                quantity=0.001,
                price=data.bid_price  # ä»¥ä¹°ä¸€ä»·æŒ‚å•
            )
            if order_id:
                self.order_placed = True
                self.log(f"ä¸‹å•æˆåŠŸ: {order_id}")
    
    def on_order(self, report: OrderReport):
        if report.is_filled():
            self.position += report.filled_quantity
            self.log(f"æˆäº¤ï¼æŒä»“: {self.position}")
        elif report.is_rejected():
            self.log(f"è®¢å•è¢«æ‹’: {report.error_msg}")
            self.order_placed = False

if __name__ == "__main__":
    client = TradingClient(strategy_id="simple_breakout")
    client.run(SimpleStrategy())
```

### 8.2 C++ ä¸‹å•ç¤ºä¾‹

```cpp
#include "adapters/okx/okx_rest_api.h"
#include <iostream>

int main() {
    using namespace trading::okx;
    
    // åˆ›å»ºAPIå®¢æˆ·ç«¯
    OKXRestAPI api("api_key", "secret_key", "passphrase", true);
    
    // ç®€å•ä¸‹å•
    auto response = api.place_order(
        "BTC-USDT",   // inst_id
        "cash",       // td_mode
        "buy",        // side
        "limit",      // ord_type
        0.001,        // sz
        43000.0,      // px
        "my_order_1"  // cl_ord_id
    );
    
    if (response["code"] == "0") {
        auto& data = response["data"][0];
        std::cout << "Order placed: " << data["ordId"] << std::endl;
    } else {
        std::cout << "Order failed: " << response["msg"] << std::endl;
    }
    
    // å¸¦æ­¢ç›ˆæ­¢æŸçš„ä¸‹å•
    auto result = api.place_order_with_tp_sl(
        "BTC-USDT",   // inst_id
        "cash",       // td_mode
        "buy",        // side
        "limit",      // ord_type
        "0.001",      // sz
        "43000",      // px
        "44000",      // tp_trigger_px (æ­¢ç›ˆè§¦å‘ä»·)
        "-1",         // tp_ord_px (å¸‚ä»·æ­¢ç›ˆ)
        "42000",      // sl_trigger_px (æ­¢æŸè§¦å‘ä»·)
        "-1"          // sl_ord_px (å¸‚ä»·æ­¢æŸ)
    );
    
    if (result.is_success()) {
        std::cout << "Order with TP/SL placed: " << result.ord_id << std::endl;
    }
    
    return 0;
}
```

### 8.3 å¯åŠ¨æµç¨‹

```bash
# 1. å…ˆå¯åŠ¨C++äº¤æ˜“æœåŠ¡å™¨
cd cpp/build
./trading_server

# 2. ç„¶åå¯åŠ¨Pythonç­–ç•¥
cd python
python -c "
from trading_client import TradingClient, Strategy, TickerData

class MyStrategy(Strategy):
    def on_ticker(self, data: TickerData):
        print(f'æ”¶åˆ°è¡Œæƒ…: {data.symbol} @ {data.last_price}')

client = TradingClient(strategy_id='test')
client.run(MyStrategy())
"
```

---

## é™„å½•: å¾…å®ç°æ¥å£

ä»¥ä¸‹OKXæ¥å£å°šæœªå®ç°ï¼Œåç»­å¯æ ¹æ®éœ€è¦æ·»åŠ ï¼š

### äº¤æ˜“æ¥å£
- [ ] ä¸€é”®å¹³ä»“ (POST /api/v5/trade/close-position)
- [ ] ç­–ç•¥å§”æ‰˜ä¸‹å• (POST /api/v5/trade/order-algo)
- [ ] æ’¤é”€ç­–ç•¥å§”æ‰˜ (POST /api/v5/trade/cancel-algos)
- [ ] è·å–æˆäº¤æ˜ç»† (GET /api/v5/trade/fills)

### è´¦æˆ·æ¥å£
- [ ] è´¦æˆ·é…ç½® (GET /api/v5/account/config)
- [ ] è®¾ç½®æ æ† (POST /api/v5/account/set-leverage)
- [ ] è´¦æˆ·æœ€å¤§å¯ä¹°å– (GET /api/v5/account/max-size)
- [ ] è´¦æˆ·æœ€å¤§å¯å¼€ä»“æ•°é‡ (GET /api/v5/account/max-avail-size)

### è¡Œæƒ…æ¥å£
- [ ] æ·±åº¦æ•°æ® (GET /api/v5/market/books)
- [ ] å†å²æˆäº¤ (GET /api/v5/market/trades)
- [ ] æŒ‡æ•°è¡Œæƒ… (GET /api/v5/market/index-tickers)

### WebSocketé¢‘é“
- [x] æ·±åº¦å¿«ç…§é¢‘é“ (books5) - âœ… å·²å®ç°
- [x] æ ‡è®°ä»·æ ¼é¢‘é“ (mark-price) - âœ… å·²å®ç°
- [ ] èµ„é‡‘è´¹ç‡é¢‘é“ (funding-rate)
- [ ] æŒ‡æ•°è¡Œæƒ…é¢‘é“ (index-tickers)

---

## 9. æµ‹è¯•ç¨‹åºæ¸…å•

æ‰€æœ‰æµ‹è¯•ç¨‹åºä½äº `cpp/examples/` ç›®å½•ï¼Œç¼–è¯‘åä½äº `cpp/build/` ç›®å½•ã€‚

### 9.1 REST API æµ‹è¯•

| æµ‹è¯•ç¨‹åº | è¯´æ˜ | ç¼–è¯‘å‘½ä»¤ |
|---------|------|---------|
| `test_okx_api` | REST APIåŸºç¡€æµ‹è¯• | `make test_okx_api` |
| `test_okx_order` | ä¸‹å•/æ’¤å•æµ‹è¯•ï¼ˆç°è´§ï¼‰ | `make test_okx_order` |
| `test_okx_batch_orders` | æ‰¹é‡ä¸‹å•æµ‹è¯•ï¼ˆç°è´§ï¼‰ | `make test_okx_batch_orders` |
| `test_okx_amend_order` | ä¿®æ”¹è®¢å•æµ‹è¯• | `make test_okx_amend_order` |
| `test_okx_amend_batch_orders` | æ‰¹é‡ä¿®æ”¹è®¢å•æµ‹è¯• | `make test_okx_amend_batch_orders` |
| `test_okx_swap_orders` | **æ°¸ç»­åˆçº¦ä¸‹å•æµ‹è¯•** | `make test_okx_swap_orders` |

### 9.2 WebSocket å…¬å…±é¢‘é“æµ‹è¯•

| æµ‹è¯•ç¨‹åº | è¯´æ˜ | ç¼–è¯‘å‘½ä»¤ |
|---------|------|---------|
| `test_okx_kline` | Kçº¿è®¢é˜…æµ‹è¯•ï¼ˆå•ä¸ªäº§å“ï¼‰ | `make test_okx_kline` |
| `test_okx_kline_all` | Kçº¿è®¢é˜…æµ‹è¯•ï¼ˆå¤šä¸ªäº§å“ï¼‰ | `make test_okx_kline_all` |
| `test_okx_open_interest` | æŒä»“æ€»é‡æµ‹è¯• | `make test_okx_open_interest` |
| `test_okx_mark_price` | æ ‡è®°ä»·æ ¼æµ‹è¯• | `make test_okx_mark_price` |

### 9.3 WebSocket ç§æœ‰é¢‘é“æµ‹è¯•

| æµ‹è¯•ç¨‹åº | è¯´æ˜ | ç¼–è¯‘å‘½ä»¤ |
|---------|------|---------|
| `test_okx_login` | ç™»å½•åŠŸèƒ½æµ‹è¯• | `make test_okx_login` |
| `test_okx_orders_debug` | è®¢å•é¢‘é“è°ƒè¯•æµ‹è¯• | `make test_okx_orders_debug` |
| `test_okx_order_fills` | æ™®é€šè®¢å•æˆäº¤æ¨é€æµ‹è¯• | `make test_okx_order_fills` |
| `test_okx_positions` | æŒä»“é¢‘é“æµ‹è¯• | `make test_okx_positions` |
| `test_okx_account` | è´¦æˆ·é¢‘é“æµ‹è¯• | `make test_okx_account` |
| `test_okx_positions_and_account` | æŒä»“+è´¦æˆ·é¢‘é“ç»¼åˆæµ‹è¯• | `make test_okx_positions_and_account` |

### 9.4 WebSocket Spread é¢‘é“æµ‹è¯•

| æµ‹è¯•ç¨‹åº | è¯´æ˜ | ç¼–è¯‘å‘½ä»¤ |
|---------|------|---------|
| `test_okx_sprd_orders` | Spreadè®¢å•é¢‘é“æµ‹è¯• | `make test_okx_sprd_orders` |
| `test_okx_sprd_trades` | Spreadæˆäº¤æ•°æ®æµ‹è¯• | `make test_okx_sprd_trades` |

### 9.5 è¿è¡Œæµ‹è¯•

```bash
# 1. ç¼–è¯‘æ‰€æœ‰æµ‹è¯•ç¨‹åº
cd /path/to/Real-account-trading-framework/cpp/build
cmake ..
make -j4

# 2. è¿è¡Œç‰¹å®šæµ‹è¯•
# REST API æµ‹è¯•
./test_okx_api                    # REST APIåŸºç¡€æµ‹è¯•
./test_okx_order                  # ä¸‹å•/æ’¤å•æµ‹è¯•ï¼ˆç°è´§ï¼‰
./test_okx_batch_orders           # æ‰¹é‡ä¸‹å•æµ‹è¯•ï¼ˆç°è´§ï¼‰
./test_okx_amend_order            # ä¿®æ”¹è®¢å•æµ‹è¯•
./test_okx_amend_batch_orders     # æ‰¹é‡ä¿®æ”¹è®¢å•æµ‹è¯•
./test_okx_swap_orders            # æ°¸ç»­åˆçº¦ä¸‹å•æµ‹è¯•

# WebSocket æµ‹è¯•
./test_okx_login                  # æµ‹è¯•ç™»å½•
./test_okx_order_fills            # æµ‹è¯•è®¢å•æˆäº¤æ¨é€
./test_okx_account                # æµ‹è¯•è´¦æˆ·é¢‘é“
./test_okx_positions              # æµ‹è¯•æŒä»“é¢‘é“
./test_okx_sprd_orders            # æµ‹è¯•Spreadè®¢å•
./test_okx_sprd_trades            # æµ‹è¯•Spreadæˆäº¤

# 3. æŸ¥çœ‹æµ‹è¯•è¾“å‡º
# æ‰€æœ‰æµ‹è¯•ç¨‹åºéƒ½ä¼šè¾“å‡ºè¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š
# - è¿æ¥çŠ¶æ€
# - ç™»å½•çŠ¶æ€
# - è®¢é˜…çŠ¶æ€
# - æ”¶åˆ°çš„æ¨é€æ•°æ®
```

### 9.6 æµ‹è¯•æ³¨æ„äº‹é¡¹

1. **APIå¯†é’¥é…ç½®**ï¼šæ‰€æœ‰æµ‹è¯•ç¨‹åºéƒ½ç¡¬ç¼–ç äº†APIå¯†é’¥ï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹
2. **ä»£ç†è®¾ç½®**ï¼šWebSocketè¿æ¥é»˜è®¤ä½¿ç”¨HTTPä»£ç† `127.0.0.1:7890`ï¼Œå¯åœ¨ä»£ç ä¸­ä¿®æ”¹
3. **æ¨¡æ‹Ÿç›˜/å®ç›˜**ï¼šæµ‹è¯•ç¨‹åºé»˜è®¤ä½¿ç”¨æ¨¡æ‹Ÿç›˜ï¼ˆ`is_testnet = true`ï¼‰
4. **ç™»å½•æµ‹è¯•**ï¼šç§æœ‰é¢‘é“æµ‹è¯•éœ€è¦å…ˆç™»å½•ï¼Œè¯·ç¡®ä¿APIå¯†é’¥æ­£ç¡®
5. **æ¨é€é¢‘ç‡**ï¼šè´¦æˆ·å’ŒæŒä»“é¢‘é“ä¼šå®šæ—¶æ¨é€ï¼Œå³ä½¿æ²¡æœ‰æ“ä½œä¹Ÿä¼šæ”¶åˆ°æ¨é€ï¼ˆè¿™æ˜¯æ­£å¸¸çš„ï¼‰

---

## 10. å¸¸è§é—®é¢˜ (FAQ)

### Q1: ä¸ºä»€ä¹ˆè´¦æˆ·é¢‘é“ä¼šé¢‘ç¹æ¨é€ï¼Œå³ä½¿æ²¡æœ‰æ“ä½œï¼Ÿ

**A:** è´¦æˆ·é¢‘é“æœ‰å®šæ—¶æ¨é€æœºåˆ¶ï¼š
- é»˜è®¤çº¦æ¯5ç§’æ¨é€ä¸€æ¬¡å¿«ç…§æ•°æ®ï¼ˆsnapshotï¼‰
- è¿™æ˜¯ä¸ºäº†ä¿æŒè´¦æˆ·æ•°æ®åŒæ­¥ï¼Œåæ˜ å¸‚åœºä»·æ ¼å˜åŒ–å¯¹è´¦æˆ·ä»·å€¼çš„å½±å“
- å¦‚æœåªæƒ³æ¥æ”¶äº‹ä»¶æ¨é€ï¼Œå¯ä»¥è®¾ç½® `updateInterval = 0`

### Q2: ç°è´§ä¹°å…¥åï¼Œä¸ºä»€ä¹ˆæŒä»“é¢‘é“æ²¡æœ‰æ¨é€ï¼Ÿ

**A:** æŒä»“é¢‘é“åªæ¨é€åˆçº¦å’Œæ æ†çš„æŒä»“ï¼ˆSWAP/FUTURES/OPTION/MARGINï¼‰ï¼Œä¸æ¨é€ç°è´§æŒä»“ã€‚
- ç°è´§ä¹°å…¥åï¼Œä½™é¢å˜åŒ–åœ¨**è´¦æˆ·é¢‘é“**ä¸­æ¨é€
- åˆçº¦å¼€ä»“åï¼ŒæŒä»“å˜åŒ–åœ¨**æŒä»“é¢‘é“**ä¸­æ¨é€

### Q3: æ™®é€šè®¢å•çš„æˆäº¤åœ¨å“ªé‡Œæ¨é€ï¼Ÿ

**A:** æ™®é€šè®¢å•çš„æˆäº¤åœ¨**è®¢å•é¢‘é“ï¼ˆordersï¼‰**ä¸­æ¨é€ï¼Œä¸åœ¨Spreadæˆäº¤é¢‘é“ä¸­æ¨é€ã€‚
- æ™®é€šè®¢å•æˆäº¤ â†’ `orders` é¢‘é“ï¼ˆprivateç«¯ç‚¹ï¼‰
- Spreadè®¢å•æˆäº¤ â†’ `sprd-trades` é¢‘é“ï¼ˆbusinessç«¯ç‚¹ï¼‰

### Q4: Kçº¿é¢‘é“è®¢é˜…å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A:** Kçº¿é¢‘é“å¿…é¡»ä½¿ç”¨ `business` ç«¯ç‚¹ï¼Œä¸èƒ½ä½¿ç”¨ `public` ç«¯ç‚¹ã€‚
```cpp
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ business ç«¯ç‚¹
auto ws = create_business_ws(true);
ws->subscribe_kline("BTC-USDT", KlineInterval::MINUTE_1);

// âŒ é”™è¯¯ï¼šä½¿ç”¨ public ç«¯ç‚¹
auto ws = create_public_ws(true);
ws->subscribe_kline("BTC-USDT", KlineInterval::MINUTE_1);  // ä¼šå¤±è´¥
```

### Q5: å¦‚ä½•å‡å°‘è´¦æˆ·/æŒä»“é¢‘é“çš„æ¨é€é¢‘ç‡ï¼Ÿ

**A:** ä½¿ç”¨ `extraParams` å‚æ•°ï¼š
```cpp
// ä»…äº‹ä»¶æ¨é€ï¼Œä¸æ¨é€å®šæ—¶æ›´æ–°
ws->subscribe_account("", 0);        // update_interval = 0
ws->subscribe_positions("ANY", "", "", 0);

// è‡ªå®šä¹‰å®šæ—¶æ¨é€é—´éš”ï¼ˆ2ç§’ï¼‰
ws->subscribe_account("", 2000);     // 2ç§’å®šæ—¶æ¨é€
ws->subscribe_positions("ANY", "", "", 2000);
```

### Q6: WebSocketè¿æ¥å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A:** æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
2. ä»£ç†è®¾ç½®æ˜¯å¦æ­£ç¡®ï¼ˆé»˜è®¤ `127.0.0.1:7890`ï¼‰
3. APIå¯†é’¥æ˜¯å¦æ­£ç¡®
4. æ˜¯å¦ä½¿ç”¨äº†æ­£ç¡®çš„ç«¯ç‚¹ç±»å‹ï¼ˆpublic/business/privateï¼‰
5. ç§æœ‰é¢‘é“æ˜¯å¦å·²ç™»å½•

---

## 11. æ›´æ–°æ—¥å¿—

### v2.2.0 (2025-12-16)
- âœ… æ–°å¢æ°¸ç»­åˆçº¦ä¸‹å•æµ‹è¯•ç¨‹åºï¼ˆ`test_okx_swap_orders`ï¼‰
- âœ… æ”¯æŒæ°¸ç»­åˆçº¦ï¼ˆBTC-USDT-SWAPï¼‰å•ä¸ªä¸‹å•å’Œæ‰¹é‡ä¸‹å•
- âœ… æ”¹è¿›æ‰¹é‡ä¸‹å•æµ‹è¯•ï¼Œä¿®å¤clOrdIdæ ¼å¼é—®é¢˜ï¼ˆä¸èƒ½åŒ…å«ä¸‹åˆ’çº¿ï¼‰
- âœ… æ”¹è¿›æ‰¹é‡ä¸‹å•å“åº”è§£æï¼Œæ”¯æŒéƒ¨åˆ†æˆåŠŸï¼ˆcode=2ï¼‰çš„æƒ…å†µ
- âœ… æ‰€æœ‰REST APIæµ‹è¯•ç¨‹åºæ·»åŠ é»˜è®¤ä»£ç†é…ç½®
- âœ… ä¼˜åŒ–æµ‹è¯•ç¨‹åºå–å•æ•°é‡ï¼Œé¿å…ä½™é¢ä¸è¶³é—®é¢˜
- âœ… æ›´æ–°æ¥å£æ–‡æ¡£

### v2.1.0 (2025-12-15)
- âœ… æ–°å¢æ‰¹é‡ä¸‹å•æ¥å£ï¼ˆ`place_batch_orders`ï¼‰
- âœ… æ–°å¢ä¿®æ”¹è®¢å•æ¥å£ï¼ˆ`amend_order`ï¼‰
- âœ… æ–°å¢æ‰¹é‡ä¿®æ”¹è®¢å•æ¥å£ï¼ˆ`amend_batch_orders`ï¼‰
- âœ… æ·»åŠ æ‰¹é‡ä¸‹å•æµ‹è¯•ç¨‹åºï¼ˆ`test_okx_batch_orders`ï¼‰
- âœ… æ·»åŠ ä¿®æ”¹è®¢å•æµ‹è¯•ç¨‹åºï¼ˆ`test_okx_amend_order`ï¼‰
- âœ… æ·»åŠ æ‰¹é‡ä¿®æ”¹è®¢å•æµ‹è¯•ç¨‹åºï¼ˆ`test_okx_amend_batch_orders`ï¼‰
- âœ… å®Œå–„æ¥å£æ–‡æ¡£ï¼Œæ·»åŠ æ–°æ¥å£è¯¦ç»†è¯´æ˜

### v2.0.0 (2024-12-15)
- âœ… æ–°å¢ Spreadè®¢å•é¢‘é“ï¼ˆsprd-ordersï¼‰æ”¯æŒ
- âœ… æ–°å¢ Spreadæˆäº¤æ•°æ®é¢‘é“ï¼ˆsprd-tradesï¼‰æ”¯æŒ
- âœ… è´¦æˆ·é¢‘é“æ”¯æŒ `extraParams` å‚æ•°ï¼ˆupdateIntervalï¼‰
- âœ… æŒä»“é¢‘é“æ”¯æŒ `extraParams` å‚æ•°ï¼ˆupdateIntervalï¼‰
- âœ… æ”¹è¿›è®¢å•è§£æï¼Œæ”¯æŒå¸‚ä»·å•ï¼ˆpxä¸ºç©ºå­—ç¬¦ä¸²çš„æƒ…å†µï¼‰
- âœ… æ·»åŠ HTTPä»£ç†æ”¯æŒï¼ˆé»˜è®¤ `127.0.0.1:7890`ï¼‰
- âœ… æ·»åŠ è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
- âœ… å®Œå–„æ¥å£æ–‡æ¡£

### v1.0.0 (2024-12-13)
- âœ… åŸºç¡€REST APIæ¥å£ï¼ˆä¸‹å•ã€æ’¤å•ã€æŸ¥è¯¢ï¼‰
- âœ… åŸºç¡€WebSocketé¢‘é“ï¼ˆtickersã€tradesã€orderbookã€Kçº¿ï¼‰
- âœ… ç§æœ‰é¢‘é“æ”¯æŒï¼ˆordersã€positionsã€accountï¼‰
- âœ… æŒä»“æ€»é‡é¢‘é“ï¼ˆopen-interestï¼‰
- âœ… æ ‡è®°ä»·æ ¼é¢‘é“ï¼ˆmark-priceï¼‰

