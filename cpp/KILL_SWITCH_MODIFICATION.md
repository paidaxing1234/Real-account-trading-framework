# Kill Switch åŠŸèƒ½ä¿®æ”¹è¯´æ˜Ž

## ä¿®æ”¹å†…å®¹

### ä¿®æ”¹å‰ï¼ˆåŽŸå§‹è¡Œä¸ºï¼‰
å½“è´¦æˆ·å›žæ’¤è¶…è¿‡ `max_drawdown_pct` é˜ˆå€¼æ—¶ï¼š
1. âŒ **è‡ªåŠ¨æ¿€æ´» Kill Switch**
2. âŒ **æ‹’ç»æ‰€æœ‰æ–°è®¢å•**
3. âœ… å‘é€ CRITICAL çº§åˆ«å‘Šè­¦ï¼ˆç”µè¯+çŸ­ä¿¡+é‚®ä»¶+é’‰é’‰ï¼‰
4. âŒ ç­–ç•¥æ— æ³•ç»§ç»­äº¤æ˜“ï¼Œå¿…é¡»æ‰‹åŠ¨è§£é™¤

### ä¿®æ”¹åŽï¼ˆå½“å‰è¡Œä¸ºï¼‰
å½“è´¦æˆ·å›žæ’¤è¶…è¿‡ `max_drawdown_pct` é˜ˆå€¼æ—¶ï¼š
1. âœ… **ä»…å‘é€å‘Šè­¦é‚®ä»¶**
2. âœ… **ç­–ç•¥ç»§ç»­æ­£å¸¸äº¤æ˜“**
3. âœ… å‘é€ CRITICAL çº§åˆ«å‘Šè­¦ï¼ˆç”µè¯+çŸ­ä¿¡+é‚®ä»¶+é’‰é’‰ï¼‰
4. âœ… ä¸å½±å“è®¢å•æ‰§è¡Œ

## ä¿®æ”¹çš„ä»£ç ä½ç½®

æ–‡ä»¶ï¼š`/home/xyc/Real-account-trading-framework-main/Real-account-trading-framework-main/cpp/trading/risk_manager.h`

è¡Œå·ï¼š498-520

### ä¿®æ”¹å‰ä»£ç ï¼š
```cpp
// æ£€æŸ¥æœ€å¤§å›žæ’¤
if (drawdown_pct > limits_.max_drawdown_pct) {
    std::string reason = "...";
    std::cout << "[é£ŽæŽ§] âš ï¸  å›žæ’¤è¶…é™ " << reason << "\n";
    activate_kill_switch_with_strategy("...", strategy_id);  // âŒ æ¿€æ´»kill switch
}
```

### ä¿®æ”¹åŽä»£ç ï¼š
```cpp
// æ£€æŸ¥æœ€å¤§å›žæ’¤ï¼ˆä»…å‘Šè­¦ï¼Œä¸è§¦å‘kill switchï¼‰
if (drawdown_pct > limits_.max_drawdown_pct) {
    std::string reason = "...";
    std::cout << "[é£ŽæŽ§] âš ï¸  å›žæ’¤è¶…é™ " << reason << "\n";

    // åªå‘é€å‘Šè­¦é‚®ä»¶ï¼Œä¸æ¿€æ´»kill switch
    std::string alert_message = "å›žæ’¤è¶…é™è­¦å‘Š: " + reason;
    send_risk_alert_to_strategy(strategy_id, alert_message, "å›žæ’¤è¶…é™å‘Šè­¦");

    // åŒæ—¶å‘é€åˆ°æ‰€æœ‰å‘Šè­¦æ¸ é“ï¼ˆä½†ä¸æ¿€æ´»kill switchï¼‰
    alert_service_.send_alert_all(
        alert_message,
        AlertLevel::CRITICAL,
        "å›žæ’¤è¶…é™å‘Šè­¦"
    );
}
```

## Kill Switch ä»ç„¶ä¿ç•™çš„åŠŸèƒ½

Kill Switch åŠŸèƒ½æœ¬èº«**ä»ç„¶å­˜åœ¨**ï¼Œä½†ä¸ä¼šè‡ªåŠ¨è§¦å‘ã€‚ä½ ä»ç„¶å¯ä»¥ï¼š

1. **æ‰‹åŠ¨æ¿€æ´» Kill Switch**ï¼ˆé€šè¿‡ä»£ç è°ƒç”¨ï¼‰
2. **æ‰‹åŠ¨è§£é™¤ Kill Switch**ï¼ˆé€šè¿‡ risk_control.py å·¥å…·ï¼‰
3. **æŸ¥è¯¢ Kill Switch çŠ¶æ€**ï¼ˆé€šè¿‡ risk_control.py statusï¼‰

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šå›žæ’¤è¶…é™æ—¶
- **æ—§è¡Œä¸º**ï¼šè‡ªåŠ¨åœæ­¢æ‰€æœ‰äº¤æ˜“ï¼Œéœ€è¦æ‰‹åŠ¨è§£é™¤
- **æ–°è¡Œä¸º**ï¼šåªå‘é€å‘Šè­¦ï¼Œç­–ç•¥ç»§ç»­è¿è¡Œï¼Œç”±ä½ å†³å®šæ˜¯å¦æ‰‹åŠ¨å¹²é¢„

### åœºæ™¯2ï¼šéœ€è¦ç´§æ€¥åœæ­¢äº¤æ˜“
ä½ ä»ç„¶å¯ä»¥æ‰‹åŠ¨æ¿€æ´» Kill Switchï¼š
```bash
# æ–¹æ³•1ï¼šé€šè¿‡ä»£ç è°ƒç”¨ï¼ˆéœ€è¦æ·»åŠ æŽ¥å£ï¼‰
# æ–¹æ³•2ï¼šé‡å¯ trading_server
# æ–¹æ³•3ï¼šç›´æŽ¥æ€æŽ‰ç­–ç•¥è¿›ç¨‹
```

### åœºæ™¯3ï¼šæŸ¥çœ‹é£ŽæŽ§çŠ¶æ€
```bash
cd /home/xyc/Real-account-trading-framework-main/Real-account-trading-framework-main/cpp/tools
python3 risk_control.py status
```

## å‘Šè­¦æœºåˆ¶

å›žæ’¤è¶…é™æ—¶ï¼Œä½ ä¼šæ”¶åˆ°ï¼š
1. ðŸ“§ **é‚®ä»¶å‘Šè­¦**ï¼ˆå‘é€åˆ°ç­–ç•¥è´Ÿè´£äººé‚®ç®±ï¼‰
2. ðŸ“± **çŸ­ä¿¡å‘Šè­¦**
3. ðŸ“ž **ç”µè¯å‘Šè­¦**ï¼ˆCRITICALçº§åˆ«ï¼‰
4. ðŸ’¬ **é’‰é’‰å‘Šè­¦**

å‘Šè­¦å†…å®¹åŒ…æ‹¬ï¼š
- ç­–ç•¥ID
- å›žæ’¤æ¨¡å¼ï¼ˆdaily_peak æˆ– daily_initialï¼‰
- å½“æ—¥å³°å€¼æƒç›Š
- å½“æ—¥åˆå§‹æƒç›Š
- å½“å‰æƒç›Š
- å›žæ’¤ç™¾åˆ†æ¯”
- å›žæ’¤é™åˆ¶é˜ˆå€¼

## é£ŽæŽ§é…ç½®

å½“å‰é…ç½®ï¼ˆ`risk_config.json`ï¼‰ï¼š
```json
{
  "risk_limits": {
    "max_drawdown_pct": 0.01,  // 1% å›žæ’¤è§¦å‘å‘Šè­¦
    "drawdown_mode": "daily_peak"  // ç›¸å¯¹äºŽå½“æ—¥å³°å€¼
  }
}
```

å»ºè®®æ ¹æ®ç­–ç•¥ç‰¹ç‚¹è°ƒæ•´ï¼š
- é«˜é¢‘ç­–ç•¥ï¼š0.01 - 0.03ï¼ˆ1%-3%ï¼‰
- ä¸­é¢‘ç­–ç•¥ï¼š0.05 - 0.10ï¼ˆ5%-10%ï¼‰
- ä½Žé¢‘ç­–ç•¥ï¼š0.10 - 0.20ï¼ˆ10%-20%ï¼‰

## é‡å¯è¯´æ˜Ž

ä¿®æ”¹å·²ç¼–è¯‘å®Œæˆï¼Œéœ€è¦é‡å¯ trading_server æ‰èƒ½ç”Ÿæ•ˆï¼š

```bash
# 1. åœæ­¢å½“å‰çš„ trading_server
pkill -f trading_server_full

# 2. é‡æ–°å¯åŠ¨
cd /home/xyc/Real-account-trading-framework-main/Real-account-trading-framework-main/cpp/build
./trading_server_full
```

## æ³¨æ„äº‹é¡¹

1. âš ï¸ **å›žæ’¤å‘Šè­¦ä¸ä¼šåœæ­¢äº¤æ˜“**ï¼Œéœ€è¦ä½ è‡ªå·±åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰‹åŠ¨å¹²é¢„
2. âš ï¸ **å‘Šè­¦ä¼šæŒç»­å‘é€**ï¼Œæ¯æ¬¡è´¦æˆ·ç›‘æŽ§æ›´æ–°ï¼ˆ10ç§’ä¸€æ¬¡ï¼‰éƒ½ä¼šæ£€æŸ¥å›žæ’¤
3. âš ï¸ **å»ºè®®è®¾ç½®åˆç†çš„å›žæ’¤é˜ˆå€¼**ï¼Œé¿å…é¢‘ç¹å‘Šè­¦
4. âœ… **å…¶ä»–é£ŽæŽ§é™åˆ¶ä»ç„¶æœ‰æ•ˆ**ï¼ˆè®¢å•é‡‘é¢ã€æŒä»“é™åˆ¶ã€å•æ—¥äºæŸç­‰ï¼‰

## æ¢å¤åŽŸå§‹è¡Œä¸º

å¦‚æžœä½ æƒ³æ¢å¤è‡ªåŠ¨è§¦å‘ Kill Switch çš„è¡Œä¸ºï¼Œä¿®æ”¹ `risk_manager.h` ç¬¬498-520è¡Œï¼š

```cpp
// æ¢å¤è‡ªåŠ¨è§¦å‘ kill switch
if (drawdown_pct > limits_.max_drawdown_pct) {
    std::string reason = "...";
    std::cout << "[é£ŽæŽ§] âš ï¸  å›žæ’¤è¶…é™ " << reason << "\n";
    activate_kill_switch_with_strategy("...", strategy_id);  // æ¢å¤è¿™è¡Œ
}
```

ç„¶åŽé‡æ–°ç¼–è¯‘å’Œé‡å¯ã€‚
