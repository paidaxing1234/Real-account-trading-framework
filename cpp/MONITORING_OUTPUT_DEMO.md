# 账户监控终端输出演示

## 📺 监控输出说明

账户监控模块运行在**独立线程**中，但所有日志都会**实时显示在主进程的终端**上。

监控使用 `std::cout` 和 `std::cerr` 输出日志，因此你在运行 `./trading_server_full` 的终端窗口中可以看到所有监控活动。

---

## 🎬 启动时的输出

当服务器启动时，你会看到：

```
[初始化] 账户监控模块...
[账户监控] 注册 OKX 账户: strategy_001
[账户监控] 注册 OKX 账户: strategy_002
[账户监控] 启动，间隔: 5秒
[账户监控] ✓ 已启动，监控 2 个OKX账户 + 0 个Binance账户
[账户监控] 监控间隔: 5秒
```

---

## 📊 每5秒的监控输出（正常情况）

每隔5秒，监控线程会查询所有账户，输出如下：

```
========== [账户监控] 开始更新所有账户 ==========
[账户监控] 正在查询 OKX 账户: strategy_001
[账户监控] strategy_001 - 总权益: 15234.56 USDT, 未实现盈亏: 234.56 USDT
[账户监控] ✓ strategy_001 - 余额正常
[账户监控] strategy_001 - 持仓: BTC-USDT-SWAP = 10000.0 USDT
[账户监控] strategy_001 - 持仓: ETH-USDT-SWAP = 5000.0 USDT
[账户监控] strategy_001 - 挂单数量: 3
[账户监控] ✓ strategy_001 更新完成
[账户监控] 正在查询 OKX 账户: strategy_002
[账户监控] strategy_002 - 总权益: 8765.43 USDT, 未实现盈亏: -123.45 USDT
[账户监控] ✓ strategy_002 - 余额正常
[账户监控] strategy_002 - 无持仓
[账户监控] strategy_002 - 挂单数量: 0
[账户监控] ✓ strategy_002 更新完成
========== [账户监控] 更新完成 ==========

```

---

## ⚠️ 余额不足告警

当账户余额低于阈值（默认1000 USDT）时：

```
========== [账户监控] 开始更新所有账户 ==========
[账户监控] 正在查询 OKX 账户: strategy_001
[账户监控] strategy_001 - 总权益: 850.00 USDT, 未实现盈亏: -150.00 USDT
[账户监控] ⚠️  strategy_001 - 余额告警: Account balance 850.0 below minimum 1000.0
[风控] ⚠️  WARNING: [strategy_001] Account balance 850.0 below minimum 1000.0
[风控] 触发告警: 账户余额不足
[账户监控] strategy_001 - 无持仓
[账户监控] strategy_001 - 挂单数量: 0
[账户监控] ✓ strategy_001 更新完成
========== [账户监控] 更新完成 ==========

```

---

## 🔴 每日亏损超限

当每日亏损超过限制（默认5000 USDT）时：

```
========== [账户监控] 开始更新所有账户 ==========
[账户监控] 正在查询 OKX 账户: strategy_001
[账户监控] strategy_001 - 总权益: 12000.00 USDT, 未实现盈亏: -5500.00 USDT
[账户监控] ✓ strategy_001 - 余额正常
[风控] 🔴 CRITICAL: Daily loss -5500.0 exceeds limit 5000.0
[风控] 触发告警: 每日亏损超限
[账户监控] strategy_001 - 持仓: BTC-USDT-SWAP = 8000.0 USDT
[账户监控] strategy_001 - 挂单数量: 2
[账户监控] ✓ strategy_001 更新完成
========== [账户监控] 更新完成 ==========

```

---

## 🚫 订单被风控拒绝（与监控配合）

当有新订单提交时，如果触发风控规则：

```
[下单] 收到订单请求: strategy_001 BTC-USDT-SWAP buy 5.0 @ 50000.0
[风控] 检查订单: BTC-USDT-SWAP buy 5.0 @ 50000.0
[下单] ✗ [风控拒绝] Order value 250000.0 exceeds limit 10000.0
[风控] ⚠️  订单被风控拒绝: strategy_001 BTC-USDT-SWAP buy 5.0
       原因: Order value 250000.0 exceeds limit 10000.0
[风控] 触发告警: 订单被拒绝
```

---

## ✗ API 查询失败

如果 API 查询失败（网络问题、API 限制等）：

```
========== [账户监控] 开始更新所有账户 ==========
[账户监控] 正在查询 OKX 账户: strategy_001
[账户监控] ✗ OKX账户 strategy_001 更新失败: HTTP request timeout
========== [账户监控] 更新完成 ==========

```

---

## 🛑 服务器关闭时

当你按 Ctrl+C 或正常关闭服务器时：

```
^C
[Server] 收到退出信号，正在关闭...
[Server] 停止账户监控...
[账户监控] 已停止
[Server] 停止 WebSocket 服务器...
[Server] 关闭完成
```

---

## 🎯 监控输出特点

### 1. **实时显示**
- 所有监控日志都会立即显示在终端
- 不需要查看单独的日志文件
- 方便调试和观察

### 2. **清晰的标识**
- `[账户监控]` - 监控模块的日志
- `[风控]` - 风控管理器的日志
- `✓` - 成功/正常
- `⚠️` - 警告
- `✗` - 错误/失败
- `🔴` - 严重告警

### 3. **详细的信息**
- 账户余额和盈亏
- 持仓详情（品种和金额）
- 挂单数量
- 风控检查结果

### 4. **分隔线**
- 每次更新周期用 `==========` 分隔
- 便于区分不同的更新周期

---

## ⚙️ 调整输出详细程度

### 如果觉得输出太多

可以注释掉一些 `std::cout` 语句，例如：

```cpp
// 注释掉这行，不显示"正在查询"
// std::cout << "[账户监控] 正在查询 OKX 账户: " << strategy_id << "\n";
```

### 如果需要更详细的输出

可以添加更多日志，例如：

```cpp
// 显示原始 API 响应
std::cout << "[账户监控] API 响应: " << balance_result.dump(2) << "\n";
```

---

## 📝 日志重定向

如果你想把监控日志保存到文件：

```bash
# 保存所有输出到文件
./trading_server_full > server.log 2>&1

# 同时显示在终端和保存到文件
./trading_server_full 2>&1 | tee server.log
```

---

## 🔍 调试建议

1. **首次运行** - 使用默认的详细输出，观察监控是否正常工作
2. **生产环境** - 可以减少输出，只保留告警和错误信息
3. **问题排查** - 临时增加输出详细程度，定位问题

---

**版本**: v1.1.0
**更新时间**: 2025-02-10
**状态**: ✅ 已增强日志输出
