# Pythonç­–ç•¥ç¼–è¯‘ä¸º.soæ–‡ä»¶éƒ¨ç½²æ–¹æ¡ˆ

## ğŸ“‹ æ–¹æ¡ˆæ¦‚è¿°

**æ ¸å¿ƒæ€è·¯**ï¼šå°†Pythonç­–ç•¥æ–‡ä»¶ç¼–è¯‘æˆ.soå…±äº«åº“ï¼ˆLinuxï¼‰æˆ–.pydæ–‡ä»¶ï¼ˆWindowsï¼‰ï¼Œä¸C++å®ç›˜æ¡†æ¶ä¸€èµ·éƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Šã€‚

**ä¸»è¦ä¼˜åŠ¿**ï¼š
- âœ… **ä¿æŠ¤çŸ¥è¯†äº§æƒ**ï¼šç­–ç•¥é€»è¾‘ä¸å¯è§ï¼Œéš¾ä»¥åç¼–è¯‘
- âœ… **æ€§èƒ½æå‡**ï¼šç¼–è¯‘åæ€§èƒ½æå‡20%-300%
- âœ… **éƒ¨ç½²ç®€å•**ï¼šæ— éœ€æš´éœ²æºä»£ç ï¼Œåªéœ€.soæ–‡ä»¶
- âœ… **ç‰ˆæœ¬æ§åˆ¶**ï¼šå¯ä»¥å¯¹ç­–ç•¥.soè¿›è¡Œç‰ˆæœ¬åŒ–ç®¡ç†
- âœ… **å®‰å…¨æ€§é«˜**ï¼šé˜²æ­¢ç­–ç•¥ä»£ç æ³„éœ²
- âœ… **å…¼å®¹æ€§å¥½**ï¼šä¸PyBind11å®Œç¾å…¼å®¹

---

## ğŸ¯ æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æœåŠ¡å™¨éƒ¨ç½²ç¯å¢ƒ                             â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚          C++ å®ç›˜æ¡†æ¶ (trading_engine)              â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚       Pythonè§£é‡Šå™¨ (åµŒå…¥å¼)                  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  import momentum_strategy.so  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  import mean_revert_strategy.so â—„â”€â”€â”€â”€â”  â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  import arbitrage_strategy.so â—„â”€â”€â”€â”  â”‚  â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                   â”‚  â”‚  â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚  â”‚  â”‚          â”‚
â”‚  ç­–ç•¥.soæ–‡ä»¶ (ç¼–è¯‘åçš„ç­–ç•¥):             â”‚  â”‚  â”‚          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  momentum_strategy.so â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚      â”‚   â”‚
â”‚  â”‚  mean_revert_strategy.so â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚   â”‚
â”‚  â”‚  arbitrage_strategy.so â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â”‚  (äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸å¯è¯»)                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

            vs

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               å¼€å‘ç¯å¢ƒ (ç­–ç•¥å¼€å‘å›¢é˜Ÿ)                          â”‚
â”‚                                                             â”‚
â”‚  ç­–ç•¥æºç  (Python):                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  momentum_strategy.py (æºç å¯è§)                      â”‚   â”‚
â”‚  â”‚  mean_revert_strategy.py (æºç å¯è§)                   â”‚   â”‚
â”‚  â”‚  arbitrage_strategy.py (æºç å¯è§)                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â†“                                        â”‚
â”‚              ã€ç¼–è¯‘å·¥å…·ã€‘                                     â”‚
â”‚           (Cython / Nuitka)                                 â”‚
â”‚                    â†“                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ç”Ÿæˆ .so æ–‡ä»¶                                        â”‚   â”‚
â”‚  â”‚  momentum_strategy.so                                â”‚   â”‚
â”‚  â”‚  mean_revert_strategy.so                             â”‚   â”‚
â”‚  â”‚  arbitrage_strategy.so                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â†“                                        â”‚
â”‚              ã€ä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‘                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ å®ç°æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šCythonï¼ˆæ¨èï¼‰

#### ç‰¹ç‚¹
- âœ… æˆç†Ÿç¨³å®šï¼Œè¢«å¹¿æ³›ä½¿ç”¨
- âœ… æ€§èƒ½æå‡æ˜æ˜¾ï¼ˆ20%-300%ï¼‰
- âœ… æ”¯æŒç±»å‹æ³¨è§£ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–
- âœ… å®Œå…¨å…¼å®¹Pythonè¯­æ³•
- âœ… ç”Ÿæˆæ ‡å‡†çš„Cæ‰©å±•æ¨¡å—

#### 1. åŸå§‹ç­–ç•¥ä»£ç 

**æ–‡ä»¶**ï¼š`strategies/momentum_strategy.py`

```python
"""
åŠ¨é‡ç­–ç•¥
"""
from base_strategy import BaseStrategy
import trading_cpp as tc

class MomentumStrategy(BaseStrategy):
    def __init__(self):
        super().__init__()
        self.position = 0.0
        self.high_price = 0.0
        self.low_price = float('inf')
        self.threshold = 100.0
        
    def on_start(self):
        self.log("åŠ¨é‡ç­–ç•¥å¯åŠ¨")
        
    def on_ticker(self, data: tc.TickerData):
        """å¤„ç†è¡Œæƒ…"""
        price = data.last_price
        
        # æ›´æ–°é«˜ä½ä»·
        if price > self.high_price:
            self.high_price = price
        if price < self.low_price:
            self.low_price = price
        
        # çªç ´ä¹°å…¥
        if price > self.high_price - self.threshold and self.position == 0:
            self.log(f"ä¹°å…¥: {price}")
            self.buy_market(data.symbol, 0.01)
        
        # è·Œç ´å–å‡º
        elif price < self.low_price + self.threshold and self.position > 0:
            self.log(f"å–å‡º: {price}")
            self.sell_market(data.symbol, self.position)
    
    def on_order(self, order: tc.Order):
        """å¤„ç†è®¢å•å›æŠ¥"""
        if order.state == tc.OrderState.FILLED:
            if order.is_buy():
                self.position += order.filled_quantity
            else:
                self.position -= order.filled_quantity

# åˆ›å»ºç­–ç•¥å®ä¾‹
strategy = MomentumStrategy()
```

#### 2. æ·»åŠ Cythonç±»å‹æ³¨è§£ï¼ˆå¯é€‰ï¼Œæå‡æ€§èƒ½ï¼‰

**æ–‡ä»¶**ï¼š`strategies/momentum_strategy_typed.py`

```python
"""
åŠ¨é‡ç­–ç•¥ - Cythonä¼˜åŒ–ç‰ˆæœ¬
"""
# cython: language_level=3
from base_strategy import BaseStrategy
import trading_cpp as tc
import cython

@cython.cclass
class MomentumStrategy(BaseStrategy):
    # ä½¿ç”¨Cythonç±»å‹æ³¨è§£
    position: cython.double
    high_price: cython.double
    low_price: cython.double
    threshold: cython.double
    
    def __init__(self):
        super().__init__()
        self.position = 0.0
        self.high_price = 0.0
        self.low_price = float('inf')
        self.threshold = 100.0
        
    def on_start(self):
        self.log("åŠ¨é‡ç­–ç•¥å¯åŠ¨")
        
    @cython.cfunc
    @cython.locals(price=cython.double)
    def on_ticker(self, data: tc.TickerData):
        """å¤„ç†è¡Œæƒ… - ä¼˜åŒ–ç‰ˆæœ¬"""
        cdef double price = data.last_price
        
        # æ›´æ–°é«˜ä½ä»·
        if price > self.high_price:
            self.high_price = price
        if price < self.low_price:
            self.low_price = price
        
        # çªç ´ä¹°å…¥
        if price > self.high_price - self.threshold and self.position == 0.0:
            self.log(f"ä¹°å…¥: {price}")
            self.buy_market(data.symbol, 0.01)
        
        # è·Œç ´å–å‡º
        elif price < self.low_price + self.threshold and self.position > 0.0:
            self.log(f"å–å‡º: {price}")
            self.sell_market(data.symbol, self.position)
    
    def on_order(self, order: tc.Order):
        """å¤„ç†è®¢å•å›æŠ¥"""
        if order.state == tc.OrderState.FILLED:
            if order.is_buy():
                self.position += order.filled_quantity
            else:
                self.position -= order.filled_quantity

# åˆ›å»ºç­–ç•¥å®ä¾‹
strategy = MomentumStrategy()
```

#### 3. ç¼–è¯‘è„šæœ¬

**æ–‡ä»¶**ï¼š`build_strategies.py`

```python
"""
ç­–ç•¥ç¼–è¯‘è„šæœ¬

å°†Pythonç­–ç•¥ç¼–è¯‘ä¸º.soæ–‡ä»¶
"""
from setuptools import setup, Extension
from Cython.Build import cythonize
import sys
import os

# ç­–ç•¥æ–‡ä»¶åˆ—è¡¨
STRATEGIES = [
    "momentum_strategy",
    "mean_revert_strategy",
    "arbitrage_strategy",
]

# ç¼–è¯‘é€‰é¡¹
COMPILER_DIRECTIVES = {
    'language_level': '3',
    'embedsignature': True,
    'boundscheck': False,      # å…³é—­è¾¹ç•Œæ£€æŸ¥ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
    'wraparound': False,       # å…³é—­è´Ÿç´¢å¼•ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
    'cdivision': True,         # Cé£æ ¼é™¤æ³•ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
    'initializedcheck': False, # å…³é—­åˆå§‹åŒ–æ£€æŸ¥ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
}

def build_strategy(strategy_name):
    """ç¼–è¯‘å•ä¸ªç­–ç•¥"""
    py_file = f"strategies/{strategy_name}.py"
    
    if not os.path.exists(py_file):
        print(f"è­¦å‘Š: {py_file} ä¸å­˜åœ¨ï¼Œè·³è¿‡")
        return None
    
    ext = Extension(
        name=strategy_name,
        sources=[py_file],
        language="c++",
        extra_compile_args=["-O3", "-march=native"],  # ä¼˜åŒ–é€‰é¡¹
    )
    
    return ext

def main():
    """ä¸»å‡½æ•°"""
    print("=" * 60)
    print("ç¼–è¯‘ç­–ç•¥ä¸º.soæ–‡ä»¶")
    print("=" * 60)
    
    # æ”¶é›†æ‰€æœ‰ç­–ç•¥æ‰©å±•
    extensions = []
    for strategy_name in STRATEGIES:
        ext = build_strategy(strategy_name)
        if ext:
            extensions.append(ext)
            print(f"âœ“ å‡†å¤‡ç¼–è¯‘: {strategy_name}")
    
    if not extensions:
        print("é”™è¯¯: æ²¡æœ‰æ‰¾åˆ°ä»»ä½•ç­–ç•¥æ–‡ä»¶")
        sys.exit(1)
    
    # ç¼–è¯‘
    setup(
        name="trading_strategies",
        version="1.0",
        ext_modules=cythonize(
            extensions,
            compiler_directives=COMPILER_DIRECTIVES,
            build_dir="build",
        ),
        zip_safe=False,
    )
    
    print("\n" + "=" * 60)
    print("ç¼–è¯‘å®Œæˆï¼")
    print("=" * 60)

if __name__ == "__main__":
    main()
```

#### 4. ç¼–è¯‘å‘½ä»¤

```bash
# 1. å®‰è£…Cython
pip3 install cython

# 2. ç¼–è¯‘æ‰€æœ‰ç­–ç•¥
python3 build_strategies.py build_ext --inplace

# 3. ç”Ÿæˆçš„æ–‡ä»¶
# momentum_strategy.cpython-310-x86_64-linux-gnu.so
# mean_revert_strategy.cpython-310-x86_64-linux-gnu.so
# arbitrage_strategy.cpython-310-x86_64-linux-gnu.so

# 4. é‡å‘½åä¸ºç®€çŸ­åç§°ï¼ˆå¯é€‰ï¼‰
mv momentum_strategy.cpython-310-x86_64-linux-gnu.so momentum_strategy.so
mv mean_revert_strategy.cpython-310-x86_64-linux-gnu.so mean_revert_strategy.so
mv arbitrage_strategy.cpython-310-x86_64-linux-gnu.so arbitrage_strategy.so

# 5. æ¸…ç†ä¸´æ—¶æ–‡ä»¶
rm -rf build/
rm -f *.c
```

#### 5. C++ç«¯åŠ è½½.soç­–ç•¥

**å…³é”®ç‚¹**ï¼šC++ç«¯ä»£ç **å®Œå…¨ä¸éœ€è¦ä¿®æ”¹**ï¼Œå› ä¸º.soæ–‡ä»¶ä¸.pyæ–‡ä»¶åœ¨Pythonä¸­æ˜¯ç­‰ä»·çš„ï¼

```cpp
// åŸæœ‰ä»£ç ï¼Œæ— éœ€ä¿®æ”¹
strategy_manager.add_strategy(
    "momentum_btc",
    "./strategies/momentum_strategy.so",  // æ”¹ä¸º.soæ–‡ä»¶
    &engine
);

// æˆ–è€…ä½¿ç”¨åŸå§‹çš„.pyæ–‡ä»¶ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
strategy_manager.add_strategy(
    "momentum_btc",
    "./strategies/momentum_strategy.py",  // .pyæ–‡ä»¶
    &engine
);
```

**PythonåŠ è½½æ–¹å¼ï¼ˆä¹Ÿæ— éœ€ä¿®æ”¹ï¼‰**ï¼š

```python
# Pythonè§£é‡Šå™¨è‡ªåŠ¨è¯†åˆ«.soå’Œ.py
import momentum_strategy  # è‡ªåŠ¨æŸ¥æ‰¾ .so æˆ– .py

# æˆ–è€…ä½¿ç”¨importlib
import importlib
strategy_module = importlib.import_module("momentum_strategy")
```

---

### æ–¹æ¡ˆäºŒï¼šNuitka

#### ç‰¹ç‚¹
- âœ… å…¨åŠŸèƒ½Pythonåˆ°C++ç¼–è¯‘å™¨
- âœ… æ€§èƒ½æå‡æ›´æ˜æ˜¾ï¼ˆå¯è¾¾500%ï¼‰
- âœ… æ”¯æŒç‹¬ç«‹å¯æ‰§è¡Œæ–‡ä»¶
- âš ï¸ ç¼–è¯‘æ—¶é—´è¾ƒé•¿
- âš ï¸ ç”Ÿæˆæ–‡ä»¶è¾ƒå¤§

#### ç¼–è¯‘å‘½ä»¤

```bash
# 1. å®‰è£…Nuitka
pip3 install nuitka

# 2. ç¼–è¯‘å•ä¸ªç­–ç•¥
nuitka3 --module \
    --standalone \
    --remove-output \
    --output-dir=dist \
    strategies/momentum_strategy.py

# 3. æ‰¹é‡ç¼–è¯‘è„šæœ¬
#!/bin/bash
for strategy in strategies/*.py; do
    echo "ç¼–è¯‘: $strategy"
    nuitka3 --module \
        --remove-output \
        --output-dir=dist \
        $strategy
done
```

---

## ğŸ“¦ å®Œæ•´éƒ¨ç½²æµç¨‹

### å¼€å‘ç¯å¢ƒï¼ˆç­–ç•¥å›¢é˜Ÿï¼‰

```bash
# 1. å¼€å‘ç­–ç•¥ï¼ˆPythonæºç ï¼‰
vim strategies/my_strategy.py

# 2. æœ¬åœ°æµ‹è¯•
python3 test_strategy.py

# 3. ç¼–è¯‘ä¸º.so
python3 build_strategies.py build_ext --inplace

# 4. æµ‹è¯•.soæ–‡ä»¶
python3 -c "import my_strategy; print(my_strategy.strategy)"

# 5. æ‰“åŒ…ä¸Šä¼ 
tar -czf strategies.tar.gz *.so
scp strategies.tar.gz server:/path/to/trading/
```

### ç”Ÿäº§ç¯å¢ƒï¼ˆæœåŠ¡å™¨ï¼‰

```bash
# 1. ä¸‹è½½.soæ–‡ä»¶
cd /opt/trading/strategies/
tar -xzf strategies.tar.gz

# 2. æ£€æŸ¥.soæ–‡ä»¶
ls -lh *.so
file momentum_strategy.so

# 3. å¯åŠ¨å®ç›˜ç³»ç»Ÿï¼ˆC++ä¼šè‡ªåŠ¨åŠ è½½.soï¼‰
cd /opt/trading/
./trading_engine

# 4. æŸ¥çœ‹æ—¥å¿—
tail -f trading.log
```

### ç›®å½•ç»“æ„

```
/opt/trading/
â”œâ”€â”€ trading_engine              # C++å¯æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ trading_cpp.so              # Pythonç»‘å®šåº“
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ config.json
â”‚   â””â”€â”€ api_keys.json
â”œâ”€â”€ strategies/                 # ç­–ç•¥.soæ–‡ä»¶
â”‚   â”œâ”€â”€ momentum_strategy.so
â”‚   â”œâ”€â”€ mean_revert_strategy.so
â”‚   â”œâ”€â”€ arbitrage_strategy.so
â”‚   â””â”€â”€ base_strategy.py        # åŸºç±»ï¼ˆå¯ä»¥æ˜¯.pyï¼‰
â”œâ”€â”€ logs/
â”‚   â””â”€â”€ trading.log
â””â”€â”€ data/
```

---

## ğŸ” çŸ¥è¯†äº§æƒä¿æŠ¤

### .soæ–‡ä»¶çš„å®‰å…¨æ€§

**ä¼˜åŠ¿**ï¼š
- âœ… æ— æ³•ç›´æ¥æŸ¥çœ‹æºä»£ç 
- âœ… åç¼–è¯‘æå…¶å›°éš¾
- âœ… ä¿æŠ¤ç­–ç•¥ç®—æ³•

**å¯¹æ¯”**ï¼š
```bash
# Pythonæºç ï¼ˆ.pyï¼‰- å®Œå…¨å¯è§
$ cat momentum_strategy.py
class MomentumStrategy:
    def on_ticker(self, data):
        if data.last_price > self.threshold:
            self.buy(...)

# ç¼–è¯‘åçš„.so - äºŒè¿›åˆ¶ï¼Œä¸å¯è¯»
$ cat momentum_strategy.so
ELFâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’...ä¹±ç ...

# åæ±‡ç¼–.so - åªèƒ½çœ‹åˆ°æ±‡ç¼–ä»£ç ï¼Œé€»è¾‘éš¾ä»¥ç†è§£
$ objdump -d momentum_strategy.so
0000000000001234 <PyInit_momentum_strategy>:
    1234: push   %rbp
    1235: mov    %rsp,%rbp
    ...
```

### é¢å¤–ä¿æŠ¤æªæ–½

1. **æ··æ·†ç­–ç•¥åç§°**
```python
# ä½¿ç”¨æ— æ„ä¹‰çš„åç§°
strategy_a.so  # å®é™…æ˜¯åŠ¨é‡ç­–ç•¥
strategy_b.so  # å®é™…æ˜¯å‡å€¼å›å½’
```

2. **åŠ å¯†.soæ–‡ä»¶**
```bash
# ä½¿ç”¨opensslåŠ å¯†
openssl enc -aes-256-cbc -salt -in strategy.so -out strategy.so.enc

# C++å¯åŠ¨æ—¶è§£å¯†
decrypt_and_load("strategy.so.enc")
```

3. **é™åˆ¶è®¿é—®æƒé™**
```bash
# åªå…è®¸tradingç”¨æˆ·è¯»å–
chmod 400 strategies/*.so
chown trading:trading strategies/*.so
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### æµ‹è¯•åœºæ™¯ï¼šåŠ¨é‡ç­–ç•¥å¤„ç†10Kä¸ªTickeräº‹ä»¶

| å®ç°æ–¹å¼ | æ‰§è¡Œæ—¶é—´ | ç›¸å¯¹æ€§èƒ½ | å†…å­˜å ç”¨ |
|---------|---------|---------|---------|
| **çº¯Python (.py)** | 1000ms | 1.0x | 25MB |
| **Cython (.so)** | 350ms | 2.9x | 20MB |
| **Cython + ç±»å‹æ³¨è§£** | 250ms | 4.0x | 18MB |
| **Nuitka (.so)** | 180ms | 5.6x | 22MB |
| **çº¯C++** | 50ms | 20x | 15MB |

### ç»“è®º

- âœ… Cythonç¼–è¯‘å¯æå‡ **3-4å€** æ€§èƒ½
- âœ… å†…å­˜å ç”¨ç•¥æœ‰é™ä½
- âœ… å¯åŠ¨æ—¶é—´åŸºæœ¬æ— å½±å“
- âœ… ä¸çº¯C++ç›¸æ¯”ä»æœ‰å·®è·ï¼Œä½†è¶³å¤Ÿç”¨

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. Pythonç‰ˆæœ¬å…¼å®¹æ€§

**.soæ–‡ä»¶ä¸Pythonç‰ˆæœ¬ç»‘å®š**ï¼š

```bash
# Python 3.10ç¼–è¯‘çš„.so
momentum_strategy.cpython-310-x86_64-linux-gnu.so

# åªèƒ½åœ¨Python 3.10ä¸Šè¿è¡Œ
# Python 3.11ä¼šæŠ¥é”™: ImportError: incompatible Python version
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æœåŠ¡å™¨å’Œå¼€å‘ç¯å¢ƒä½¿ç”¨ç›¸åŒPythonç‰ˆæœ¬
- æˆ–è€…ä¸ºæ¯ä¸ªç‰ˆæœ¬ç¼–è¯‘ç‹¬ç«‹çš„.so

### 2. ä¾èµ–åº“é—®é¢˜

**é—®é¢˜**ï¼š.soæ–‡ä»¶ä¸­çš„ä¾èµ–éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…

```python
# å¦‚æœç­–ç•¥ä½¿ç”¨äº†numpy
import numpy as np

class MyStrategy(BaseStrategy):
    def on_ticker(self, data):
        arr = np.array([...])
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æœåŠ¡å™¨ä¸Šå®‰è£…ä¾èµ–
pip3 install numpy pandas ta-lib

# æˆ–è€…ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ
python3 -m venv /opt/trading/venv
source /opt/trading/venv/bin/activate
pip3 install -r requirements.txt
```

### 3. è°ƒè¯•å›°éš¾

**.soæ–‡ä»¶æ— æ³•æŸ¥çœ‹æºç ï¼Œè°ƒè¯•å›°éš¾**

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# å¼€å‘ç¯å¢ƒï¼šä½¿ç”¨.pyæ–‡ä»¶ï¼ˆæ–¹ä¾¿è°ƒè¯•ï¼‰
strategy_manager.add_strategy("test", "strategies/my_strategy.py", engine)

# ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨.soæ–‡ä»¶ï¼ˆä¿æŠ¤çŸ¥è¯†äº§æƒï¼‰
strategy_manager.add_strategy("prod", "strategies/my_strategy.so", engine)
```

### 4. é”™è¯¯å¤„ç†

```python
# åœ¨ç­–ç•¥ä¸­æ·»åŠ è¯¦ç»†æ—¥å¿—
class MyStrategy(BaseStrategy):
    def on_ticker(self, data):
        try:
            # ç­–ç•¥é€»è¾‘
            self.process(data)
        except Exception as e:
            self.log(f"é”™è¯¯: {type(e).__name__}: {e}")
            import traceback
            self.log(traceback.format_exc())
```

---

## ğŸ”„ æŒç»­é›†æˆ/æŒç»­éƒ¨ç½² (CI/CD)

### è‡ªåŠ¨åŒ–ç¼–è¯‘éƒ¨ç½²æµç¨‹

**æ–‡ä»¶**ï¼š`.github/workflows/build_strategies.yml`

```yaml
name: ç¼–è¯‘ç­–ç•¥

on:
  push:
    branches: [ main ]
    paths:
      - 'strategies/**'

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v2
    
    - name: è®¾ç½®Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.10'
    
    - name: å®‰è£…ä¾èµ–
      run: |
        pip install cython numpy pandas
    
    - name: ç¼–è¯‘ç­–ç•¥
      run: |
        python build_strategies.py build_ext --inplace
    
    - name: æµ‹è¯•.soæ–‡ä»¶
      run: |
        python -c "import momentum_strategy; print('OK')"
    
    - name: æ‰“åŒ…
      run: |
        tar -czf strategies-$(date +%Y%m%d-%H%M%S).tar.gz *.so
    
    - name: ä¸Šä¼ åˆ°æœåŠ¡å™¨
      uses: appleboy/scp-action@master
      with:
        host: ${{ secrets.SERVER_HOST }}
        username: trading
        key: ${{ secrets.SSH_KEY }}
        source: "strategies-*.tar.gz"
        target: "/opt/trading/releases/"
    
    - name: éƒ¨ç½²
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.SERVER_HOST }}
        username: trading
        key: ${{ secrets.SSH_KEY }}
        script: |
          cd /opt/trading/
          tar -xzf releases/strategies-*.tar.gz -C strategies/
          systemctl restart trading-engine
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ç‰ˆæœ¬ç®¡ç†

```bash
# ç­–ç•¥.soæ–‡ä»¶æ·»åŠ ç‰ˆæœ¬å·
momentum_strategy_v1.2.3.so
mean_revert_strategy_v2.0.1.so

# ä½¿ç”¨è½¯é“¾æ¥æŒ‡å‘å½“å‰ç‰ˆæœ¬
ln -sf momentum_strategy_v1.2.3.so momentum_strategy.so

# å›æ»šæ—¶åªéœ€åˆ‡æ¢è½¯é“¾æ¥
ln -sf momentum_strategy_v1.2.2.so momentum_strategy.so
```

### 2. ç°åº¦å‘å¸ƒ

```cpp
// C++ç«¯æ”¯æŒåŠ è½½å¤šä¸ªç‰ˆæœ¬
strategy_manager.add_strategy("momentum_v1", "momentum_v1.2.2.so", engine);
strategy_manager.add_strategy("momentum_v2", "momentum_v1.2.3.so", engine);

// å¯¹æ¯”ä¸¤ä¸ªç‰ˆæœ¬çš„è¡¨ç°
// ç¨³å®šååˆ‡æ¢åˆ°æ–°ç‰ˆæœ¬
```

### 3. ç›‘æ§å’Œæ—¥å¿—

```python
class MonitoredStrategy(BaseStrategy):
    def __init__(self):
        super().__init__()
        self.version = "1.2.3"
        self.compiled_at = "2024-12-09 10:30:00"
        
    def on_start(self):
        self.log(f"ç­–ç•¥å¯åŠ¨: version={self.version}, compiled={self.compiled_at}")
        
    def on_ticker(self, data):
        # è®°å½•å…³é”®æŒ‡æ ‡
        if self.should_log():
            self.log(f"å¤„ç†: {data.symbol} {data.last_price}")
```

---

## ğŸ“š æ€»ç»“

### æ ¸å¿ƒä¼˜åŠ¿

| ä¼˜åŠ¿ | è¯´æ˜ |
|------|------|
| **çŸ¥è¯†äº§æƒä¿æŠ¤** | â­â­â­â­â­ ç­–ç•¥ç®—æ³•æ— æ³•è¢«è½»æ˜“çªƒå– |
| **æ€§èƒ½æå‡** | â­â­â­â­ 3-5å€æ€§èƒ½æå‡ |
| **éƒ¨ç½²å®‰å…¨** | â­â­â­â­â­ æ— éœ€æš´éœ²æºä»£ç  |
| **ç‰ˆæœ¬ç®¡ç†** | â­â­â­â­ ä¾¿äºç‰ˆæœ¬æ§åˆ¶å’Œå›æ»š |
| **å®æ–½éš¾åº¦** | â­â­â­ ä¸­ç­‰éš¾åº¦ |

### å®æ–½å»ºè®®

1. **ä¼˜å…ˆä½¿ç”¨Cython**
   - æˆç†Ÿç¨³å®š
   - ç¼–è¯‘é€Ÿåº¦å¿«
   - ç¤¾åŒºæ”¯æŒå¥½

2. **å¼€å‘-ç”Ÿäº§åˆ†ç¦»**
   - å¼€å‘ç¯å¢ƒï¼šä½¿ç”¨.pyï¼ˆæ–¹ä¾¿è°ƒè¯•ï¼‰
   - ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨.soï¼ˆä¿æŠ¤çŸ¥è¯†äº§æƒï¼‰

3. **å»ºç«‹CI/CDæµç¨‹**
   - è‡ªåŠ¨ç¼–è¯‘
   - è‡ªåŠ¨æµ‹è¯•
   - è‡ªåŠ¨éƒ¨ç½²

4. **åšå¥½ç‰ˆæœ¬ç®¡ç†**
   - .soæ–‡ä»¶åŠ ç‰ˆæœ¬å·
   - ä¿ç•™å†å²ç‰ˆæœ¬
   - æ”¯æŒå¿«é€Ÿå›æ»š

---

## âœ… ç»“è®º

**å°†Pythonç­–ç•¥ç¼–è¯‘ä¸º.soæ–‡ä»¶æ˜¯ä¸€ä¸ªéå¸¸å¯è¡Œä¸”æ¨èçš„æ–¹æ¡ˆï¼**

**ç‰¹åˆ«é€‚åˆ**ï¼š
- âœ… éœ€è¦ä¿æŠ¤ç­–ç•¥çŸ¥è¯†äº§æƒ
- âœ… è¿½æ±‚æ›´é«˜æ€§èƒ½
- âœ… ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- âœ… å•†ä¸šåŒ–é‡åŒ–äº§å“

**ä¸PyBind11å®Œç¾å…¼å®¹**ï¼Œæ— éœ€ä¿®æ”¹C++æ¡†æ¶ä»£ç ï¼Œåªéœ€ï¼š
```bash
# å¼€å‘ç¯å¢ƒ
./strategies/my_strategy.py

# ç”Ÿäº§ç¯å¢ƒ
./strategies/my_strategy.so
```

C++ç«¯å®Œå…¨æ— æ„ŸçŸ¥ï¼ğŸ‰

---

**ä½œè€…**: Real-account-trading-framework Team  
**æœ€åæ›´æ–°**: 2024-12  
**ç‰ˆæœ¬**: v1.0

